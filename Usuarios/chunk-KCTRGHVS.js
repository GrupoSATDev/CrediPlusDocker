import{a as Ve}from"./chunk-5FWRBEZU.js";import{a as Te}from"./chunk-TU256KIH.js";import{a as Ne,b as ke,c as Ae}from"./chunk-Z3HPIT5Y.js";import{a as je,b as $e}from"./chunk-EXSRQRP4.js";import{a as Me}from"./chunk-WVBHYJUP.js";import{a as q}from"./chunk-6IEWE3OU.js";import{a as Ie}from"./chunk-GTJMBBHF.js";import{a as we}from"./chunk-YYEPHEMI.js";import{a as O}from"./chunk-MO2NC6JB.js";import{a as De}from"./chunk-FDKLFNMB.js";import"./chunk-DXTAURWF.js";import{a as Fe}from"./chunk-TRVR57AA.js";import{a as J}from"./chunk-H7DTTKLU.js";import{a as xe}from"./chunk-OIDWJWJT.js";import{g as he}from"./chunk-KOHPUW4T.js";import{a as me,b as le,c as pe}from"./chunk-2APB6LD7.js";import"./chunk-SVJNALL6.js";import{C as ye,G as $,b as ce,e as de,i as V,j as fe,l as ge,p as ve,q as Se,u as Ce,w as be,x as Ee,z as _e}from"./chunk-HT3W5V35.js";import{$ as se,Q as ae,R as ne,ea as j,ja as ue}from"./chunk-A6IWXEM5.js";import"./chunk-LZ5XM2X6.js";import{a as E}from"./chunk-KDIFW2XS.js";import{f as ie,g as oe,i as re,j as Z,r as b}from"./chunk-CLM5DCBX.js";import{$a as k,$b as W,Db as s,Eb as r,Fb as f,Gb as F,Hb as I,Jb as ee,Pb as S,Y as y,Yb as L,Zb as l,_a as a,_b as M,aa as C,ec as te,fa as h,fc as A,ga as d,la as N,nc as T,oc as w,q as Y,qb as g,sb as n,va as D,wa as x}from"./chunk-RICNMTJI.js";import{a as _,d as B}from"./chunk-NEB6MB4Y.js";var Pe=(()=>{let e=class e{constructor(i,t){this._http=i,this.appSettings=t}getTiposEmpresas(){return this._http.get(this.appSettings.tiposEmpresas.url.base)}};e.\u0275fac=function(t){return new(t||e)(h(b),h(E))},e.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var P=(()=>{let e=class e{constructor(i,t){this._http=i,this.appSettings=t}getEmpresas(){return this._http.get(this.appSettings.empresasClientes.url.base)}getEmpresasClientes(){return this._http.get(this.appSettings.empresasClientes.url.baseTrabajador)}postEmpresaCliente(i){return delete i.id,this._http.post(this.appSettings.empresasClientes.url.base,i)}putEmpresaCliente(i){let t=i.id;return delete i.id,this._http.put(`${this.appSettings.empresasClientes.url.base}/${t}`,i)}};e.\u0275fac=function(t){return new(t||e)(h(b),h(E))},e.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var ze=(()=>{let e=class e{constructor(i,t){this._http=i,this.appSettingService=t}getSubcripciones(){return this._http.get(this.appSettingService.subcripciones.url.base)}getSubcripcion(i){return this._http.get(`${this.appSettingService.subcripciones.url.base}`)}};e.\u0275fac=function(t){return new(t||e)(h(b),h(E))},e.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function Be(o,e){if(o&1&&(s(0,"mat-option",32),l(1),r()),o&2){let p=e.$implicit;n("value",p.id),a(),M(p.nombre)}}function Le(o,e){if(o&1&&(F(0),g(1,Be,2,2,"mat-option",31),I()),o&2){let p=e.ngIf;a(),n("ngForOf",p.data)}}function We(o,e){if(o&1&&(s(0,"mat-option",32),l(1),r()),o&2){let p=e.$implicit;n("value",p.id),a(),M(p.nombre)}}function Ze(o,e){if(o&1&&(F(0),g(1,We,2,2,"mat-option",31),I()),o&2){let p=e.ngIf;a(),n("ngForOf",p.data)}}function Je(o,e){if(o&1&&(s(0,"mat-option",32),l(1),r()),o&2){let p=e.$implicit;n("value",p.id),a(),M(p.nombre)}}function qe(o,e){if(o&1&&(F(0),g(1,Je,2,2,"mat-option",31),I()),o&2){let p=e.ngIf;a(),n("ngForOf",p.data)}}function Ke(o,e){if(o&1&&(s(0,"mat-option",32),l(1),r()),o&2){let p=e.$implicit;n("value",p.id),a(),M(p.nombre)}}function Qe(o,e){if(o&1&&(F(0),g(1,Ke,2,2,"mat-option",31),I()),o&2){let p=e.ngIf;a(),n("ngForOf",p.data)}}var Ue={validation:!1},K=(()=>{let e=class e{constructor(){this.fb=d(_e),this._locacionService=d(Me),this.empresasService=d(Te),this.dialogRef=d(me),this.fuseService=d(he),this.estadosDatosService=d(O),this.toasService=d(we),this.tiposEmpresaService=d(Pe),this.empresaClienteService=d(P),this.subcripciones=d(ze),this.departamentos$=this._locacionService.getDepartamentos().pipe(y(i=>{let t=i.data,m=this._matData;if(t&&!m.edit){this.form.get("idDepartamento").setValue(t[0].id);let c=this.form.get("idDepartamento").value;this.getMunicipios(c)}})),this.empresas$=this.empresasService.getEmpresas(),this.tiposEmpresas$=this.tiposEmpresaService.getTiposEmpresas().pipe(y(i=>{let t=i.data,m=this._matData;t&&!m.edit&&this.form.get("idTipoEmpresa").setValue(t[0].id)})),this.subcripciones$=this.subcripciones.getSubcripciones().pipe(y(i=>{let t=i.data,m=this._matData;t&&!m.edit&&this.form.get("idSuscripcion").setValue(t[0].id)})),this._matData=d(le),this.datePipe=d(Z),this.swalService=d(Fe)}onSelected(i){let t=i.value;this.getMunicipios(t)}getMunicipios(i){this.municipios$=this._locacionService.getMunicipio(i).pipe(y(t=>{let m=t.data,c=this._matData;m&&!c.edit&&this.form.get("idMunicipio").setValue(m[0].id)}))}ngOnInit(){this.createForm();let i=this._matData;if(i.edit){let t=i.data;this.form.patchValue(t);let{idDepartamento:m,fechaCorte:c,estado:v}=t,u=new Date(c);this.form.patchValue({estado:v=="Activo",fechaCorte:u}),this.municipios$=this._locacionService.getMunicipio(m)}}onSave(){if(this.form.valid)if(this._matData.edit){let t=this.form.getRawValue(),{idDepartamento:c,fechaCobro:v}=t,u=B(t,["idDepartamento","fechaCobro"]),z=this.datePipe.transform(v,"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"),R=_({fechaCobro:z},u);this.fuseService.open(_({},J)).afterClosed().subscribe(U=>{U==="confirmed"?this.empresaClienteService.putEmpresaCliente(R).subscribe(H=>{this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro actualizado con exito!",timer:4e3}),this.closeDialog()},H=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al actualizar el registro!",timer:4e3})}):this.closeDialog()})}else{let i=this.form.getRawValue(),{idDepartamento:c,idEmpresa:v,fechaCobro:u}=i,z=B(i,["idDepartamento","idEmpresa","fechaCobro"]),R=this.datePipe.transform(u,"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"),Q=_({fechaCobro:R},z);this.fuseService.open(_({},J)).afterClosed().subscribe(H=>{H==="confirmed"?this.empresaClienteService.postEmpresaCliente(Q).subscribe(X=>{console.log(X),this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro creado con exito!",timer:4e3}),this.closeDialog()},X=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})}):this.closeDialog()})}}createForm(){this.form=this.fb.group({id:[null],nit:[""],razonSocial:[""],correo:[""],telefono:[""],direccion:[""],idDepartamento:[""],idTipoEmpresa:[""],idMunicipio:[""],fechaCorte:[""],idSuscripcion:[""],valorSuscripcion:[""],porcCobro:[""],fechaCobro:[""],estado:[!0]})}closeDialog(){this.dialogRef.close()}};e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=N({type:e,selectors:[["app-form-empresas-clientes"]],standalone:!0,features:[te([{provide:ne,useClass:Ve},{provide:ae,useValue:"en-GB"},Z,je(Ue)]),A],decls:92,vars:33,consts:[["twoStepToggle",""],["data",""],["picker",""],[1,"w-full","sm:bg-card","sm:rounded-2xl","sm:mx-0","mx-auto"],[1,""],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"mt-8",3,"formGroup"],[1,"font-bold","mb-4","text-2xl"],[1,"flex","mb-4"],[1,"fcursor-pointer",3,"click"],[1,"font-medium","leading-6"],[1,"ml-4",3,"color","formControlName"],[1,"flex","mb-4","gap-2"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","Nit",3,"formControlName"],["matInput","","placeholder","Raz\xF3n social",3,"formControlName"],["matInput","","placeholder","Correo electronico",3,"formControlName"],["matInput","","placeholder","Tel\xE9fono",3,"formControlName"],["placeholder","Departamento",3,"selectionChange","formControlName"],[4,"ngIf"],["placeholder","Ciudad",3,"formControlName"],["matInput","","placeholder","Direcci\xF3n",3,"formControlName"],["placeholder","Tipo de empresa",3,"formControlName"],["placeholder","Subscripci\xF3n",3,"formControlName"],["matInput","","mask","separator.0","thousandSeparator",".","placeholder","Valor subcripci\xF3n",3,"formControlName"],["matInput","","placeholder","Porcentaje %",3,"formControlName"],["matInput","","placeholder","Fecha de cobro",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],[1,"flex","flex-wrap","justify-end","gap-2.5"],["mat-flat-button","",1,"fuse-mat-button-large","mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"fuse-mat-button-large","mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,m){if(t&1){let c=ee();s(0,"div",3)(1,"div",4)(2,"div",5),l(3),r(),s(4,"form",6)(5,"div")(6,"p",7),l(7,"Informaci\xF3n general"),r(),s(8,"div",8)(9,"div",8)(10,"div",9),S("click",function(){D(c);let u=L(14);return x(u.toggle())}),s(11,"div",10),l(12),r()(),f(13,"mat-slide-toggle",11,0),r()(),s(15,"div",12)(16,"mat-form-field",13)(17,"mat-label"),l(18,"Nit"),r(),f(19,"input",14),r(),s(20,"mat-form-field",13)(21,"mat-label"),l(22,"Raz\xF3n social"),r(),f(23,"input",15),r()(),s(24,"div",12)(25,"mat-form-field",13)(26,"mat-label"),l(27,"Correo"),r(),f(28,"input",16),r(),s(29,"mat-form-field",13)(30,"mat-label"),l(31,"Tel\xE9fono"),r(),f(32,"input",17),r()(),s(33,"div",12)(34,"mat-form-field",13)(35,"mat-label"),l(36,"Departamento"),r(),s(37,"mat-select",18,1),S("selectionChange",function(u){return D(c),x(m.onSelected(u))}),g(39,Le,2,1,"ng-container",19),T(40,"async"),r()(),s(41,"mat-form-field",13)(42,"mat-label"),l(43,"Ciudad"),r(),s(44,"mat-select",20),g(45,Ze,2,1,"ng-container",19),T(46,"async"),r()()(),s(47,"div",8)(48,"mat-form-field",13)(49,"mat-label"),l(50,"Direcci\xF3n"),r(),f(51,"input",21),r()()(),s(52,"div")(53,"p",7),l(54,"Informaci\xF3n de contrato"),r(),s(55,"div",12)(56,"mat-form-field",13)(57,"mat-label"),l(58,"Tipo de empresa"),r(),s(59,"mat-select",22),g(60,qe,2,1,"ng-container",19),T(61,"async"),r()(),s(62,"mat-form-field",13)(63,"mat-label"),l(64,"Subscripci\xF3n"),r(),s(65,"mat-select",23),g(66,Qe,2,1,"ng-container",19),T(67,"async"),r()()(),s(68,"div",12)(69,"mat-form-field",13)(70,"mat-label"),l(71,"Valor subscripci\xF3n"),r(),f(72,"input",24),r(),s(73,"mat-form-field",13)(74,"mat-label"),l(75,"Porcentaje cobro"),r(),f(76,"input",25),r()(),s(77,"div",8)(78,"mat-form-field",13)(79,"mat-label"),l(80,"Fecha de cobro"),r(),f(81,"input",26)(82,"mat-datepicker-toggle",27)(83,"mat-datepicker",null,2),r()()(),s(85,"div",28)(86,"button",29),S("click",function(){return D(c),x(m.closeDialog())}),s(87,"span"),l(88," Cancelar "),r()(),s(89,"button",30),S("click",function(){return D(c),x(m.onSave())}),s(90,"span"),l(91," Guardar "),r()()()()()()}if(t&2){let c=L(84);a(3),W(" ",m._matData.edit?"Actualizar empresa":"Agregar empresa"," "),a(),n("formGroup",m.form),a(8),W(" Estado ",m.form.get("estado").value?"Activo":"Inactivo"," "),a(),n("color","primary")("formControlName","estado"),a(6),n("formControlName","nit"),a(4),n("formControlName","razonSocial"),a(5),n("formControlName","correo"),a(4),n("formControlName","telefono"),a(5),n("formControlName","idDepartamento"),a(2),n("ngIf",w(40,25,m.departamentos$)),a(5),n("formControlName","idMunicipio"),a(),n("ngIf",w(46,27,m.municipios$)),a(6),n("formControlName","direccion"),a(8),n("formControlName","idTipoEmpresa"),a(),n("ngIf",w(61,29,m.tiposEmpresas$)),a(5),n("formControlName","idSuscripcion"),a(),n("ngIf",w(67,31,m.subcripciones$)),a(6),n("formControlName","valorSuscripcion"),a(4),n("formControlName","porcCobro"),a(5),n("matDatepicker",c)("formControlName","fechaCobro"),a(),n("for",c),a(4),n("color","primary"),a(3),n("color","primary")}},dependencies:[j,V,$,ce,ye,Ce,ge,ve,Se,be,Ee,re,se,xe,ie,oe,ke,Ae,Ne,fe,de,$e,De]});let o=e;return o})();var Re=(()=>{let e=class e{constructor(i,t,m){this._matDialog=i,this.empresaClienteService=t,this.estadoDatosService=m,this.data=[],this.columns=["Nit","Razon social","Correo","Telefono","Direccion","Estado"],this.columnPropertyMap={Nit:"nit","Razon social":"razonSocial",Correo:"correo",Telefono:"telefono",Direccion:"direccion",Estado:"estado"},this.buttons=[{label:"Edit",icon:"edit",action:c=>{console.log("Editing",c),this.selectedData=c,this.onEdit()}}]}onNew(){this._matDialog.open(K,{autoFocus:!1,data:{edit:!1},maxHeight:"90vh",width:"50%",maxWidth:"100%",disableClose:!0})}onEdit(){this._matDialog.open(K,{autoFocus:!1,data:{edit:!0,data:this.selectedData},maxHeight:"90vh",width:"50%",maxWidth:"100%",disableClose:!0})}getEmpresas(){this.subcription$=this.empresaClienteService.getEmpresasClientes().pipe(Y(i=>(i.data.forEach(t=>{t.estado?t.estado=q.ACTIVO:t.estado=q.INACTIVO}),i))).subscribe(i=>{this.data=i.data})}listenGrid(){this.estadoDatosService.stateGrid.asObservable().subscribe(t=>{t&&this.getEmpresas()})}ngOnDestroy(){this.subcription$.unsubscribe()}ngOnInit(){this.getEmpresas(),this.listenGrid()}};e.\u0275fac=function(t){return new(t||e)(k(pe),k(P),k(O))},e.\u0275cmp=N({type:e,selectors:[["app-grid-empresas-clientes"]],standalone:!0,features:[A],decls:15,vars:11,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","shrink-0","items-center","sm:ml-4","sm:mt-0"],[1,"fuse-mat-dense","rounded-lg","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"autocomplete","placeholder"],["mat-flat-button","",1,"ml-4","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons"]],template:function(t,m){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),l(3,"Clientes - Aliados"),r(),s(4,"div",3)(5,"mat-form-field",4),f(6,"mat-icon",5)(7,"input",6),r(),s(8,"button",7),S("click",function(){return m.onNew()}),f(9,"mat-icon",8),s(10,"span",9),l(11,"Agregar"),r()()()(),s(12,"div",10)(13,"div",11),f(14,"app-custom-table",12),r()()()),t&2&&(a(5),n("subscriptSizing","dynamic"),a(),n("svgIcon","heroicons_solid:magnifying-glass"),a(),n("autocomplete","off")("placeholder","Buscar"),a(),n("color","primary"),a(),n("svgIcon","heroicons_outline:plus"),a(5),n("columns",m.columns)("displayedColumns",m.columns)("columnPropertyMap",m.columnPropertyMap)("data",m.data)("buttons",m.buttons))},dependencies:[j,V,ue,$,Ie]});let o=e;return o})();var Ht=[{path:"",component:Re}];export{Ht as default};
