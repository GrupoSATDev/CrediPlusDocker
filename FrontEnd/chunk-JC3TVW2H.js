import{a as Ee,b as xe,c as De,d as Ne}from"./chunk-Y4MQD3WA.js";import{a as we}from"./chunk-PWHPCRCN.js";import{a as ye}from"./chunk-Z2MQWE4K.js";import{a as Fe}from"./chunk-BPPQTQZC.js";import{a as he}from"./chunk-VLAQALEV.js";import{a as be,c as _e,d as Se}from"./chunk-4N6RINGF.js";import{a as ge}from"./chunk-55LFJ2HF.js";import{k as ee}from"./chunk-GIPKHLVS.js";import{h as K}from"./chunk-7U4JZNVG.js";import{a as Ce}from"./chunk-CH3XODOV.js";import"./chunk-ZFQVSUZG.js";import{B as ue,D as ce,E as fe,I as ve,b as U,c as X,i as Y,l as ie,n as v,p as re,q as ne,t as ae,u as me,w as le,x as pe,y as se,z as de}from"./chunk-CURMXRYA.js";import{$ as J,Q as z,R as H,ea as Z}from"./chunk-DARKUWJB.js";import{a as oe}from"./chunk-75YALSW6.js";import"./chunk-EENLYY7H.js";import{a as te}from"./chunk-EJW5UVWF.js";import{d as W}from"./chunk-DJAHQBBJ.js";import{f as R,g as B,i as L,j as A,r as Q}from"./chunk-NP3GUERB.js";import{$ as G,Cb as m,Db as e,Eb as d,Fb as _,Gb as S,Ib as M,Ob as y,Qb as q,Ub as k,Vb as O,Wb as j,Yb as l,Za as t,Zb as F,_b as I,dc as $,ea as w,ec as P,fa as u,ka as T,l as E,mc as x,nc as D,pb as f,rb as o,ua as h,va as b}from"./chunk-32HXX3OB.js";import{a as N,d as V}from"./chunk-NEB6MB4Y.js";var Ie=(()=>{let n=class n{constructor(s,a){this._http=s,this.appSettings=a}postDetalle(s){return this._http.post(this.appSettings.detalleConsumos.url.base,s)}};n.\u0275fac=function(a){return new(a||n)(w(Q),w(te))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();var Me=["stepper"];function qe(i,n){if(i&1&&(m(0,"mat-option",34),l(1),e()),i&2){let p=n.$implicit;o("value",p.id),t(),F(p.nombre)}}function ke(i,n){if(i&1&&(_(0),f(1,qe,2,2,"mat-option",33),S()),i&2){let p=n.ngIf;t(),o("ngForOf",p.data)}}function Oe(i,n){if(i&1&&(m(0,"fuse-alert",35),l(1),e()),i&2){let p=q();o("appearance","outline")("showIcon",!1)("type",p.alert.type)("@shake",p.alert.type==="error"),t(),I(" ",p.alert.message," ")}}function je(i,n){if(i&1&&(_(0),m(1,"mat-option",34),l(2),e(),S()),i&2){let p=n.$implicit;t(),o("value",p),t(),F(p.numCredito)}}function $e(i,n){i&1&&(m(0,"mat-error"),l(1,"El valor es requerido!"),e())}function Pe(i,n){i&1&&(m(0,"mat-error"),l(1,"El valor ingresado no puede superar el cupo disponible!"),e())}function Re(i,n){if(i&1&&(m(0,"mat-option",34),l(1),e()),i&2){let p=n.$implicit;o("value",p.id),t(),F(p.nombre)}}function Be(i,n){if(i&1&&(_(0),f(1,Re,2,2,"mat-option",33),S()),i&2){let p=n.ngIf;t(),o("ngForOf",p.data)}}function Le(i,n){if(i&1&&(m(0,"mat-option",34),l(1),e()),i&2){let p=n.$implicit;o("value",p.id),t(),F(p.nombre)}}function Qe(i,n){if(i&1&&(_(0),f(1,Le,2,2,"mat-option",33),S()),i&2){let p=n.ngIf;t(),o("ngForOf",p.data)}}var Ae=(()=>{let n=class n{constructor(){this.tiposDocumentosService=u(Fe),this.fuseService=u(ee),this.estadosDatosService=u(_e),this.toasService=u(Se),this.empleadosServices=u(we),this.datePipe=u(A),this.router=u(W),this.fb=u(ue),this._locacionService=u(he),this.detalleConsumo=u(Ie),this.departamentos$=this._locacionService.getDepartamentos(),this.showAlert=!1,this.alert={type:"success",message:""},this.tiposDocumentos$=this.tiposDocumentosService.getTiposDocumentos(),this.creditos=[],this.focus=focus}ngOnDestroy(){}ngOnInit(){this.createForm()}getMunicipios(s){let a=s.value;this.municipios$=this._locacionService.getMunicipio(a)}selected(s){let a=s.value;this.compareValor=a.cupoDisponible,this.thirdFormGroup.get("montoConsumo").setValidators(We(this.compareValor)),this.thirdFormGroup.get("montoConsumo").updateValueAndValidity()}compareWithConstants(s){let a=s.value,r=this.secondFormGroup.get("idCredito")?.value;return!r||!r.montoConsumo?(console.error("No se encontr\xF3 el objeto idCredito o montoConsumo"),E(null)):(console.log(a),console.log(r.montoConsumo),a>r.montoConsumo?E({notEqual:!0}):E(null))}get montoConsumo(){return this.thirdFormGroup.get("montoConsumo")}onSearch(){let s=this.firstFormGroup.getRawValue();this.empleadosServices.getEmpleadoParams(s).subscribe(a=>{if(console.log(a),a){this.showAlert=!1;let r={numDoc:a.data.numDoc,primerNombre:a.data.primerNombre,segundoNombre:a.data.segundoNombre,primerApellido:a.data.primerApellido,segundoApellido:a.data.segundoApellido,idTrabajador:a.data.id,correo:a.data.correo};this.secondFormGroup.patchValue(r),this.creditos=a.data.creditos,setTimeout(()=>{this.stepper.next()},1200)}},a=>{this.alert={type:"error",message:"El empleado no existe!"},this.showAlert=!0})}onSave(){if(this.thirdFormGroup.valid){let s=this.thirdFormGroup.getRawValue(),{montoConsumo:a}=s,r=V(s,["montoConsumo"]),{idCredito:c,idTrabajador:g}=this.secondFormGroup.getRawValue();console.log(c);let C=N({idCredito:c.id,idTrabajador:g,montoConsumo:Number(a)},r);console.log(C),this.fuseService.open(N({},be)).afterClosed().subscribe(Ve=>{Ve==="confirmed"&&this.detalleConsumo.postDetalle(C).subscribe(Ge=>{console.log(Ge),this.estadosDatosService.stateGrid.next(!0),this.toasService.toasAlertWarn({message:"Registro creado con exito!",actionMessage:"Cerrar",duration:3e3}),this.router.navigate(["/pages/gestion-creditos/creditos/"])})})}}createForm(){this.firstFormGroup=this.fb.group({idTipoDoc:["",v.required],numDocumento:["",v.required]}),this.secondFormGroup=this.fb.group({numDoc:[{value:"",disabled:!0}],primerNombre:[{value:"",disabled:!0}],segundoNombre:[{value:"",disabled:!0}],primerApellido:[{value:"",disabled:!0}],segundoApellido:[{value:"",disabled:!0}],idTrabajador:[""],correo:[{value:"",disabled:!0}],idCredito:["",v.required]}),this.thirdFormGroup=this.fb.group({cantidadCuotas:["",[v.required]],montoConsumo:["",[v.required]],numeroFactura:["",v.required],detalleCompra:["",v.required],idMunicipio:["",v.required]})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=T({type:n,selectors:[["app-form-detalle-consumo"]],viewQuery:function(a,r){if(a&1&&k(Me,5),a&2){let c;O(c=j())&&(r.stepper=c.first)}},standalone:!0,features:[$([{provide:H,useClass:ye},{provide:z,useValue:"en-GB"},A]),P],decls:105,vars:45,consts:[["stepper",""],["data",""],["cdkScrollable","",1,"absolute","inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"inline-block","p-6","sm:p-10","print:p-0","w-full"],[1,"sm:bg-card","sm:rounded-2xl","sm:mx-0","mx-auto","overflow-hidden"],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[3,"linear"],["label","Consultar empleado",3,"stepControl"],[1,"flex","flex-col","items-center","justify-center","w-full","h-full","px-4"],[3,"formGroup"],[1,"w-full"],[3,"formControlName"],[4,"ngIf"],["matInput","","placeholder","Ingrese identificaci\xF3n",3,"formControlName"],["class","mb-4",3,"appearance","showIcon","type",4,"ngIf"],["mat-raised-button","",1,"bg-crediblue-50","text-white","px-6","py-2","rounded-md","w-full",3,"click"],["label","Verifica informaci\xF3n",3,"stepControl"],[1,"w-full","h-full","px-4"],[1,"flex","flex-row","gap-2.5"],["matInput","",3,"formControlName","disabled"],[1,"flex","flex-row"],[3,"selectionChange","formControlName"],[4,"ngFor","ngForOf"],[1,"flex","justify-end","gap-2.5"],["mat-button","","matStepperPrevious","",1,"bg-gray-500","text-white","py-2","px-4","rounded","hover:bg-gray-600"],["mat-button","","matStepperNext","",1,"bg-crediblue-50","text-white","py-2","px-4","rounded",3,"disabled"],["label","Completar compra",3,"stepControl"],[1,"flex","flex-row","items-baseline","gap-2.5"],["matInput","",3,"formControlName"],["matInput","","type","number",3,"min","max","formControlName"],[3,"selectionChange"],["matInput","","placeholder","Detalle",3,"formControlName"],["mat-button","",1,"bg-crediblue-50","text-white","py-2","px-4","rounded",3,"click","disabled"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mb-4",3,"appearance","showIcon","type"]],template:function(a,r){if(a&1){let c=M();m(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5),l(4),e(),m(5,"mat-horizontal-stepper",6,0)(7,"mat-step",7)(8,"div",8)(9,"form",9)(10,"mat-form-field",10)(11,"mat-label"),l(12,"Tipo de documento"),e(),m(13,"mat-select",11),f(14,ke,2,1,"ng-container",12),x(15,"async"),e()(),m(16,"mat-form-field",10)(17,"mat-label"),l(18,"N\xFAmero de identificaci\xF3n"),e(),d(19,"input",13),e(),f(20,Oe,2,5,"fuse-alert",14),m(21,"button",15),y("click",function(){return h(c),b(r.onSearch())}),l(22,"Consultar"),e()()()(),m(23,"mat-step",16)(24,"div",17)(25,"form",9)(26,"div",18)(27,"mat-form-field",10)(28,"mat-label"),l(29,"Primer nombre"),e(),d(30,"input",19),e(),m(31,"mat-form-field",10)(32,"mat-label"),l(33,"Segundo nombre"),e(),d(34,"input",19),e()(),m(35,"div",18)(36,"mat-form-field",10)(37,"mat-label"),l(38,"Primer apellido"),e(),d(39,"input",19),e(),m(40,"mat-form-field",10)(41,"mat-label"),l(42,"Segundo apellido"),e(),d(43,"input",19),e()(),m(44,"div",18)(45,"mat-form-field",10)(46,"mat-label"),l(47,"Identificaci\xF3n"),e(),d(48,"input",19),e(),m(49,"mat-form-field",10)(50,"mat-label"),l(51,"Email"),e(),d(52,"input",19),e()(),m(53,"div",20)(54,"mat-form-field",10)(55,"mat-label"),l(56,"Cr\xE9ditos"),e(),m(57,"mat-select",21),y("selectionChange",function(C){return h(c),b(r.selected(C))}),f(58,je,3,2,"ng-container",22),e()()()(),m(59,"div",23)(60,"button",24),l(61,"Anterior"),e(),m(62,"button",25),l(63,"Siguiente"),e()()()(),m(64,"mat-step",26)(65,"div",17)(66,"form",9)(67,"div",27)(68,"mat-form-field",10)(69,"mat-label"),l(70,"N\xFAmero de factura"),e(),d(71,"input",28),e()(),m(72,"div",18)(73,"mat-form-field",10)(74,"mat-label"),l(75,"Valor $"),e(),d(76,"input",28),f(77,$e,2,0,"mat-error",12)(78,Pe,2,0,"mat-error",12),e(),m(79,"mat-form-field",10)(80,"mat-label"),l(81,"Cantidad de cuotas"),e(),d(82,"input",29),e()(),m(83,"div",18)(84,"mat-form-field",10)(85,"mat-label"),l(86,"Departamento"),e(),m(87,"mat-select",30,1),y("selectionChange",function(C){return h(c),b(r.getMunicipios(C))}),f(89,Be,2,1,"ng-container",12),x(90,"async"),e()(),m(91,"mat-form-field",10)(92,"mat-label"),l(93,"Ciudad"),e(),m(94,"mat-select",11),f(95,Qe,2,1,"ng-container",12),x(96,"async"),e()()(),m(97,"div",18)(98,"mat-form-field",10)(99,"mat-label"),l(100,"Observaci\xF3nes"),e(),d(101,"textarea",31),e()()(),m(102,"div",23)(103,"button",32),y("click",function(){return h(c),b(r.onSave())}),l(104,"Guardar"),e()()()()()()()()}a&2&&(t(4),I(" ","Detalle consumo"," "),t(),o("linear",!0),t(2),o("stepControl",r.firstFormGroup),t(2),o("formGroup",r.firstFormGroup),t(4),o("formControlName","idTipoDoc"),t(),o("ngIf",D(15,39,r.tiposDocumentos$)),t(5),o("formControlName","numDocumento"),t(),o("ngIf",r.showAlert),t(3),o("stepControl",r.secondFormGroup),t(2),o("formGroup",r.secondFormGroup),t(5),o("formControlName","primerNombre")("disabled",!0),t(4),o("formControlName","segundoNombre")("disabled",!0),t(5),o("formControlName","primerApellido")("disabled",!0),t(4),o("formControlName","segundoApellido")("disabled",!0),t(5),o("formControlName","numDoc")("disabled",!0),t(4),o("formControlName","correo")("disabled",!0),t(5),o("formControlName","idCredito"),t(),o("ngForOf",r.creditos),t(4),o("disabled",r.secondFormGroup.invalid),t(2),o("stepControl",r.thirdFormGroup),t(2),o("formGroup",r.thirdFormGroup),t(5),o("formControlName","numeroFactura"),t(5),o("formControlName","montoConsumo"),t(),o("ngIf",(r.montoConsumo.touched||r.montoConsumo.dirty)&&r.montoConsumo.hasError("required")),t(),o("ngIf",(r.montoConsumo.touched||r.montoConsumo.dirty)&&r.montoConsumo.hasError("notEqual")),t(4),o("min",1)("max",6)("formControlName","cantidadCuotas"),t(7),o("ngIf",D(90,41,r.departamentos$)),t(5),o("formControlName","idMunicipio"),t(),o("ngIf",D(96,43,r.municipios$)),t(6),o("formControlName","detalleCompra"),t(2),o("disabled",r.thirdFormGroup.invalid))},dependencies:[xe,Ee,ce,ae,ie,me,re,ne,de,se,Y,ve,U,Z,De,L,J,ge,R,B,fe,le,pe,K,Ne,Ce,X],data:{animation:oe}});let i=n;return i})();function We(i){return n=>{let p=n.value;return console.log(i),p>i?{notEqual:!0}:null}}var Nt=[{path:"",component:Ae}];export{Nt as default};
