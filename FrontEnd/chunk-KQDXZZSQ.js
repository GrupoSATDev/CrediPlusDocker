import{a as Oe}from"./chunk-QJU4DVOE.js";import{a as Le}from"./chunk-J5YVPVXL.js";import{a as ke,b as qe,c as $e,d as Re}from"./chunk-2OFUQXXR.js";import{a as Be}from"./chunk-GUF3DJBX.js";import{a as Pe}from"./chunk-XCQZU6BO.js";import{a as Me}from"./chunk-55J6ZGSO.js";import{a as je}from"./chunk-7VTUMBBX.js";import{a as Ae}from"./chunk-VLEWZMTC.js";import{a as Ge,b as Ie}from"./chunk-TFDOLS6Y.js";import{a as De}from"./chunk-VHYFJZTV.js";import{a as Ve}from"./chunk-NSEYXXXF.js";import{a as Ne}from"./chunk-CFZYBQXS.js";import{a as we}from"./chunk-4WJQLHI3.js";import{a as Te}from"./chunk-I6O77O5V.js";import{a as Ee}from"./chunk-LY2DLABR.js";import{g as de}from"./chunk-KAGG2YQO.js";import"./chunk-QQ53EZKV.js";import{h as ne}from"./chunk-M3FFSLWT.js";import{a as _e}from"./chunk-3E574AHG.js";import{a as Fe}from"./chunk-4REW3KCM.js";import"./chunk-SPLWJYWR.js";import{C as be,E as xe,F as Se,J as ye,b as ae,c as me,i as le,l as ce,n as c,p as fe,q as Ce,u as ve,x as he,y as ge}from"./chunk-TY3VSE3A.js";import{$ as re,Q as oe,R as ie,ea as se}from"./chunk-3AUPHK2F.js";import{a as ue}from"./chunk-6NAFBUMG.js";import"./chunk-DQGOCNTQ.js";import{a as pe}from"./chunk-CLAKJPOP.js";import{d as te}from"./chunk-LGDPLF3U.js";import{Bc as Y,Cb as F,Cc as D,Ea as P,Eb as g,Fc as Z,Ib as O,Jb as L,Kb as Q,Lc as ee,Mb as n,Nb as C,Ob as V,Qa as o,Ub as U,Vb as z,X as $,Yb as H,_ as T,ba as R,bc as b,cc as E,dc as J,ga as N,gb as f,ha as p,ib as m,l as S,ma as B,pb as h,q as k,tb as r,ub as e,vb as u,wa as y,wb as A,xa as _,xb as G,xc as W,yc as K,z as q,zb as I,zc as X}from"./chunk-SBESXTFM.js";import{a as w,d as j}from"./chunk-NEB6MB4Y.js";var Qe=(()=>{let l=class l{constructor(s,t){this._http=s,this.appSettingService=t}getTipoConsumos(){return this._http.get(this.appSettingService.tipoConsumos.url.base)}getTipoConsumo(s){return this._http.get(`${this.appSettingService.tipoConsumos.url.base}/${s}`)}};l.\u0275fac=function(t){return new(t||l)(N(ee),N(pe))},l.\u0275prov=R({token:l,factory:l.\u0275fac,providedIn:"root"});let i=l;return i})();var We=["stepper"],Ke=(i,l)=>({"bg-crediblue-50":i,"bg-credigray-100":l});function Xe(i,l){if(i&1&&(r(0,"mat-option",33),n(1),e()),i&2){let d=l.$implicit;m("value",d.id),o(),C(d.nombre)}}function Ye(i,l){if(i&1&&(A(0),f(1,Xe,2,2,"mat-option",32),G()),i&2){let d=l.ngIf;o(),m("ngForOf",d.data)}}function Ze(i,l){i&1&&n(0," El n\xFAmero de identificaci\xF3n es requerido!. ")}function et(i,l){i&1&&n(0," Solo se permiten n\xFAmeros. ")}function tt(i,l){if(i&1&&(r(0,"mat-error"),f(1,Ze,1,0)(2,et,1,0),e()),i&2){let d=g();o(),h(d.firstFormGroup.get("numDocumento").hasError("required")?1:-1),o(),h(d.firstFormGroup.get("numDocumento").hasError("pattern")?2:-1)}}function ot(i,l){if(i&1&&(r(0,"fuse-alert",34),n(1),e()),i&2){let d=g();m("appearance","outline")("showIcon",!1)("type",d.alert.type)("@shake",d.alert.type==="error"),o(),V(" ",d.alert.message," ")}}function it(i,l){if(i&1&&(r(0,"mat-option",33),n(1),e()),i&2){let d=l.$implicit;m("value",d.id),o(),C(d.nombre)}}function rt(i,l){if(i&1&&(A(0),f(1,it,2,2,"mat-option",32),G()),i&2){let d=l.ngIf;o(),m("ngForOf",d.data)}}function nt(i,l){i&1&&(r(0,"mat-error"),n(1,"El valor es requerido!"),e())}function at(i,l){i&1&&(r(0,"mat-error"),n(1,"El valor ingresado no puede superar el cupo disponible!"),e())}function mt(i,l){i&1&&(r(0,"span"),n(1," Recargar "),e())}function lt(i,l){i&1&&u(0,"mat-progress-spinner",49),i&2&&m("diameter",24)("mode","indeterminate")}function st(i,l){if(i&1){let d=I();r(0,"div",35)(1,"div",36)(2,"div",37)(3,"h2",38),n(4,"Resumen de la Compra"),e(),r(5,"p",39),n(6,"Revise los detalles"),e()(),r(7,"div",40)(8,"div",41)(9,"div")(10,"h3",42),n(11,"Fecha de compra"),e()(),r(12,"p",43),n(13),b(14,"date"),e()(),r(15,"div",41)(16,"div")(17,"h3",42),n(18,"N\xFAmero de factura"),e()(),r(19,"p",43),n(20),e()(),r(21,"div",41)(22,"div")(23,"h3",42),n(24,"Valor"),e()(),r(25,"p",43),n(26),b(27,"currency"),e()(),r(28,"div",44)(29,"p",42),n(30,"N\xFAmero de cuotas"),e(),r(31,"p",43),n(32),e()(),r(33,"div",45)(34,"p",42),n(35,"Estado"),e(),r(36,"p",43),n(37),e()(),r(38,"div",46)(39,"p",42),n(40,"Detalle compra"),e(),r(41,"p",43),n(42),e()()(),r(43,"div",47)(44,"button",48),F("click",function(){y(d);let t=g();return _(t.onUpdate())}),f(45,mt,2,0,"span")(46,lt,1,2,"mat-progress-spinner",49),e()()()()}if(i&2){let d=g();o(13),C(J(14,9,d.detaleConsumo.fechaCreacion,"dd/MM/yyyy")),o(7),C(d.detaleConsumo.numeroFactura),o(6),C(E(27,12,d.detaleConsumo.montoConsumo)),o(6),C(d.detaleConsumo.cantidadCuotas),o(5),C(d.detaleConsumo.nombreEstadoCredito),o(5),C(d.detaleConsumo.detalleCompra),o(2),m("disabled",d.isButtonDisabled),o(),h(d.isButtonDisabled?-1:45),o(),h(d.isButtonDisabled?46:-1)}}var dt={validation:!1},Ue=(()=>{let l=class l{constructor(){this.tiposDocumentosService=p(Me),this.fuseService=p(de),this.estadosDatosService=p(Te),this.toasService=p(Ne),this.empleadosServices=p(Be),this.tipoConsumosService=p(Qe),this.cuentasServices=p(Le),this.datePipe=p(D),this.router=p(te),this.fb=p(be),this._locacionService=p(De),this.detalleConsumo=p(Pe),this.departamentos$=this._locacionService.getDepartamentos(),this.tipoConsumo$=this.tipoConsumosService.getTipoConsumos().pipe(k(s=>(s.data=s.data.filter(t=>t.nombre!=="Avance"),s)),T(s=>{let t=s.data[0];t&&this.thirdFormGroup.get("idTipoConsumo").setValue(t.id)})),this.cuentas$=this.cuentasServices.getCuentas(),this.swalService=p(Ve),this.showAlert=!1,this.alert={type:"success",message:""},this.destroyedRef=p(P),this.tiposDocumentos$=this.tiposDocumentosService.getTiposDocumentos().pipe(T(s=>{let t=s.data[3];t&&this.firstFormGroup.get("idTipoDoc").setValue(t.id)})),this.empleado$=this.empleadosServices.getValidaInfo(),this.creditos=[],this.isButtonDisabled=!1,this.focus=focus,this.FormatoOptionsPipe=Oe}ngOnDestroy(){}ngOnInit(){this.createForm()}getMunicipios(s){let t=s.value;this.municipios$=this._locacionService.getMunicipio(t)}selected(s){let t=s.value;this.compareValor=t.cupoDisponible,this.thirdFormGroup.get("montoConsumo").setValidators(pt(this.compareValor)),this.thirdFormGroup.get("montoConsumo").updateValueAndValidity()}compareWithConstants(s){let t=s.value,a=this.secondFormGroup.get("idCredito")?.value;return!a||!a.montoConsumo?(console.error("No se encontr\xF3 el objeto idCredito o montoConsumo"),S(null)):(console.log(t),console.log(a.montoConsumo),t>a.montoConsumo?S({notEqual:!0}):S(null))}get montoConsumo(){return this.thirdFormGroup.get("montoConsumo")}onSearch(){let s=this.firstFormGroup.getRawValue();this.empleadosServices.getEmpleadoParams(s).subscribe(t=>{if(t){this.showAlert=!1;let a={numDoc:t.data.numDoc,primerNombre:t.data.primerNombre,segundoNombre:t.data.segundoNombre,primerApellido:t.data.primerApellido,segundoApellido:t.data.segundoApellido,idTrabajador:t.data.id,correo:t.data.correo,credito:t.data.creditos[0].numCredito+" - "+t.data.creditos[0].cupoDisponible,idCredito:t.data.creditos[0].id};this.secondFormGroup.patchValue(a),this.creditos=t.data.creditos,setTimeout(()=>{this.stepper.next()},1200)}},t=>{this.alert={type:"error",message:"El trabajador no existe!"},this.showAlert=!0})}onSave(){if(this.thirdFormGroup.valid){let s=this.thirdFormGroup.getRawValue(),{montoConsumo:t}=s,a=j(s,["montoConsumo"]),{idCredito:v,idTrabajador:x}=this.secondFormGroup.getRawValue(),ze=w({idCredito:v,idTrabajador:x,montoConsumo:Number(t)},a);this.fuseService.open(w({},we)).afterClosed().subscribe(He=>{He==="confirmed"&&this.detalleConsumo.postDetalle(ze).subscribe(M=>{console.log(M),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.getResumenCompra(x)},M=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})})})}}getResumenCompra(s){this.subscription$=this.detalleConsumo.getResumen(s).subscribe(t=>{t&&(console.log(t),this.detaleConsumo=t.data,this.stepper.next())})}onUpdate(){this.isButtonDisabled||(this.isButtonDisabled=!0,this.detalleSubscription$&&this.detalleSubscription$.unsubscribe(),this.detalleSubscription$=q(1e4).pipe(je(this.destroyedRef),$(()=>this.detalleConsumo.getConsumoTrabajador(this.detaleConsumo.idTrabajador))).subscribe(s=>{console.log(s),s.data.nombreEstadoCredito=="Aprobado"&&(this.detaleConsumo=s.data,this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),setTimeout(()=>{this.router.navigate(["pages/gestion-creditos/consumos"])},5e3))}),setTimeout(()=>{this.isButtonDisabled=!1},1e4))}createForm(){this.firstFormGroup=this.fb.group({idTipoDoc:[""],numDocumento:["",[c.required,c.pattern("^[0-9]*$")]]}),this.secondFormGroup=this.fb.group({numDoc:["",c.required],primerNombre:["",c.required],segundoNombre:[""],primerApellido:["",c.required],segundoApellido:[""],idTrabajador:[""],correo:["",c.required],credito:["",c.required],idCredito:["",c.required]}),this.thirdFormGroup=this.fb.group({montoConsumo:["",[c.required]],numeroFactura:["",c.required],idTipoConsumo:["",c.required]})}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=B({type:l,selectors:[["app-form-detalle-consumo"]],viewQuery:function(t,a){if(t&1&&O(We,5),t&2){let v;L(v=Q())&&(a.stepper=v.first)}},standalone:!0,features:[U([{provide:ie,useClass:Ae},{provide:oe,useValue:"en-GB"},D,Ge(dt)]),z],decls:93,vars:49,consts:[["stepper",""],["data",""],["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","items-center","overflow-y-auto","bg-gray-100","p-6","sm:p-8"],[1,"relative","w-full","flex-0","max-w-4xl","sm:rounded-lg","overflow-hidden"],[1,"p-2","text-3xl","font-semibold","text-center","text-gray-800"],[1,"w-full","px-6","py-4",3,"orientation","linear","animationDuration"],["label","Consultar trabajador",3,"stepControl"],[1,"flex","flex-col","items-center","w-full"],[1,"space-y-4","w-full","max-w-sm",3,"formGroup"],[1,"w-full"],[3,"formControlName"],[4,"ngIf"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","Ingrese identificaci\xF3n",3,"formControlName"],["class","mb-4",3,"appearance","showIcon","type",4,"ngIf"],["mat-raised-button","",1,"text-white","px-6","py-2","rounded-md","w-full",3,"click","disabled","ngClass"],["label","Verificar informaci\xF3n",3,"stepControl"],[1,"space-y-4","w-full","max-w-lg","mx-auto",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-4"],["matInput","",3,"formControlName","readonly"],[1,"flex","flex-col"],[1,"flex","flex-wrap","justify-center","sm:justify-center","gap-4","mt-2"],["mat-button","","matStepperPrevious","",1,"sm:w-auto","w-full","bg-gray-500","text-white","py-2","px-4","rounded","hover:bg-gray-600"],["mat-button","","matStepperNext","",1,"sm:w-auto","w-full","bg-crediblue-50","text-white","py-2","px-4","rounded",3,"disabled"],["label","Completar compra",3,"stepControl"],[1,"w-full","h-full","p-4","sm:p-8"],["matInput","","placeholder","N\xFAmero de factura",3,"formControlName"],["placeholder","Tipo de consumo",3,"formControlName"],["matInput","","thousandSeparator",".","placeholder","Valor",3,"formControlName","mask"],["mat-button","",1,"sm:w-auto","w-full","bg-crediblue-50","text-white","py-2","px-4","rounded",3,"click","disabled"],["label","Resumen de compra",3,"stepControl"],["class","w-full h-full px-4",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mb-4",3,"appearance","showIcon","type"],[1,"w-full","h-full","px-4"],[1,"max-w-2xl","mx-auto","p-4","bg-white","shadow-lg","rounded-lg"],[1,"border-b","pb-4","mb-4"],[1,"text-2xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-500"],[1,"space-y-4"],[1,"flex","justify-between","items-center","border-b","pb-2"],[1,"text-lg","font-semibold","text-gray-700"],[1,"text-lg","font-bold","text-gray-800"],[1,"flex","justify-between","items-center","pt-4","border-t"],[1,"flex","justify-between","items-center"],[1,"flex","justify-between","items-center","border-t","pt-4"],[1,"mt-6"],["mat-flat-button","",1,"w-full","bg-crediblue-50","text-white","py-2","px-4","rounded-lg",3,"click","disabled"],[3,"diameter","mode"]],template:function(t,a){if(t&1){let v=I();r(0,"div",2)(1,"div",3)(2,"div",4),n(3),e(),r(4,"mat-stepper",5,0)(6,"mat-step",6)(7,"div",7)(8,"form",8)(9,"mat-form-field",9)(10,"mat-label"),n(11,"Tipo de documento"),e(),r(12,"mat-select",10),f(13,Ye,2,1,"ng-container",11),b(14,"async"),e()(),r(15,"mat-form-field",12)(16,"mat-label"),n(17,"N\xFAmero de identificaci\xF3n"),e(),u(18,"input",13),f(19,tt,3,2,"mat-error"),e(),f(20,ot,2,5,"fuse-alert",14),r(21,"button",15),F("click",function(){return y(v),_(a.onSearch())}),n(22,"Consultar"),e()()()(),r(23,"mat-step",16)(24,"div",9)(25,"form",17)(26,"div",18)(27,"mat-form-field",9)(28,"mat-label"),n(29,"Primer nombre"),e(),u(30,"input",19),e(),r(31,"mat-form-field",9)(32,"mat-label"),n(33,"Segundo nombre"),e(),u(34,"input",19),e()(),r(35,"div",18)(36,"mat-form-field",9)(37,"mat-label"),n(38,"Primer apellido"),e(),u(39,"input",19),e(),r(40,"mat-form-field",9)(41,"mat-label"),n(42,"Segundo apellido"),e(),u(43,"input",19),e()(),r(44,"div",18)(45,"mat-form-field",9)(46,"mat-label"),n(47,"Identificaci\xF3n"),e(),u(48,"input",19),e(),r(49,"mat-form-field",9)(50,"mat-label"),n(51,"Email"),e(),u(52,"input",19),e()(),r(53,"div",20)(54,"mat-form-field",9)(55,"mat-label"),n(56,"Cr\xE9dito"),e(),u(57,"input",19),e()()(),r(58,"div",21)(59,"button",22),n(60,"Anterior"),e(),r(61,"button",23),n(62,"Siguiente"),e()()()(),r(63,"mat-step",24)(64,"div",25)(65,"form",17)(66,"div",20)(67,"mat-form-field",12)(68,"mat-label"),n(69,"N\xFAmero de factura"),e(),u(70,"input",26),e()(),r(71,"div",18)(72,"mat-form-field",12)(73,"mat-label"),n(74,"Tipo consumo"),e(),r(75,"mat-select",27,1),f(77,rt,2,1,"ng-container",11),b(78,"async"),e()()(),r(79,"div",20)(80,"mat-form-field",12)(81,"mat-label"),n(82,"Valor"),e(),u(83,"input",28),f(84,nt,2,0,"mat-error",11)(85,at,2,0,"mat-error",11),e()()(),r(86,"div",21)(87,"button",22),n(88,"Anterior"),e(),r(89,"button",29),F("click",function(){return y(v),_(a.onSave())}),n(90,"Pagar"),e()()()(),r(91,"mat-step",30),f(92,st,47,14,"div",31),e()()()()}t&2&&(o(3),V(" ","Detalle consumo"," "),o(),m("orientation","vertical")("linear",!0)("animationDuration","1500"),o(2),m("stepControl",a.firstFormGroup),o(2),m("formGroup",a.firstFormGroup),o(4),m("formControlName","idTipoDoc"),o(),m("ngIf",E(14,42,a.tiposDocumentos$)),o(5),m("formControlName","numDocumento"),o(),h(a.firstFormGroup.get("numDocumento").dirty||a.firstFormGroup.get("numDocumento").touched?19:-1),o(),m("ngIf",a.showAlert),o(),m("disabled",a.firstFormGroup.invalid)("ngClass",H(46,Ke,a.firstFormGroup.valid,a.firstFormGroup.invalid)),o(2),m("stepControl",a.secondFormGroup),o(2),m("formGroup",a.secondFormGroup),o(5),m("formControlName","primerNombre")("readonly",!0),o(4),m("formControlName","segundoNombre")("readonly",!0),o(5),m("formControlName","primerApellido")("readonly",!0),o(4),m("formControlName","segundoApellido")("readonly",!0),o(5),m("formControlName","numDoc")("readonly",!0),o(4),m("formControlName","correo")("readonly",!0),o(5),m("formControlName","credito")("readonly",!0),o(4),m("disabled",a.secondFormGroup.invalid),o(2),m("stepControl",a.thirdFormGroup),o(2),m("formGroup",a.thirdFormGroup),o(5),m("formControlName","numeroFactura"),o(5),m("formControlName","idTipoConsumo"),o(2),m("ngIf",E(78,44,a.tipoConsumo$)),o(6),m("formControlName","montoConsumo")("mask","separator.0"),o(),m("ngIf",(a.montoConsumo.touched||a.montoConsumo.dirty)&&a.montoConsumo.hasError("required")),o(),m("ngIf",(a.montoConsumo.touched||a.montoConsumo.dirty)&&a.montoConsumo.hasError("notEqual")),o(4),m("disabled",a.thirdFormGroup.invalid),o(2),m("stepControl",a.thirdFormGroup),o(),m("ngIf",a.detaleConsumo))},dependencies:[qe,ke,xe,ve,ce,fe,Ce,le,ye,ae,se,me,$e,Y,re,Ee,K,X,Se,he,ge,ne,Re,Fe,Z,D,W,Ie,_e],data:{animation:ue}});let i=l;return i})();function pt(i){return l=>{let d=l.value;return console.log(i),d>i?{notEqual:!0}:null}}var eo=[{path:"",component:Ue}];export{eo as default};
