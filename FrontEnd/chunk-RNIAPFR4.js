import{a as ke}from"./chunk-WT6G5RL2.js";import{a as Fe}from"./chunk-7SOELBQH.js";import{a as Ee}from"./chunk-3XMKQ74T.js";import{a as Te,b as je,c as _e}from"./chunk-YRZHMDGJ.js";import{a as De}from"./chunk-FIT6CNEK.js";import{a as Me}from"./chunk-TRVR57AA.js";import{a as A}from"./chunk-YMBTTIVN.js";import{b as we}from"./chunk-5ZCUS56W.js";import{a as N}from"./chunk-MO2NC6JB.js";import{a as Pe}from"./chunk-H5OWTWVS.js";import"./chunk-3EEAMLKT.js";import{g as ce}from"./chunk-45VFWK2F.js";import{c as se}from"./chunk-3F72AFMB.js";import"./chunk-T4J43FBS.js";import{a as Ce}from"./chunk-T6KI2TP3.js";import"./chunk-C2OGGKTO.js";import{B as xe,C as Se,G as I,b as le,e as me,i as M,l as fe,n as R,p as ue,q as ge,u as be,w as he,x as ve,z as ye}from"./chunk-JBQZ6BPD.js";import{$ as ne,Q as ie,R as re,ea as k,ja as pe}from"./chunk-SUQ5NR2B.js";import"./chunk-7ZG6LO6Q.js";import"./chunk-TO3CLTNT.js";import{a as de}from"./chunk-CLM77PYI.js";import{d as D}from"./chunk-FVVJ54UE.js";import{e as Z,f as ee,g as te,i as ae,j as y,l as $,m as u,s as oe}from"./chunk-SQ7M4XTP.js";import{$b as F,Db as r,Eb as s,Fb as f,Gb as K,Hb as Q,Jb as W,Pb as b,Rb as h,Y as H,Yb as X,Zb as l,_a as n,_b as _,aa as J,ec as E,fa as B,fc as v,ga as p,ic as Y,la as g,nc as P,oc as w,q,qb as S,sb as m,va as T,wa as j,zb as C}from"./chunk-RICNMTJI.js";import{a as O,b as U}from"./chunk-NEB6MB4Y.js";var V=(()=>{let a=class a{constructor(i,t){this._http=i,this.appSettings=t}getPagosTrabajadores(){return this._http.get(`${this.appSettings.pagoTrabajadores.url.base}/Tabla`)}postPagosTrabajadores(i){return this._http.post(this.appSettings.pagoTrabajadores.url.base,i)}getPagosTrabajador(i){return this._http.get(`${this.appSettings.pagoTrabajadores.url.base}/${i}`)}};a.\u0275fac=function(t){return new(t||a)(B(oe),B(de))},a.\u0275prov=J({token:a,factory:a.\u0275fac,providedIn:"root"});let o=a;return o})();var Ie=(()=>{let a=class a{constructor(){this.datePipe=p(y),this.currencyPipe=p(u),this.pagoTrabajadorService=p(V),this._matDialog=p(se),this.estadoDatosService=p(N),this.router=p(D),this.data=[],this.columns=["Creaci\xF3n","Empresa","Total"],this.columnPropertyMap={Creaci\u00F3n:"fechaCreacion",Empresa:"nombreSubempresa",Total:"total"},this.buttons=[{label:"Eye",icon:"visibility",action:i=>{console.log("Editing",i),this.router.navigate(["/pages/gestion-cobros/trabajadores/pago/",i.id])}}]}ngOnDestroy(){}ngOnInit(){this.getPagoTrabajadores(),this.listenGrid()}onNew(){this.router.navigate(["/pages/gestion-cobros/trabajadores/pago"])}getPagoTrabajadores(){this.pagoTrabajadorService.getPagosTrabajadores().pipe(H(i=>(i.data.forEach(t=>{t.fechaCreacion=this.datePipe.transform(t.fechaCreacion,"dd/MM/yyyy"),t.total=this.currencyPipe.transform(t.total,"USD","symbol","1.2-2")}),i))).subscribe(i=>{this.data=i.data})}listenGrid(){this.estadoDatosService.stateGrid.asObservable().subscribe(t=>{t&&this.getPagoTrabajadores()})}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=g({type:a,selectors:[["app-grid-pago-trabajadores"]],standalone:!0,features:[E([y,u]),v],decls:15,vars:11,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons"]],template:function(t,e){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),l(3,"Pago trabajadores"),s(),r(4,"div",3)(5,"mat-form-field",4),f(6,"mat-icon",5)(7,"input",6),s(),r(8,"button",7),b("click",function(){return e.onNew()}),f(9,"mat-icon",8),r(10,"span",9),l(11,"Pagar"),s()()()(),r(12,"div",10)(13,"div",11),f(14,"app-custom-table",12),s()()()),t&2&&(n(5),m("subscriptSizing","dynamic"),n(),m("svgIcon","heroicons_solid:magnifying-glass"),n(),m("autocomplete","off")("placeholder","Buscar"),n(),m("color","primary"),n(),m("svgIcon","heroicons_outline:plus"),n(5),m("columns",e.columns)("displayedColumns",e.columns)("columnPropertyMap",e.columnPropertyMap)("data",e.data)("buttons",e.buttons))},dependencies:[A,k,M,pe,I]});let o=a;return o})();var Ve=(o,a)=>({"bg-credigray-100":o,"bg-green-600":a});function Ge(o,a){if(o&1&&(r(0,"mat-option",23),l(1),s()),o&2){let c=a.$implicit;m("value",c.id),n(),_(c.razonSocial)}}function Oe(o,a){if(o&1&&(K(0),S(1,Ge,2,2,"mat-option",22),Q()),o&2){let c=a.ngIf;n(),m("ngForOf",c.data)}}function Be(o,a){if(o&1&&(r(0,"div",18)(1,"div",24),f(2,"app-custom-table",25),s()()),o&2){let c=h();n(2),m("columns",c.columns)("displayedColumns",c.columns)("columnPropertyMap",c.columnPropertyMap)("data",c.data)}}function $e(o,a){if(o&1&&(r(0,"div",19)(1,"div",26)(2,"fuse-alert",27)(3,"span",28),l(4,"Informaci\xF3n"),s(),l(5),s()()()),o&2){let c=h();n(2),m("type","info")("appearance","outline"),n(3),F(" ",c.message," ")}}function Re(o,a){if(o&1&&(r(0,"span",21),l(1,"Subtotal: "),r(2,"span",29),l(3),P(4,"currency"),s()()),o&2){let c=h();n(3),_(w(4,1,c.subtotal))}}function ze(o,a){if(o&1&&(r(0,"span",21),l(1,"Comisiones: "),r(2,"span",29),l(3),P(4,"currency"),s()()),o&2){let c=h();n(3),_(w(4,1,c.totalComision))}}function Le(o,a){if(o&1&&(r(0,"span",21),l(1,"Total a pagar: "),r(2,"span",29),l(3),P(4,"currency"),s()()),o&2){let c=h();n(3),F(" ",w(4,1,c.totalPagar)," ")}}var Ue={validation:!1},Ae=(()=>{let a=class a{constructor(){this.fb=p(ye),this.empresaClienteService=p(Fe),this.pagoTrabajadorService=p(V),this.cobroTrabajadorService=p(ke),this.datePipe=p(y),this.swalService=p(Me),this.estadosDatosService=p(N),this.fuseService=p(ce),this.currencyPipe=p(u),this.decimalPipe=p($),this.router=p(D),this.empresa$=this.empresaClienteService.getEmpresasClientes(),this.data=[],this.columns=["N\xFAmero de factura","Porcentaje","Valor","Comision","Total a Pagar"],this.columnPropertyMap={"N\xFAmero de factura":"numeroFactura",Porcentaje:"porcentajeSubEmpresa",Valor:"montoConsumo",Comision:"comision","Total a Pagar":"pagar"}}createForm(){this.form=this.fb.group({fechaFinal:["",R.required],idSubEmpresa:["",R.required]})}ngOnInit(){this.createForm()}closeDialog(){this.router.navigate(["/pages/gestion-cobros/trabajadores"])}onGet(){if(this.form.valid){let{fechaFinal:i,idSubEmpresa:t}=this.form.getRawValue();console.log(i);let d={fechaFinallData:this.datePipe.transform(i,"yyyy-MM-dd"),idSubEmpresa:t};this.getAllPagoTrabajador(d)}}onSave(){let{fechaFinal:i,idSubEmpresa:t}=this.form.getRawValue(),d={fechaFinal:this.datePipe.transform(i,"yyyy-MM-dd"),idSubEmpresa:t},x=[];x=this.data.map(G=>({idDetalleConsumo:G.id}));let L=U(O({},d),{detallePagoAliado:x});console.log(L),this.fuseService.open(O({},we)).afterClosed().subscribe(G=>{G==="confirmed"&&this.postSave(L)})}getAllPagoTrabajador(i){this.cobroTrabajadorService.getCobroTrabajador(i).pipe(q(t=>(this.subtotal=0,this.totalComision=0,this.totalPagar=0,t&&Array.isArray(t.data)?t.data.forEach(e=>{e.comision=e.montoConsumo*e.porcentajeSubEmpresa/100,e.pagar=e.montoConsumo-e.comision,e.montoConsumo=this.currencyPipe.transform(e.montoConsumo,"USD","symbol","1.2-2"),e.comision=this.currencyPipe.transform(e.comision,"USD","symbol","1.2-2"),e.pagar=this.currencyPipe.transform(e.pagar,"USD","symbol","1.2-2"),e.porcentajeSubEmpresa=this.decimalPipe.transform(e.porcentajeSubEmpresa,"1.2-2")+"%",this.subtotal+=parseFloat(e.montoConsumo.replace(/[^0-9.-]+/g,"")),this.totalComision+=parseFloat(e.comision.replace(/[^0-9.-]+/g,"")),this.totalPagar+=parseFloat(e.pagar.replace(/[^0-9.-]+/g,""))}):this.data=[],t))).subscribe(t=>{t&&Array.isArray(t.data)?this.data=t.data:(this.data=[],this.message=t.msg)})}postSave(i){this.pagoTrabajadorService.postPagosTrabajadores(i).subscribe(t=>{this.swalService.ToastAler({icon:"success",title:"Registro creado con exito!",timer:4e3}),this.estadosDatosService.stateGrid.next(!0),this.closeDialog()},t=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})})}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=g({type:a,selectors:[["app-form-pago-trabajadores"]],standalone:!0,features:[E([{provide:re,useClass:Ee},{provide:ie,useValue:"en-GB"},y,u,$,De(Ue)]),v],decls:39,vars:20,consts:[["finalPicker",""],[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","sm:flex-row","md:px-8"],[1,"mt-6","w-full","shrink-0","sm:mt-0","sm:space-x-2","lg:w-full"],[1,"mt-8",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","dd/mm/yyyy",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],["placeholder","Empresa",3,"formControlName"],[4,"ngIf"],[1,"relative","p-4","border","border-gray-300","rounded-lg","mt-4"],[1,"absolute","-top-3","left-4","bg-white","px-2","text-gray-500","font-semibold"],[1,"flex","flex-wrap","justify-end","gap-2.5","sm:mb-4"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","sm:mt-6","transition","duration-200","text-white","font-semibold","rounded-lg","md:w-auto",3,"click","ngClass","disabled"],[1,"flex","flex-auto","overflow-hidden"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"flex","flex-col","gap-4","justify-end","sm:flex-row"],[1,"sm:pr-4","text-gray-600","font-bold","text-right"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:p-4","sm:mb-10","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data"],[1,"inline-block","p-4","sm:p-8","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""],[1,"text-gray-800"]],template:function(t,e){if(t&1){let d=W();r(0,"div",1)(1,"div",2),l(2),s(),r(3,"div",3)(4,"div",4)(5,"form",5)(6,"div",6)(7,"mat-form-field",7)(8,"mat-label"),l(9,"Fecha de corte"),s(),f(10,"input",8)(11,"mat-datepicker-toggle",9)(12,"mat-datepicker",null,0),s(),r(14,"mat-form-field",7)(15,"mat-label"),l(16,"Empresa"),s(),r(17,"mat-select",10),S(18,Oe,2,1,"ng-container",11),P(19,"async"),s()()(),r(20,"div",12)(21,"div",13),l(22," Opciones "),s(),r(23,"div",14)(24,"button",15),b("click",function(){return T(d),j(e.closeDialog())}),r(25,"span"),l(26," Atras "),s()(),r(27,"button",16),b("click",function(){return T(d),j(e.onGet())}),r(28,"span"),l(29," Consultar "),s()(),r(30,"button",17),b("click",function(){return T(d),j(e.onSave())}),r(31,"span"),l(32," Pagar "),s()()()()()()(),S(33,Be,3,4,"div",18)(34,$e,6,3,"div",19),r(35,"div",20),S(36,Re,5,3,"span",21)(37,ze,5,3,"span",21)(38,Le,5,3,"span",21),s()()}if(t&2){let d=X(13);n(2),F(" ","Pago trabajadores"," "),n(3),m("formGroup",e.form),n(5),m("matDatepicker",d)("formControlName","fechaFinal"),n(),m("for",d),n(6),m("formControlName","idSubEmpresa"),n(),m("ngIf",w(19,15,e.empresa$)),n(6),m("color","primary"),n(3),m("color","primary"),n(3),m("ngClass",Y(17,Ve,e.data.length==0,e.data.length>0))("disabled",e.data.length==0),n(3),C(e.data.length?33:e.message?34:-1),n(3),C(e.subtotal?36:-1),n(),C(e.totalComision?37:-1),n(),C(e.totalPagar?38:-1)}},dependencies:[ae,u,A,xe,be,fe,ue,ge,Ce,k,Te,je,_e,M,I,le,ne,Pe,me,ee,te,Se,he,ve,Z]});let o=a;return o})();var Ne=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=g({type:a,selectors:[["app-form-view-pago-trabajadores"]],standalone:!0,features:[v],decls:2,vars:0,template:function(t,e){t&1&&(r(0,"p"),l(1,"form-view-pago-trabajadores works!"),s())}});let o=a;return o})();var Bt=[{path:"",component:Ie},{path:"pago",component:Ae},{path:"pago:/id",component:Ne}];export{Bt as default};
