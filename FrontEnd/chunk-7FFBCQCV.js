import{a as ye}from"./chunk-BHG4KIJR.js";import{a as xe}from"./chunk-MNKHKPLZ.js";import{a as Fe}from"./chunk-QSZKNMBE.js";import{a as Y}from"./chunk-6IEWE3OU.js";import{a as we}from"./chunk-OFI6PGZL.js";import{a as be}from"./chunk-72OGA3YA.js";import{a as X}from"./chunk-4WJQLHI3.js";import{a as H}from"./chunk-VOLXTRGQ.js";import{a as Ee}from"./chunk-54OZA4EP.js";import{a as Se}from"./chunk-5JKGVM4V.js";import"./chunk-BGM5RQG6.js";import{g as ce}from"./chunk-B24N63ZV.js";import{a as ae,b as re,c as ne}from"./chunk-PG3Z5E5P.js";import"./chunk-P2KBT4CK.js";import{C as _e,E as ve,F as Ce,J as z,b as se,c as me,i as G,l as pe,n as C,p as de,q as ue,u as fe,x as ge,y as he}from"./chunk-XMPVE5LH.js";import{$ as oe,ea as B,ga as le,ja as q}from"./chunk-AAD5V3QY.js";import"./chunk-AUCKEBH6.js";import{a as N}from"./chunk-K4NG4L4V.js";import{Cb as v,Cc as ie,Eb as R,Lb as U,Mb as c,Mc as M,Nb as T,Ob as O,Qa as a,Ra as j,Vb as L,_ as x,ba as y,bc as I,cc as D,ga as S,gb as d,ha as g,ib as n,ma as A,pb as u,q as Q,tb as m,ub as l,vb as f,wa as E,wb as w,xa as b,xb as F,yc as ee,zb as W,zc as te}from"./chunk-YBEOGPR3.js";import{a as $,d as k}from"./chunk-NEB6MB4Y.js";var J=(()=>{let t=class t{constructor(o,i){this._http=o,this.appSettingService=i}getUsuarios(){return this._http.get(`${this.appSettingService.usuarios.url.base}/Table`)}getUsuario(o){return this._http.get(`${this.appSettingService.usuarios.url.base}/Empresa/${o}`)}postUsuarios(o){return delete o.id,this._http.post(`${this.appSettingService.usuarios.url.base}/RegistroEmpresas`,o)}putUsuario(o){let i=o.id;return delete o.id,this._http.put(`${this.appSettingService.usuarios.url.base}/${i}`,o)}};t.\u0275fac=function(i){return new(i||t)(S(M),S(N))},t.\u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Ie=(()=>{let t=class t{constructor(o,i){this._http=o,this.appSettingService=i}getTipoUsuarios(){return this._http.get(`${this.appSettingService.tipoUsuarios.url.base}`)}};t.\u0275fac=function(i){return new(i||t)(S(M),S(N))},t.\u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var De=(()=>{let t=class t{constructor(o,i){this._http=o,this.appSettingService=i}getRoles(){return this._http.get(`${this.appSettingService.roles.url.base}`)}};t.\u0275fac=function(i){return new(i||t)(S(M),S(N))},t.\u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function Ve(e,t){if(e&1){let s=W();m(0,"div",8)(1,"div",27),v("click",function(){E(s);let i=U(5);return b(i.toggle())}),m(2,"div",28),c(3),l()(),f(4,"mat-slide-toggle",29,3),l()}if(e&2){let s=R();a(3),O(" Estado ",s.form.get("estado").value?"Activo":"Inactivo"," "),a(),n("color","primary")("formControlName","estado")}}function $e(e,t){if(e&1&&(m(0,"mat-option",31),c(1),l()),e&2){let s=t.$implicit;n("value",s.id),a(),T(s.nombre)}}function ke(e,t){if(e&1&&(w(0),d(1,$e,2,2,"mat-option",30),F()),e&2){let s=t.ngIf;a(),n("ngForOf",s.data)}}function Ae(e,t){e&1&&f(0,"mat-icon",18),e&2&&n("svgIcon","heroicons_solid:eye")}function je(e,t){e&1&&f(0,"mat-icon",18),e&2&&n("svgIcon","heroicons_solid:eye-slash")}function Re(e,t){e&1&&c(0," La contrase\xF1a es requerida!. ")}function Oe(e,t){e&1&&c(0," El m\xEDnimo de caracteres son 5. ")}function Le(e,t){e&1&&c(0," El maximo de caracteres son 20. ")}function Ge(e,t){if(e&1&&(m(0,"mat-error"),d(1,Re,1,0)(2,Oe,1,0)(3,Le,1,0),l()),e&2){let s=R();a(),u(s.form.get("contrasena").hasError("required")?1:-1),a(),u(s.form.get("contrasena").hasError("minlength")?2:-1),a(),u(s.form.get("contrasena").hasError("maxlength")?3:-1)}}function Be(e,t){e&1&&f(0,"mat-icon",18),e&2&&n("svgIcon","heroicons_solid:eye")}function qe(e,t){e&1&&f(0,"mat-icon",18),e&2&&n("svgIcon","heroicons_solid:eye-slash")}function ze(e,t){e&1&&c(0," La confirmaci\xF3n de contrase\xF1a es requerida!. ")}function He(e,t){e&1&&c(0," El m\xEDnimo de caracteres son 5. ")}function Pe(e,t){e&1&&c(0," El maximo de caracteres son 20. ")}function Je(e,t){e&1&&c(0," Las contrase\xF1as no coinciden! ")}function Ke(e,t){if(e&1&&(m(0,"mat-error"),d(1,ze,1,0)(2,He,1,0)(3,Pe,1,0)(4,Je,1,0),l()),e&2){let s=R();a(),u(s.form.get("confirmaContrasena").hasError("required")?1:-1),a(),u(s.form.get("confirmaContrasena").hasError("minlength")?2:-1),a(),u(s.form.get("confirmaContrasena").hasError("maxlength")?3:-1),a(),u(s.form.get("confirmaContrasena").hasError("passwordMismatchError")?4:-1)}}function Qe(e,t){if(e&1&&(m(0,"mat-option",31),c(1),l()),e&2){let s=t.$implicit;n("value",s.id),a(),T(s.nombre)}}function We(e,t){if(e&1&&(w(0),d(1,Qe,2,2,"mat-option",30),F()),e&2){let s=t.ngIf;a(),n("ngForOf",s.data)}}function Xe(e,t){if(e&1&&(m(0,"mat-option",31),c(1),l()),e&2){let s=t.$implicit;n("value",s.id),a(),T(s.razonSocial)}}function Ye(e,t){if(e&1&&(w(0),d(1,Xe,2,2,"mat-option",30),F()),e&2){let s=t.ngIf;a(),n("ngForOf",s.data)}}function Ze(e,t){if(e&1&&(m(0,"mat-option",31),c(1),l()),e&2){let s=t.$implicit;n("value",s.id),a(),T(s.nombre)}}function et(e,t){if(e&1&&(w(0),d(1,Ze,2,2,"mat-option",30),F()),e&2){let s=t.ngIf;a(),n("ngForOf",s.data)}}function tt(e,t){if(e&1&&(m(0,"mat-option",31),c(1),l()),e&2){let s=t.$implicit;n("value",s.id),a(),T(s.nombre)}}function it(e,t){if(e&1&&(w(0),d(1,tt,2,2,"mat-option",30),F()),e&2){let s=t.ngIf;a(),n("ngForOf",s.data)}}var Z=(()=>{let t=class t{constructor(){this.fb=g(_e),this._locacionService=g(xe),this.dialogRef=g(ae),this.fuseService=g(ce),this.estadosDatosService=g(H),this.usuariosService=g(J),this.tipoUsuariosService=g(Ie),this.empresaClienteService=g(ye),this.rolesService=g(De),this._matData=g(re),this.swalService=g(we),this.departamentos$=this._locacionService.getDepartamentos().pipe(x(o=>{let i=o.data,r=this._matData;if(i&&!r.edit){this.form.get("idDepartamento").setValue(i[0].id);let p=this.form.get("idDepartamento").value;this.getMunicipios(p)}})),this.tipoUsuarios$=this.tipoUsuariosService.getTipoUsuarios().pipe(x(o=>{let i=o.data,r=this._matData;i&&!r.edit&&this.form.get("idTipoUsuario").setValue(i[0].id)})),this.roles$=this.rolesService.getRoles().pipe(x(o=>{let i=o.data,r=this._matData;i&&!r.edit&&this.form.get("idRol").setValue(i[0].id)})),this.empresas$=this.empresaClienteService.getEmpresasClientesSelect().pipe(x(o=>{let i=o.data,r=this._matData;i&&!r.edit&&this.form.get("idSubEmpresa").setValue(i[0].id)}))}onSelected(o){let i=o.value;this.getMunicipios(i)}getMunicipios(o){this.municipios$=this._locacionService.getMunicipio(o).pipe(x(i=>{let r=i.data,p=this._matData;r&&!p.edit&&this.form.get("idMunicipio").setValue(r[0].id)}))}ngOnInit(){this.createForm();let o=this._matData;if(o.edit){let i=o.data;this.getUsuario(i.id)}}createForm(){this.form=this.fb.group({id:[null],nombre:["",[C.required]],apellido:["",[C.required]],correo:["",[C.required]],contrasena:["",[C.required,C.minLength(5),C.maxLength(20)]],confirmaContrasena:["",[C.required,C.minLength(5),C.maxLength(20)]],idRol:[""],idSubEmpresa:[""],idTipoUsuario:[""],idDepartamento:[""],idMunicipio:[""],estado:[!0]},{validators:ot("contrasena","confirmaContrasena")})}onSave(){if(this.form.valid)if(this._matData.edit){let i=this.form.getRawValue(),{idDepartamento:p,confirmaContrasena:h}=i,_=k(i,["idDepartamento","confirmaContrasena"]);this.fuseService.open($({},X)).afterClosed().subscribe(K=>{K==="confirmed"?this.usuariosService.putUsuario(_).subscribe(V=>{this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.closeDialog()},V=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})}):this.closeDialog()})}else{let o=this.form.getRawValue(),{idDepartamento:p,confirmaContrasena:h}=o,_=k(o,["idDepartamento","confirmaContrasena"]);this.fuseService.open($({},X)).afterClosed().subscribe(K=>{K==="confirmed"?this.usuariosService.postUsuarios(_).subscribe(V=>{console.log(V),this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.closeDialog()},V=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})}):this.closeDialog()})}}getUsuario(o){this.usuariosService.getUsuario(o).subscribe(i=>{if(i){console.log(i.data);let r=i.data,{idDepartamento:p}=r,h=k(r,["idDepartamento"]);this.form.patchValue($({idDepartamento:p},h)),this.municipios$=this._locacionService.getMunicipio(p)}})}closeDialog(){this.dialogRef.close()}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=A({type:t,selectors:[["app-form-usuarios-empresas"]],standalone:!0,features:[L],decls:81,vars:37,consts:[["data",""],["passwordField",""],["passwordConfirm",""],["twoStepToggle",""],[1,"w-full","sm:bg-card","sm:rounded-2xl","sm:mx-0","mx-auto"],[1,""],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"mt-8",3,"formGroup"],[1,"flex","mb-4"],[1,"flex","flex-col","lg:flex-row","mb-4","gap-2"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","Nombre",3,"formControlName"],["matInput","","placeholder","Apellido",3,"formControlName"],["placeholder","Tipo de usuario",3,"formControlName"],[4,"ngIf"],["id","nit","matInput","","placeholder","Correo",3,"formControlName"],["id","contrasena","matInput","","type","password","placeholder","Contrase\xF1a",3,"formControlName"],["mat-icon-button","","type","button","matSuffix","",3,"click"],[1,"icon-size-5",3,"svgIcon"],["id","confirmaContrasena","matInput","","type","password","placeholder","Confirmar contrase\xF1a",3,"formControlName"],["placeholder","Rol",3,"formControlName"],["placeholder","Empresa",3,"formControlName"],["placeholder","Departamento",3,"selectionChange","formControlName"],["placeholder","Ciudad",3,"formControlName"],[1,"flex","flex-wrap","justify-end","gap-2.5"],["mat-flat-button","",1,"lg:w-auto","w-full","lg:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","lg:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],[1,"fcursor-pointer",3,"click"],[1,"font-medium","leading-6"],[1,"ml-4",3,"color","formControlName"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(i,r){if(i&1){let p=W();m(0,"div",4)(1,"div",5)(2,"div",6),c(3),l(),m(4,"form",7),d(5,Ve,6,3,"div",8),m(6,"div",9)(7,"mat-form-field",10)(8,"mat-label"),c(9,"Nombre"),l(),f(10,"input",11),l(),m(11,"mat-form-field",10)(12,"mat-label"),c(13,"Apellido"),l(),f(14,"input",12),l()(),m(15,"div",9)(16,"mat-form-field",10)(17,"mat-label"),c(18,"Tipo de usuario"),l(),m(19,"mat-select",13,0),d(21,ke,2,1,"ng-container",14),I(22,"async"),l()(),m(23,"mat-form-field",10)(24,"mat-label"),c(25,"Correo"),l(),f(26,"input",15),l()(),m(27,"div",9)(28,"mat-form-field",10)(29,"mat-label"),c(30,"Contrase\xF1a"),l(),f(31,"input",16,1),m(33,"button",17),v("click",function(){E(p);let _=U(32);return b(_.type==="password"?_.type="text":_.type="password")}),d(34,Ae,1,1,"mat-icon",18)(35,je,1,1,"mat-icon",18),l(),d(36,Ge,4,3,"mat-error"),l(),m(37,"mat-form-field",10)(38,"mat-label"),c(39,"Confirmar contrase\xF1a"),l(),f(40,"input",19,2),m(42,"button",17),v("click",function(){E(p);let _=U(41);return b(_.type==="password"?_.type="text":_.type="password")}),d(43,Be,1,1,"mat-icon",18)(44,qe,1,1,"mat-icon",18),l(),d(45,Ke,5,4,"mat-error"),l()(),m(46,"div",9)(47,"mat-form-field",10)(48,"mat-label"),c(49,"Rol"),l(),m(50,"mat-select",20,0),d(52,We,2,1,"ng-container",14),I(53,"async"),l()(),m(54,"mat-form-field",10)(55,"mat-label"),c(56,"Empresa"),l(),m(57,"mat-select",21),d(58,Ye,2,1,"ng-container",14),I(59,"async"),l()()(),m(60,"div",9)(61,"mat-form-field",10)(62,"mat-label"),c(63,"Departamento"),l(),m(64,"mat-select",22,0),v("selectionChange",function(_){return E(p),b(r.onSelected(_))}),d(66,et,2,1,"ng-container",14),I(67,"async"),l()(),m(68,"mat-form-field",10)(69,"mat-label"),c(70,"Ciudad"),l(),m(71,"mat-select",23),d(72,it,2,1,"ng-container",14),I(73,"async"),l()()(),m(74,"div",24)(75,"button",25),v("click",function(){return E(p),b(r.closeDialog())}),m(76,"span"),c(77," Cancelar "),l()(),m(78,"button",26),v("click",function(){return E(p),b(r.onSave())}),m(79,"span"),c(80),l()()()()()()}if(i&2){let p=U(32),h=U(41);a(3),O(" ",r._matData.edit?"Actualizar usuario":"Agregar usuario"," "),a(),n("formGroup",r.form),a(),u(r._matData.edit?5:-1),a(5),n("formControlName","nombre"),a(4),n("formControlName","apellido"),a(5),n("formControlName","idTipoUsuario"),a(2),n("ngIf",D(22,27,r.tipoUsuarios$)),a(5),n("formControlName","correo"),a(5),n("formControlName","contrasena"),a(3),u(p.type==="password"?34:-1),a(),u(p.type==="text"?35:-1),a(),u(r.form.get("contrasena").dirty||r.form.get("contrasena").touched?36:-1),a(4),n("formControlName","confirmaContrasena"),a(3),u(h.type==="password"?43:-1),a(),u(h.type==="text"?44:-1),a(),u(r.form.get("confirmaContrasena").dirty||r.form.get("confirmaContrasena").touched?45:-1),a(5),n("formControlName","idRol"),a(2),n("ngIf",D(53,29,r.roles$)),a(5),n("formControlName","idSubEmpresa"),a(),n("ngIf",D(59,31,r.empresas$)),a(6),n("formControlName","idDepartamento"),a(2),n("ngIf",D(67,33,r.departamentos$)),a(5),n("formControlName","idMunicipio"),a(),n("ngIf",D(73,35,r.municipios$)),a(3),n("color","primary"),a(3),n("color","primary"),a(2),O(" ",r._matData.edit?"Actualizar":"Guardar"," ")}},dependencies:[ve,fe,pe,de,ue,G,z,se,Ce,ge,he,ie,oe,Ee,ee,te,B,q,le,me,Se],styles:[".custom-dialog-container{width:100%}@media (min-width: 600px){  .custom-dialog-container{width:60%}}@media (min-width: 1280px){  .custom-dialog-container{width:50%}}"]});let e=t;return e})();function ot(e,t){return s=>{let o=s.get(e),i=s.get(t);return i?.errors&&!i.errors.passwordMismatchError||(o?.value!==i?.value?i?.setErrors({passwordMismatchError:!0}):i?.setErrors(null)),null}}var Me=(()=>{let t=class t{constructor(o,i,r){this._matDialog=o,this.estadoDatosService=i,this.generoService=r,this.usuariosService=g(J),this.searchTerm="",this.data=[],this.columns=["Estado","Usuario","Nombre completo","Rol","Tipo de usuario"],this.columnPropertyMap={Estado:"estado",Usuario:"correo","Nombre completo":"nombreCompleto",Rol:"nombreRol","Tipo de usuario":"nombreTipoUsuario"},this.buttons=[{label:"Edit",icon:"edit",action:p=>{console.log("Editing",p),this.selectedData=p,this.onEdit()}}]}onNew(){this._matDialog.open(Z,{autoFocus:!1,data:{edit:!1},maxHeight:"90vh",disableClose:!0,panelClass:"custom-dialog-container"})}onEdit(){this._matDialog.open(Z,{autoFocus:!1,data:{edit:!0,data:this.selectedData},maxHeight:"90vh",disableClose:!0,panelClass:"custom-dialog-container"})}onSearch(o){let i=o.target;this.searchTerm=i.value.trim().toLowerCase()}getUsuarios(){this.subcription$=this.usuariosService.getUsuarios().pipe(Q(o=>(o.data.forEach(i=>{i.estado?i.estado=Y.ACTIVO:i.estado=Y.INACTIVO}),o)),Q(o=>(o.data.forEach(i=>{i&&(i.nombreCompleto=i.nombre.concat(" ",i.apellido))}),o))).subscribe(o=>{o.data&&(this.data=o.data)})}ngOnInit(){this.getUsuarios()}ngOnDestroy(){this.subcription$.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(j(ne),j(H),j(Fe))},t.\u0275cmp=A({type:t,selectors:[["app-grid-usuarios-empresas"]],standalone:!0,features:[L],decls:15,vars:12,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons","searchTerm"]],template:function(i,r){i&1&&(m(0,"div",0)(1,"div",1)(2,"div",2),c(3,"Usuarios"),l(),m(4,"div",3)(5,"mat-form-field",4),f(6,"mat-icon",5),m(7,"input",6),v("input",function(h){return r.onSearch(h)}),l()(),m(8,"button",7),v("click",function(){return r.onNew()}),f(9,"mat-icon",8),m(10,"span",9),c(11,"Agregar"),l()()()(),m(12,"div",10)(13,"div",11),f(14,"app-custom-table",12),l()()()),i&2&&(a(5),n("subscriptSizing","dynamic"),a(),n("svgIcon","heroicons_solid:magnifying-glass"),a(),n("autocomplete","off")("placeholder","Buscar"),a(),n("color","primary"),a(),n("svgIcon","heroicons_outline:plus"),a(5),n("columns",r.columns)("displayedColumns",r.columns)("columnPropertyMap",r.columnPropertyMap)("data",r.data)("buttons",r.buttons)("searchTerm",r.searchTerm))},dependencies:[be,B,G,q,z]});let e=t;return e})();var Jt=[{path:"",component:Me}];export{Jt as default};
