import{a as D}from"./chunk-VWTEX4VY.js";import{a as Ne}from"./chunk-SJODTVVT.js";import{a as Ve}from"./chunk-X7QYQQPV.js";import{a as Ie}from"./chunk-LDITXAUR.js";import{a as De,b as Ae,c as Me}from"./chunk-JDA76RF6.js";import{a as Z}from"./chunk-N3QIRYNR.js";import{a as U,b as Fe}from"./chunk-XVIRI3LF.js";import{a as ke}from"./chunk-QETDVRLC.js";import{c as je}from"./chunk-YHNXG437.js";import{a as q}from"./chunk-K7UKSVEC.js";import{a as z}from"./chunk-5LJ3IWLD.js";import{a as we}from"./chunk-BW2UNIQM.js";import{g as $}from"./chunk-AYHPHLPH.js";import{c as ue}from"./chunk-C7ANG7GI.js";import"./chunk-566EJEQN.js";import{C as Te,F as Pe,J as L,b as fe,c as ge,e as be,i as B,l as he,n as F,p as ye,q as Se,u as _e,x as xe,y as Ce}from"./chunk-NFNLINIV.js";import{b as de,d as j}from"./chunk-V24ZDQ6I.js";import{h as ce}from"./chunk-32OSWJVT.js";import{a as Ee}from"./chunk-JLSTUWCW.js";import"./chunk-HR6HUVTD.js";import{Q as O,R as G,ba as pe,ga as R,la as ve}from"./chunk-IP22JCCO.js";import"./chunk-QS2H5WYQ.js";import"./chunk-VFBDOJ4Z.js";import"./chunk-ZKYOPOAZ.js";import{Ac as me,Cb as b,Dc as se,Eb as y,Ec as v,Gc as w,Hc as g,Lb as oe,Mb as d,Nb as I,Ob as K,Pb as ie,Qa as n,Vb as P,Wb as E,Zb as re,_ as A,cc as S,dc as _,gb as u,ha as p,ib as s,ma as x,pb as M,q as ae,tb as r,ub as m,vb as h,wa as C,wb as V,xa as T,xb as N,yc as ne,zb as J,zc as le}from"./chunk-VNCXNJPE.js";import{a as k,b as ee,d as te}from"./chunk-NEB6MB4Y.js";var Ge=(()=>{let i=class i{constructor(){this.datePipe=p(v),this.searchTerm="",this.currencyPipe=p(g),this.pagoTrabajadorService=p(D),this._matDialog=p(ue),this.estadoDatosService=p(q),this.router=p(j),this.data=[],this.columns=["N\xFAmero de pago","Identificaci\xF3n","Nombres Apellidos","Empresa","Total","Estado"],this.columnPropertyMap={"N\xFAmero de pago":"consecutivo",Identificaci\u00F3n:"numDocumento","Nombres Apellidos":"nombreTrabajador",Empresa:"nombreSubempresa",Total:"total",Estado:"nombreEstadoCobro"},this.buttons=[{label:"Eye",icon:"visibility",action:a=>{console.log("Editing",a),this.router.navigate(["/pages/gestion-cobros/trabajador/individual/",a.id])}}]}ngOnDestroy(){}ngOnInit(){this.getPagoTrabajadores(),this.listenGrid()}onNew(){this.router.navigate(["/pages/gestion-cobros/trabajador/individual"])}getPagoTrabajadores(){this.pagoTrabajadorService.getPagoTrabajadorIndividual().pipe(A(a=>(a.data.forEach(e=>{e.fechaCreacion=this.datePipe.transform(e.fechaCreacion,"dd/MM/yyyy"),e.total=this.currencyPipe.transform(e.total,"USD","symbol","1.2-2")}),a))).subscribe(a=>{this.data=a.data})}onSearch(a){let e=a.target;this.searchTerm=e.value.trim().toLowerCase()}listenGrid(){this.estadoDatosService.stateGrid.asObservable().subscribe(e=>{e&&this.getPagoTrabajadores()})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=x({type:i,selectors:[["app-grid-pago-trabajador"]],standalone:!0,features:[P([v,g]),E],decls:15,vars:12,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons","searchTerm"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),d(3,"Registro de Cobro Individual"),m(),r(4,"div",3)(5,"mat-form-field",4),h(6,"mat-icon",5),r(7,"input",6),b("input",function(f){return o.onSearch(f)}),m()(),r(8,"button",7),b("click",function(){return o.onNew()}),h(9,"mat-icon",8),r(10,"span",9),d(11,"Registrar"),m()()()(),r(12,"div",10)(13,"div",11),h(14,"app-custom-table",12),m()()()),e&2&&(n(5),s("subscriptSizing","dynamic"),n(),s("svgIcon","heroicons_solid:magnifying-glass"),n(),s("autocomplete","off")("placeholder","Buscar"),n(),s("color","primary"),n(),s("svgIcon","heroicons_outline:plus"),n(5),s("columns",o.columns)("displayedColumns",o.columns)("columnPropertyMap",o.columnPropertyMap)("data",o.data)("buttons",o.buttons)("searchTerm",o.searchTerm))},dependencies:[z,R,B,ve,L]});let t=i;return t})();var Le=(t,i)=>({"bg-credigray-100":t,"bg-green-600":i});function ze(t,i){if(t&1&&(r(0,"mat-option",26),d(1),m()),t&2){let l=i.$implicit;s("value",l.id),n(),I(l.nombre)}}function qe(t,i){if(t&1&&(V(0),u(1,ze,2,2,"mat-option",25),N()),t&2){let l=i.ngIf;n(),s("ngForOf",l.data)}}function Ue(t,i){if(t&1&&(r(0,"mat-option",26),d(1),m()),t&2){let l=i.$implicit;s("value",l.id),n(),I(l.razonSocial)}}function Ze(t,i){if(t&1&&(V(0),u(1,Ue,2,2,"mat-option",25),N()),t&2){let l=i.ngIf;n(),s("ngForOf",l.data)}}function He(t,i){if(t&1&&(r(0,"mat-option",26),d(1),m()),t&2){let l=i.$implicit;s("value",l.id),n(),ie("",l.primerNombre," ",l.primerApellido,"")}}function Je(t,i){if(t&1&&(V(0),u(1,He,2,3,"mat-option",25),N()),t&2){let l=i.ngIf;n(),s("ngForOf",l.data)}}function Ke(t,i){t&1&&(r(0,"mat-error"),d(1,"El valor es requerido!"),m())}function Qe(t,i){t&1&&(r(0,"mat-error"),d(1,"El valor ingresado no puede superar el total a pagar!"),m())}function We(t,i){t&1&&(r(0,"mat-error"),d(1,"El valor ingresado no puede ser 0!"),m())}function Xe(t,i){if(t&1){let l=J();r(0,"div",27)(1,"mat-form-field",28)(2,"mat-label"),d(3,"Valor a cancelar"),m(),r(4,"input",29),b("blur",function(){C(l);let e=y();return T(e.valorAbono.updateValueAndValidity())}),m(),u(5,Ke,2,0,"mat-error",11)(6,Qe,2,0,"mat-error",11)(7,We,2,0,"mat-error",11),m(),r(8,"mat-form-field",28)(9,"mat-label"),d(10,"Observaciones"),m(),h(11,"textarea",30),m()()}if(t&2){let l=y();n(4),s("allowNegativeNumbers",!1)("separatorLimit","999999999")("formControlName","valorAbono"),n(),s("ngIf",(l.valorAbono.touched||l.valorAbono.dirty)&&l.valorAbono.hasError("required")),n(),s("ngIf",(l.valorAbono.touched||l.valorAbono.dirty)&&l.valorAbono.hasError("exceedsBalance")),n(),s("ngIf",(l.valorAbono.touched||l.valorAbono.dirty)&&l.valorAbono.hasError("valueZero")),n(4),s("formControlName","observacion")}}function Ye(t,i){if(t&1&&(r(0,"div",21)(1,"div",31)(2,"p",32),d(3,"Movimientos"),m(),h(4,"app-custom-table",33),m()()),t&2){let l=y();n(4),s("columns",l.columns)("displayedColumns",l.columns)("columnPropertyMap",l.columnPropertyMap)("data",l.data)}}function et(t,i){if(t&1&&(r(0,"div",22)(1,"div",34)(2,"fuse-alert",35)(3,"span",36),d(4,"Informaci\xF3n"),m(),d(5),m()()()),t&2){let l=y();n(2),s("type","info")("appearance","outline"),n(3),K(" ",l.message," ")}}function tt(t,i){if(t&1&&(r(0,"span",24),d(1,"Subtotal: "),r(2,"span",37),d(3),S(4,"currency"),m()()),t&2){let l=y();n(3),I(_(4,1,l.subtotal))}}function at(t,i){if(t&1&&(r(0,"span",24),d(1,"Comisiones: "),r(2,"span",37),d(3),S(4,"currency"),m()()),t&2){let l=y();n(3),I(_(4,1,l.totalComision))}}function ot(t,i){if(t&1&&(r(0,"span",24),d(1,"Total a pagar: "),r(2,"span",37),d(3),S(4,"currency"),m()()),t&2){let l=y();n(3),K(" ",_(4,1,l.totalPagar)," ")}}var it={validation:!1},Be=(()=>{let i=class i{constructor(){this.fb=p(Te),this.empresaClienteService=p(Ie),this.pagoTrabajadorService=p(D),this.cobroTrabajadorService=p(Ne),this.datePipe=p(v),this.swalService=p(ke),this.estadosDatosService=p(q),this.fuseService=p($),this.currencyPipe=p(g),this.decimalPipe=p(w),this.router=p(j),this.empleadosService=p(Ve),this.empresa$=this.empresaClienteService.getEmpresasClientes().pipe(A(a=>{let e=a.data;e&&(this.form.get("idSubEmpresa").setValue(e[0].id),this.getEmpleadosSubEmpresas(e[0].id))})),this.tipoPago$=this.pagoTrabajadorService.tipoPagoTrabajadores().pipe(A(a=>{let e=a.data;e&&(this.selectOptionValue=e)})),this.data=[],this.columns=["Empresa","N factura / Comprobante","Valor pendiente"],this.columnPropertyMap={Empresa:"nombreSubEmpresa","N factura / Comprobante":"numeroFactura","Valor pendiente":"valorPendiente"}}createForm(){this.form=this.fb.group({fechaFinal:["",F.required],idSubEmpresa:["",F.required],idTipoPagoTrabajador:["",F.required],idTrabajador:["",F.required],valorAbono:["",[this.maxAmountValidator.bind(this)]],observacion:[""]})}ngOnInit(){this.createForm(),this.form.get("valorAbono").valueChanges.subscribe(a=>{console.log(a),a==0?(this.form.get("valorAbono").setValidators([F.required,this.maxAmountValidator.bind(this)]),this.form.updateValueAndValidity()):a>0&&this.actualizaSelected(a)})}actualizaSelected(a){a===this.totalPagar?(console.log("Si entra al actualizar"),this.form.get("idTipoPagoTrabajador").setValue(this.selectOptionValue[0].id)):a<this.totalPagar&&(console.log("Si entra al actualizar 2"),this.form.get("idTipoPagoTrabajador").setValue(this.selectOptionValue[1].id))}get valorAbono(){return this.form.get("valorAbono")}maxAmountValidator(a){if(a.value===null||a.value===void 0||a.value==="")return null;console.log(a.value);let e=parseFloat(a.value.toString().replace(/,/g,""));return console.log(e),e===0?{valueZero:!0}:e>this.totalPagar?(console.log("Si entra"),{exceedsBalance:!0}):null}closeDialog(){this.router.navigate(["/pages/gestion-cobros/trabajador"])}getEmpleadosSubEmpresas(a){this.empleados$=this.empleadosService.getEmpleadosSubempresas(a)}selectedEmpleados(a){let e=a.value;this.empleados$=this.empleadosService.getEmpleadosSubempresas(e)}onGet(){if(this.form.valid){let{fechaFinal:a,idSubEmpresa:e,idTrabajador:o}=this.form.getRawValue(),f={fechaFinallData:this.datePipe.transform(a,"yyyy-MM-dd"),idSubEmpresa:e,idTrabajador:o};console.log(f),this.getAllPagoTrabajador(f)}}onSave(){let Y=this.form.getRawValue(),{fechaFinal:a,idSubEmpresa:e,idTrabajador:o,idTipoPagoTrabajador:c}=Y,f=te(Y,["fechaFinal","idSubEmpresa","idTrabajador","idTipoPagoTrabajador"]),$e={fechaFinal:this.datePipe.transform(a,"yyyy-MM-dd"),idSubEmpresa:e},W=[];W=this.data.map(H=>({idCobroTrabajador:H.id}));let X=k(ee(k({},$e),{idTipoPagoTrabajador:c,detallePagoTrabajador:W,idTrabajador:o}),f);console.log(X),this.fuseService.open(k({},je)).afterClosed().subscribe(H=>{H==="confirmed"&&this.postSave(X)})}getAllPagoTrabajador(a){this.cobroTrabajadorService.getCobroTrabajador(a).pipe(ae(e=>(this.subtotal=0,this.totalComision=0,this.totalPagar=0,e&&Array.isArray(e.data)?e.data.forEach(o=>{o.montoCuota=this.currencyPipe.transform(o.montoCuota,"USD","symbol","1.2-2"),o.comision=this.currencyPipe.transform(o.comision,"USD","symbol","1.2-2"),o.pagar=this.currencyPipe.transform(o.pagar,"USD","symbol","1.2-2"),o.valorPendiente=this.currencyPipe.transform(o.valorPendiente,"USD","symbol","1.2-2"),o.fechaCobro=this.datePipe.transform(o.fechaCobro,"dd/MM/yyyy"),this.totalPagar+=parseFloat(o.montoCuota.replace(/[^0-9.-]+/g,""))}):this.data=[],e))).subscribe(e=>{e&&Array.isArray(e.data)?this.data=e.data:(this.data=[],this.message=e.msg)})}postSave(a){this.pagoTrabajadorService.postPagoTrabajador(a).subscribe(e=>{this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.estadosDatosService.stateGrid.next(!0),this.closeDialog()},e=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=x({type:i,selectors:[["app-form-pago-trabajador"]],standalone:!0,features:[P([{provide:G,useClass:Z},{provide:O,useValue:"en-GB"},v,g,w,U(it)]),E],decls:53,vars:28,consts:[["finalPicker",""],["cdkScrollable","",1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:inset-0","sm:overflow-hidden"],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","pl-8"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","sm:flex-row","md:px-8"],[1,"mt-6","w-full","shrink-0","sm:mt-0","sm:space-x-2","lg:w-full"],[1,"mt-8",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","dd/mm/yyyy",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],["placeholder","Tipo de pago trabajador",3,"formControlName"],[4,"ngIf"],["placeholder","Empresa",3,"selectionChange","formControlName"],["placeholder","Trabajadores",3,"formControlName"],["class","flex flex-col items-baseline sm:flex-row gap-2.5",4,"ngIf"],[1,"relative","border","border-gray-300","rounded-lg"],[1,"absolute","-top-3","left-4","bg-white","px-2","text-gray-500","font-semibold"],[1,"flex","flex-wrap","justify-end","gap-2.5","sm:mb-4","pr-2"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","sm:mt-6","transition","duration-200","text-white","font-semibold","rounded-lg","md:w-auto",3,"click","ngClass","disabled"],[1,"flex","flex-auto","overflow-hidden"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"flex","flex-col","gap-4","justify-end","sm:flex-row"],[1,"sm:pr-4","text-gray-600","font-bold","text-right"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-col","items-baseline","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full"],["matInput","","mask","separator.2","thousandSeparator",",","decimalMarker",".","placeholder","Valor a cancelar",3,"blur","allowNegativeNumbers","separatorLimit","formControlName"],["matInput","","placeholder","Observaciones",3,"formControlName"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:p-4","sm:mb-10","sm:overflow-y-auto"],[1,"text-lg","text-black","font-semibold","mb-4"],[3,"columns","displayedColumns","columnPropertyMap","data"],[1,"inline-block","p-4","sm:p-8","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""],[1,"text-gray-800"]],template:function(e,o){if(e&1){let c=J();r(0,"div",1)(1,"div",2),d(2," Cobro Individual "),m(),r(3,"div",3)(4,"div",4)(5,"form",5)(6,"div",6)(7,"mat-form-field",7)(8,"mat-label"),d(9,"Fecha de corte"),m(),h(10,"input",8)(11,"mat-datepicker-toggle",9)(12,"mat-datepicker",null,0),m(),r(14,"mat-form-field",7)(15,"mat-label"),d(16,"Tipo de pago"),m(),r(17,"mat-select",10),u(18,qe,2,1,"ng-container",11),S(19,"async"),m()()(),r(20,"div",6)(21,"mat-form-field",7)(22,"mat-label"),d(23,"Empresa"),m(),r(24,"mat-select",12),b("selectionChange",function(Q){return C(c),T(o.selectedEmpleados(Q))}),u(25,Ze,2,1,"ng-container",11),S(26,"async"),m()(),r(27,"mat-form-field",7)(28,"mat-label"),d(29,"Trabajadores"),m(),r(30,"mat-select",13),u(31,Je,2,1,"ng-container",11),S(32,"async"),m()()(),u(33,Xe,12,7,"div",14),r(34,"div",15)(35,"div",16),d(36," Opciones "),m(),r(37,"div",17)(38,"button",18),b("click",function(){return C(c),T(o.closeDialog())}),r(39,"span"),d(40," Atras "),m()(),r(41,"button",19),b("click",function(){return C(c),T(o.onGet())}),r(42,"span"),d(43," Consultar "),m()(),r(44,"button",20),b("click",function(){return C(c),T(o.onSave())}),r(45,"span"),d(46," Registrar "),m()()()()()()(),u(47,Ye,5,4,"div",21)(48,et,6,3,"div",22),r(49,"div",23),u(50,tt,5,3,"span",24)(51,at,5,3,"span",24)(52,ot,5,3,"span",24),m()()}if(e&2){let c=oe(13);n(5),s("formGroup",o.form),n(5),s("matDatepicker",c)("formControlName","fechaFinal"),n(),s("for",c),n(6),s("formControlName","idTipoPagoTrabajador"),n(),s("ngIf",_(19,19,o.tipoPago$)),n(6),s("formControlName","idSubEmpresa"),n(),s("ngIf",_(26,21,o.empresa$)),n(5),s("formControlName","idTrabajador"),n(),s("ngIf",_(32,23,o.empleados$)),n(2),s("ngIf",o.data.length),n(5),s("color","primary"),n(3),s("color","primary"),n(3),s("ngClass",re(25,Le,o.data.length==0,o.data.length>0))("disabled",o.data.length==0||o.form.invalid),n(3),M(o.data.length?47:o.message?48:-1),n(3),M(o.subtotal?50:-1),n(),M(o.totalComision?51:-1),n(),M(o.totalPagar?52:-1)}},dependencies:[se,g,z,Ee,R,De,Ae,Me,B,L,fe,pe,we,be,le,me,Pe,_e,he,ye,Se,xe,Ce,ne,Fe,ge,ce]});let t=i;return t})();var rt={validation:!1},Re=(()=>{let i=class i{constructor(){this.fuseService=p($),this.currencyPipe=p(g),this.decimalPipe=p(w),this.router=p(j),this.activatedRoute=p(de),this.datePipe=p(v),this.pagoTrabajadorService=p(D)}ngOnDestroy(){}ngOnInit(){let a=this.activatedRoute.snapshot.paramMap.get("id");this.getPagoIndividual(a)}getPagoIndividual(a){this.subcription$=this.pagoTrabajadorService.getPagosTrabajadorIndividual(a).subscribe(e=>{e.data&&(this.detalleFactura=e.data)})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=x({type:i,selectors:[["app-form-view-pago-trabajador"]],standalone:!0,features:[P([{provide:G,useClass:Z},{provide:O,useValue:"en-GB"},v,g,w,U(rt)]),E],decls:2,vars:0,template:function(e,o){e&1&&(r(0,"p"),d(1,"form-view-pago-trabajador works!"),m())}});let t=i;return t})();var sa=[{path:"",component:Ge},{path:"individual",component:Be},{path:"individual/:id",component:Re}];export{sa as default};
