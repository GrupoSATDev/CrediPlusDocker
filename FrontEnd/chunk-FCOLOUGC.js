import{a as G}from"./chunk-2MB4UBZE.js";import{a as Ae}from"./chunk-3XMKQ74T.js";import{a as Ie}from"./chunk-7FZNKT5B.js";import{a as Te,b as Ne,c as ke}from"./chunk-YRZHMDGJ.js";import{a as Ve,b as $e}from"./chunk-FIT6CNEK.js";import{a as Fe}from"./chunk-6PCKBDXF.js";import{a as q}from"./chunk-6IEWE3OU.js";import{a as je}from"./chunk-TRVR57AA.js";import{a as we}from"./chunk-YMBTTIVN.js";import{a as Me}from"./chunk-ARYACW5V.js";import{a as J}from"./chunk-5ZCUS56W.js";import{a as O}from"./chunk-MO2NC6JB.js";import{a as De}from"./chunk-H5OWTWVS.js";import{a as xe}from"./chunk-DYUKGLA6.js";import"./chunk-3EEAMLKT.js";import{g as ge}from"./chunk-45VFWK2F.js";import{a as me,b as le,c as ce}from"./chunk-3F72AFMB.js";import"./chunk-T4J43FBS.js";import{C as ye,G as j,b as pe,e as de,i as A,j as fe,l as he,p as ve,q as Se,u as Ce,w as be,x as _e,z as Ee}from"./chunk-JBQZ6BPD.js";import{$ as se,Q as ae,R as ne,ea as V,ja as ue}from"./chunk-SUQ5NR2B.js";import"./chunk-TO3CLTNT.js";import{a as $}from"./chunk-7LIXJ3C3.js";import{f as ie,g as oe,i as re,j as Z,s as k}from"./chunk-SQ7M4XTP.js";import{$a as T,$b as L,Db as n,Eb as i,Fb as f,Gb as y,Hb as x,Jb as ee,Pb as v,Y as b,Yb as B,Zb as l,_a as r,_b as D,aa as I,ec as te,fa as S,fc as N,ga as d,la as M,nc as w,oc as F,q as Y,qb as g,sb as a,va as _,wa as E}from"./chunk-RICNMTJI.js";import{a as C,d as H}from"./chunk-NEB6MB4Y.js";var Oe=(()=>{let e=class e{constructor(s,t){this._http=s,this.appSettings=t}getTiposEmpresas(){return this._http.get(this.appSettings.tiposEmpresas.url.base)}};e.\u0275fac=function(t){return new(t||e)(S(k),S($))},e.\u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var Ge=(()=>{let e=class e{constructor(s,t){this._http=s,this.appSettingService=t}getSubcripciones(){return this._http.get(this.appSettingService.subcripciones.url.base)}getSubcripcion(s){return this._http.get(`${this.appSettingService.subcripciones.url.base}`)}};e.\u0275fac=function(t){return new(t||e)(S(k),S($))},e.\u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function He(o,e){if(o&1&&(n(0,"mat-option",32),l(1),i()),o&2){let c=e.$implicit;a("value",c.id),r(),D(c.nombre)}}function Be(o,e){if(o&1&&(y(0),g(1,He,2,2,"mat-option",31),x()),o&2){let c=e.ngIf;r(),a("ngForOf",c.data)}}function Le(o,e){if(o&1&&(n(0,"mat-option",32),l(1),i()),o&2){let c=e.$implicit;a("value",c.id),r(),D(c.nombre)}}function Ze(o,e){if(o&1&&(y(0),g(1,Le,2,2,"mat-option",31),x()),o&2){let c=e.ngIf;r(),a("ngForOf",c.data)}}function Je(o,e){if(o&1&&(n(0,"mat-option",32),l(1),i()),o&2){let c=e.$implicit;a("value",c.id),r(),D(c.nombre)}}function qe(o,e){if(o&1&&(y(0),g(1,Je,2,2,"mat-option",31),x()),o&2){let c=e.ngIf;r(),a("ngForOf",c.data)}}function Ke(o,e){if(o&1&&(n(0,"mat-option",32),l(1),i()),o&2){let c=e.$implicit;a("value",c.id),r(),D(c.nombre)}}function Qe(o,e){if(o&1&&(y(0),g(1,Ke,2,2,"mat-option",31),x()),o&2){let c=e.ngIf;r(),a("ngForOf",c.data)}}var Ue={validation:!1},Q=(()=>{let e=class e{constructor(){this.fb=d(Ee),this._locacionService=d(Fe),this.empresasService=d(Ie),this.dialogRef=d(me),this.fuseService=d(ge),this.estadosDatosService=d(O),this.toasService=d(Me),this.tiposEmpresaService=d(Oe),this.empresaClienteService=d(G),this.subcripciones=d(Ge),this.departamentos$=this._locacionService.getDepartamentos().pipe(b(s=>{let t=s.data,m=this._matData;if(t&&!m.edit){this.form.get("idDepartamento").setValue(t[0].id);let p=this.form.get("idDepartamento").value;this.getMunicipios(p)}})),this.empresas$=this.empresasService.getEmpresas(),this.tiposEmpresas$=this.tiposEmpresaService.getTiposEmpresas().pipe(b(s=>{let t=s.data,m=this._matData;t&&!m.edit&&this.form.get("idTipoEmpresa").setValue(t[0].id)})),this.subcripciones$=this.subcripciones.getSubcripciones().pipe(b(s=>{let t=s.data,m=this._matData;t&&!m.edit&&this.form.get("idSubscripcion").setValue(t[0].id)})),this._matData=d(le),this.datePipe=d(Z),this.swalService=d(je)}onSelected(s){let t=s.value;this.getMunicipios(t)}getMunicipios(s){this.municipios$=this._locacionService.getMunicipio(s).pipe(b(t=>{let m=t.data,p=this._matData;m&&!p.edit&&this.form.get("idMunicipio").setValue(m[0].id)}))}ngOnInit(){this.createForm();let s=this._matData;if(s.edit){let t=s.data;this.form.patchValue(t);let{idDepartamento:m,fechaCorte:p,estado:h}=t,u=new Date(p);this.form.patchValue({estado:h=="Activo",fechaCorte:u}),this.municipios$=this._locacionService.getMunicipio(m)}}onSave(){if(this.form.valid)if(this._matData.edit){let t=this.form.getRawValue(),{idDepartamento:p,fechaCobro:h}=t,u=H(t,["idDepartamento","fechaCobro"]),P=this.datePipe.transform(h,"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"),z=C({fechaCobro:P},u);this.fuseService.open(C({},J)).afterClosed().subscribe(W=>{W==="confirmed"?this.empresaClienteService.putEmpresaCliente(z).subscribe(R=>{this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro actualizado con exito!",timer:4e3}),this.closeDialog()},R=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al actualizar el registro!",timer:4e3})}):this.closeDialog()})}else{let s=this.form.getRawValue(),{idDepartamento:p,idEmpresa:h,fechaCobro:u}=s,P=H(s,["idDepartamento","idEmpresa","fechaCobro"]),z=this.datePipe.transform(u,"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"),U=C({fechaCobro:z},P);this.fuseService.open(C({},J)).afterClosed().subscribe(R=>{R==="confirmed"?this.empresaClienteService.postEmpresaCliente(U).subscribe(X=>{console.log(X),this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro creado con exito!",timer:4e3}),this.closeDialog()},X=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})}):this.closeDialog()})}}createForm(){this.form=this.fb.group({id:[null],nit:[""],razonSocial:[""],correo:[""],telefono:[""],direccion:[""],idDepartamento:[""],idTipoEmpresa:[""],idMunicipio:[""],fechaCorte:[""],idSubscripcion:[""],valorSuscripcion:[""],porcCobro:[""],fechaCobro:[""],estado:[!0]})}closeDialog(){this.dialogRef.close()}};e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=M({type:e,selectors:[["app-form-empresas-clientes"]],standalone:!0,features:[te([{provide:ne,useClass:Ae},{provide:ae,useValue:"en-GB"},Z,Ve(Ue)]),N],decls:91,vars:33,consts:[["twoStepToggle",""],["data",""],["picker",""],[1,"w-full","sm:bg-card","sm:rounded-2xl","sm:mx-0","mx-auto"],[1,""],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"mt-8",3,"formGroup"],[1,"font-bold","mb-4","text-2xl"],[1,"flex","flex-col","sm:flex-row","mb-4"],[1,"fcursor-pointer",3,"click"],[1,"font-medium","leading-6"],[1,"ml-4",3,"color","formControlName"],[1,"flex","flex-col","sm:flex-row","mb-4","gap-2"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","Nit",3,"formControlName"],["matInput","","placeholder","Raz\xF3n social",3,"formControlName"],["matInput","","placeholder","Correo electronico",3,"formControlName"],["matInput","","placeholder","Tel\xE9fono",3,"formControlName"],["placeholder","Departamento",3,"selectionChange","formControlName"],[4,"ngIf"],["placeholder","Ciudad",3,"formControlName"],["matInput","","placeholder","Direcci\xF3n",3,"formControlName"],["placeholder","Tipo de empresa",3,"formControlName"],["placeholder","Subscripci\xF3n",3,"formControlName"],["matInput","","mask","separator.0","thousandSeparator",".","placeholder","Valor subcripci\xF3n",3,"formControlName"],["matInput","","placeholder","Porcentaje %",3,"formControlName"],["matInput","","placeholder","Fecha de cobro",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],[1,"flex","flex-wrap","justify-end","gap-2.5"],["mat-flat-button","",1,"sm:w-auto","w-full","lg:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"sm:w-auto","w-full","lg:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,m){if(t&1){let p=ee();n(0,"div",3)(1,"div",4)(2,"div",5),l(3),i(),n(4,"form",6)(5,"div")(6,"p",7),l(7,"Informaci\xF3n general"),i(),n(8,"div",8)(9,"div",9),v("click",function(){_(p);let u=B(13);return E(u.toggle())}),n(10,"div",10),l(11),i()(),f(12,"mat-slide-toggle",11,0),i(),n(14,"div",12)(15,"mat-form-field",13)(16,"mat-label"),l(17,"Nit"),i(),f(18,"input",14),i(),n(19,"mat-form-field",13)(20,"mat-label"),l(21,"Raz\xF3n social"),i(),f(22,"input",15),i()(),n(23,"div",12)(24,"mat-form-field",13)(25,"mat-label"),l(26,"Correo"),i(),f(27,"input",16),i(),n(28,"mat-form-field",13)(29,"mat-label"),l(30,"Tel\xE9fono"),i(),f(31,"input",17),i()(),n(32,"div",12)(33,"mat-form-field",13)(34,"mat-label"),l(35,"Departamento"),i(),n(36,"mat-select",18,1),v("selectionChange",function(u){return _(p),E(m.onSelected(u))}),g(38,Be,2,1,"ng-container",19),w(39,"async"),i()(),n(40,"mat-form-field",13)(41,"mat-label"),l(42,"Ciudad"),i(),n(43,"mat-select",20),g(44,Ze,2,1,"ng-container",19),w(45,"async"),i()()(),n(46,"div",8)(47,"mat-form-field",13)(48,"mat-label"),l(49,"Direcci\xF3n"),i(),f(50,"input",21),i()()(),n(51,"div")(52,"p",7),l(53,"Informaci\xF3n de contrato"),i(),n(54,"div",12)(55,"mat-form-field",13)(56,"mat-label"),l(57,"Tipo de empresa"),i(),n(58,"mat-select",22),g(59,qe,2,1,"ng-container",19),w(60,"async"),i()(),n(61,"mat-form-field",13)(62,"mat-label"),l(63,"Subscripci\xF3n"),i(),n(64,"mat-select",23),g(65,Qe,2,1,"ng-container",19),w(66,"async"),i()()(),n(67,"div",12)(68,"mat-form-field",13)(69,"mat-label"),l(70,"Valor subscripci\xF3n"),i(),f(71,"input",24),i(),n(72,"mat-form-field",13)(73,"mat-label"),l(74,"Porcentaje cobro"),i(),f(75,"input",25),i()(),n(76,"div",8)(77,"mat-form-field",13)(78,"mat-label"),l(79,"Fecha de cobro"),i(),f(80,"input",26)(81,"mat-datepicker-toggle",27)(82,"mat-datepicker",null,2),i()()(),n(84,"div",28)(85,"button",29),v("click",function(){return _(p),E(m.closeDialog())}),n(86,"span"),l(87," Cancelar "),i()(),n(88,"button",30),v("click",function(){return _(p),E(m.onSave())}),n(89,"span"),l(90," Guardar "),i()()()()()()}if(t&2){let p=B(83);r(3),L(" ",m._matData.edit?"Actualizar empresa":"Agregar empresa"," "),r(),a("formGroup",m.form),r(7),L(" Estado ",m.form.get("estado").value?"Activo":"Inactivo"," "),r(),a("color","primary")("formControlName","estado"),r(6),a("formControlName","nit"),r(4),a("formControlName","razonSocial"),r(5),a("formControlName","correo"),r(4),a("formControlName","telefono"),r(5),a("formControlName","idDepartamento"),r(2),a("ngIf",F(39,25,m.departamentos$)),r(5),a("formControlName","idMunicipio"),r(),a("ngIf",F(45,27,m.municipios$)),r(6),a("formControlName","direccion"),r(8),a("formControlName","idTipoEmpresa"),r(),a("ngIf",F(60,29,m.tiposEmpresas$)),r(5),a("formControlName","idSubscripcion"),r(),a("ngIf",F(66,31,m.subcripciones$)),r(6),a("formControlName","valorSuscripcion"),r(4),a("formControlName","porcCobro"),r(5),a("matDatepicker",p)("formControlName","fechaCobro"),r(),a("for",p),r(4),a("color","primary"),r(3),a("color","primary")}},dependencies:[V,A,j,pe,ye,Ce,he,ve,Se,be,_e,re,se,De,ie,oe,Ne,ke,Te,fe,de,$e,xe],styles:[".custom-dialog-container{width:100%}@media (min-width: 1280px){  .custom-dialog-container{width:50%}}"]});let o=e;return o})();var Pe=(()=>{let e=class e{constructor(s,t,m){this._matDialog=s,this.empresaClienteService=t,this.estadoDatosService=m,this.data=[],this.columns=["Nit","Razon social","Correo","Telefono","Direccion","Estado"],this.columnPropertyMap={Nit:"nit","Razon social":"razonSocial",Correo:"correo",Telefono:"telefono",Direccion:"direccion",Estado:"estado"},this.buttons=[{label:"Edit",icon:"edit",action:p=>{console.log("Editing",p),this.selectedData=p,this.onEdit()}}]}onNew(){this._matDialog.open(Q,{autoFocus:!1,data:{edit:!1},maxHeight:"90vh",disableClose:!0,panelClass:"custom-dialog-container"})}onEdit(){this._matDialog.open(Q,{autoFocus:!1,data:{edit:!0,data:this.selectedData},maxHeight:"90vh",disableClose:!0,panelClass:"custom-dialog-container"})}getEmpresas(){this.subcription$=this.empresaClienteService.getEmpresas().pipe(Y(s=>(s.data.forEach(t=>{t.estado?t.estado=q.ACTIVO:t.estado=q.INACTIVO}),s))).subscribe(s=>{this.data=s.data})}listenGrid(){this.estadoDatosService.stateGrid.asObservable().subscribe(t=>{t&&this.getEmpresas()})}ngOnDestroy(){this.subcription$.unsubscribe()}ngOnInit(){this.getEmpresas(),this.listenGrid()}};e.\u0275fac=function(t){return new(t||e)(T(ce),T(G),T(O))},e.\u0275cmp=M({type:e,selectors:[["app-grid-empresas-clientes"]],standalone:!0,features:[N],decls:15,vars:11,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons"]],template:function(t,m){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),l(3,"Clientes - Aliados"),i(),n(4,"div",3)(5,"mat-form-field",4),f(6,"mat-icon",5)(7,"input",6),i(),n(8,"button",7),v("click",function(){return m.onNew()}),f(9,"mat-icon",8),n(10,"span",9),l(11,"Agregar"),i()()()(),n(12,"div",10)(13,"div",11),f(14,"app-custom-table",12),i()()()),t&2&&(r(5),a("subscriptSizing","dynamic"),r(),a("svgIcon","heroicons_solid:magnifying-glass"),r(),a("autocomplete","off")("placeholder","Buscar"),r(),a("color","primary"),r(),a("svgIcon","heroicons_outline:plus"),r(5),a("columns",m.columns)("displayedColumns",m.columns)("columnPropertyMap",m.columnPropertyMap)("data",m.data)("buttons",m.buttons))},dependencies:[V,A,ue,j,we]});let o=e;return o})();var Ht=[{path:"",component:Pe}];export{Ht as default};
