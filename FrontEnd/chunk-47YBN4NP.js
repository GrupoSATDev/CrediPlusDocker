import{a as we}from"./chunk-UHN5DKPC.js";import{a as Q}from"./chunk-RMZCY5UC.js";import{a as Z,b as T}from"./chunk-E3QK27E6.js";import{a as dt}from"./chunk-74VNGCAR.js";import{a as ct}from"./chunk-RI4D27QZ.js";import{a as Ee,b as Te,c as at,d as rt}from"./chunk-X5YKWCIG.js";import{a as U}from"./chunk-X7QYQQPV.js";import{a as mt,b as _e}from"./chunk-P4PAYY2C.js";import{a as nt,b as st,c as lt}from"./chunk-DVCUHTPM.js";import{b as j}from"./chunk-LOIXTBAB.js";import{a as N}from"./chunk-36VONVFQ.js";import{a as it}from"./chunk-TLRVZKMJ.js";import{a as X}from"./chunk-N3QIRYNR.js";import{a as z,b as ot}from"./chunk-XVIRI3LF.js";import{a as De}from"./chunk-QETDVRLC.js";import{a as tt,b as oe}from"./chunk-YHNXG437.js";import{a as ye}from"./chunk-K7UKSVEC.js";import{a as ie}from"./chunk-6IEWE3OU.js";import{a as et}from"./chunk-5LJ3IWLD.js";import{a as Ye}from"./chunk-BW2UNIQM.js";import{g as $}from"./chunk-AYHPHLPH.js";import{c as ce}from"./chunk-C7ANG7GI.js";import"./chunk-566EJEQN.js";import{C as xe,E as Je,F as Se,J as H,b as pe,c as Ue,i as q,l as fe,n as b,p as be,q as he,u as ge,x as ve,y as Ce}from"./chunk-NFNLINIV.js";import{b as G,d as R,e as Xe}from"./chunk-V24ZDQ6I.js";import{h as O}from"./chunk-32OSWJVT.js";import{a as Ke}from"./chunk-JLSTUWCW.js";import"./chunk-HR6HUVTD.js";import{Q as B,R as k,ba as Qe,ga as L,ha as Ze,la as ue}from"./chunk-IP22JCCO.js";import"./chunk-QS2H5WYQ.js";import"./chunk-VFBDOJ4Z.js";import{b as We}from"./chunk-ZKYOPOAZ.js";import{Ac as V,Cb as E,Eb as C,Ec as D,Hc as x,Ib as se,Jb as le,Kb as me,Lb as Y,Mb as r,Nb as h,Nc as ze,Ob as de,Qa as s,Qb as Ve,Rb as Ge,Sb as Re,Tb as Be,Ub as ke,Vb as F,Wb as A,X as ne,Xb as Oe,Zb as qe,ba as Pe,cc as P,dc as Le,ec as ee,fc as te,ga as Ie,gb as v,ha as p,ib as m,l as re,ma as w,q as W,tb as i,ub as o,vb as u,wa as S,wb as J,xa as y,xb as K,yc as $e,zb as M,zc as He}from"./chunk-VNCXNJPE.js";import{a as _,d as Me}from"./chunk-NEB6MB4Y.js";var pt=(()=>{let d=class d{constructor(a,t){this._http=a,this.AppSettings=t}postDesembolso(a){return this._http.post(this.AppSettings.detalleConsumos.url.desembolsoBase,a)}patchDesembolso(a){let t=a.id;delete a.id;let{idEstado:e,idCuentaDestino:c,numeroFactura:f,idCuentaBancaria:g}=a;return this._http.patch(`${this.AppSettings.detalleConsumos.url.base}/Desembolso/${t}?idEstado=${e}&numFactura=${f}&cuentaDestino=${c}&idCuentaBancaria=${g}`,{})}};d.\u0275fac=function(t){return new(t||d)(Ie(ze),Ie(We))},d.\u0275prov=Pe({token:d,factory:d.\u0275fac,providedIn:"root"});let n=d;return n})();var Ct=["stepper"];function xt(n,d){n&1&&(i(0,"mat-error"),r(1,"El campo es requerido!"),o())}function St(n,d){n&1&&(i(0,"mat-error"),r(1,"El valor es requerido!"),o())}function yt(n,d){n&1&&(i(0,"mat-error"),r(1,"El valor ingresado no puede superar el cupo disponible!"),o())}function Dt(n,d){if(n&1&&(i(0,"mat-option",28),r(1),o()),n&2){let l=d.$implicit;m("value",l.idTipoCuenta),s(),Ve("",l.nombreBanco," - ",l.nombreTipoCuenta," - ",l.numeroCuenta,"")}}function Et(n,d){n&1&&(i(0,"mat-error"),r(1,"El campo es requerido!"),o())}function Tt(n,d){if(n&1&&(i(0,"div",29)(1,"div",30)(2,"div",31)(3,"h2",32),r(4,"Resumen de desembolso"),o(),i(5,"p",33),r(6,"Revise los detalles"),o()(),i(7,"div",34)(8,"div",35)(9,"div")(10,"h3",36),r(11,"Fecha"),o()(),i(12,"p",37),r(13),P(14,"date"),o()(),i(15,"div",35)(16,"div")(17,"h3",36),r(18,"N\xFAmero de comprobante"),o()(),i(19,"p",37),r(20),o()(),i(21,"div",35)(22,"div")(23,"h3",36),r(24,"Valor"),o()(),i(25,"p",37),r(26),o()(),i(27,"div",35)(28,"div")(29,"h3",36),r(30,"Cuenta de origen"),o()(),i(31,"p",37),r(32),o()(),i(33,"div",38)(34,"div")(35,"h3",36),r(36,"Cuenta destino"),o()(),i(37,"p",37),r(38),o()()()()()),n&2){let l=C();s(13),h(ee(14,5,l.detaleConsumo.fechaCreacion,"dd/MM/yyyy")),s(7),h(l.detaleConsumo.numeroFactura),s(6),h(l.detaleConsumo.montoConsumo),s(6),h(l.detaleConsumo.cuentaOrigen),s(6),h(l.detaleConsumo.cuentaDestino)}}var _t={validation:!1},ut=(()=>{let d=class d{constructor(){this.fuseService=p($),this.estadosDatosService=p(ye),this.empleadosServices=p(U),this.cuentasServices=p(ct),this.tipoCuentaService=p(it),this.datePipe=p(D),this.currencyPipe=p(x),this.router=p(R),this.fb=p(xe),this.detalleConsumo=p(N),this.cuentas=[],this.desembolsoService=p(pt),this.swalService=p(De),this.solicitudService=p(Q),this.detalleConsumoService=p(N),this.activatedRoute=p(G),this.errorHandlerService=p(we),this.showAlert=!1,this.alert={type:"success",message:""},this.creditos=[],this.focus=focus,this.FormatoOptionsPipe=dt}ngOnDestroy(){this.subscription$.unsubscribe()}ngOnInit(){this.createForm(),this.getCuentas();let a=this.activatedRoute.snapshot.paramMap.get("id");this.getSolicitud(a)}cerrar(){this.router.navigate(["/pages/gestion-creditos/desembolsos"])}getSolicitud(a){let t,e;this.subscription$=this.detalleConsumoService.getDetalleConsumoDesembolso(a).pipe(ne(c=>{let f={idTipoDoc:c.data.trabajador.idTipoDoc,numDocumento:c.data.trabajador.numDoc};return t=c.data.montoConsumo,e=c.data.bancotrabajador+" - "+c.data.tipoCuentaTrabajador+" - "+c.data.numeroCuentaTrabajador,this.empleadosServices.getEmpleadoParams(f)})).subscribe(c=>{if(c){this.showAlert=!1;let f={numDoc:c.data.numDoc,primerNombre:c.data.primerNombre,segundoNombre:c.data.segundoNombre,primerApellido:c.data.primerApellido,segundoApellido:c.data.segundoApellido,idTrabajador:c.data.id,correo:c.data.correo,credito:c.data.creditos[0].numCredito+" - "+this.currencyPipe.transform(c.data.creditos[0].cupoDisponible,"USD","symbol","1.2-2"),idCredito:c.data.creditos[0].id,numCuentaBancaria:c.data.numCuentaBancaria,cuentaDestinoInformativa:e,idTipoCuenta:c.data.idTipoCuenta,nombreTipoCuenta:c.data.nombreTipoCuenta,id:a};this.secondFormGroup.patchValue(f),this.thirdFormGroup.patchValue({idCuentaBancaria:f.idTipoCuenta,cuentaDestino:f.numCuentaBancaria,cuentaDestinoInformativa:e,montoConsumo:t,nombreTipoCuenta:f.nombreTipoCuenta}),this.creditos=c.data.creditos}},c=>{this.alert={type:"error",message:"El trabajador no existe!"},this.showAlert=!0})}getCuentas(){this.subscription$=this.cuentasServices.getCuentasActivas().subscribe(a=>{this.cuentas=a.data,this.thirdFormGroup.get("cuentaOrigen").setValue(a.data[0].numeroCuenta)})}selectedData(a){let t=a.value,e=this.cuentas.find(c=>c.idTipoCuenta==t);this.thirdFormGroup.get("cuentaOrigen").setValue(e.numeroCuenta),this.thirdFormGroup.get("nombreTipoCuenta").setValue(e.nombreTipoCuenta)}selected(a){let t=a.value;this.compareValor=t.cupoDisponible,this.thirdFormGroup.get("montoConsumo").setValidators(wt(this.compareValor)),this.thirdFormGroup.get("montoConsumo").updateValueAndValidity()}compareWithConstants(a){let t=a.value,e=this.secondFormGroup.get("idCredito")?.value;return!e||!e.montoConsumo?(console.error("No se encontr\xF3 el objeto idCredito o montoConsumo"),re(null)):(console.log(t),console.log(e.montoConsumo),t>e.montoConsumo?re({notEqual:!0}):re(null))}get montoConsumo(){return this.thirdFormGroup.get("montoConsumo")}get comprobante(){return this.thirdFormGroup.get("numeroFactura")}get cuentaDestino(){return this.thirdFormGroup.get("cuentaDestino")}onSave(){if(this.thirdFormGroup.valid){let a=this.thirdFormGroup.getRawValue(),{montoConsumo:t,idCuentaBancaria:e,cuentaDestino:c}=a,f=Me(a,["montoConsumo","idCuentaBancaria","cuentaDestino"]),{id:g,idCredito:I,idTrabajador:gt}=this.secondFormGroup.getRawValue();console.log(I);let je=this.cuentas.filter(ae=>{if(ae.idTipoCuenta==e)return ae.id});console.log(je[0].id);let Ne=_({id:g,idEstado:T.REALIZADA,idCuentaDestino:c,idCuentaBancaria:je[0].id},f);console.log(Ne),this.fuseService.open(_({},oe)).afterClosed().subscribe(ae=>{ae==="confirmed"&&this.desembolsoService.patchDesembolso(Ne).subscribe(Ae=>{console.log(Ae),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.getResumenCompra(gt)},Ae=>{this.errorHandlerService.errorHandler(Ae)})})}}getResumenCompra(a){this.subscription$=this.detalleConsumo.getResumen(a).subscribe(t=>{t&&(console.log(t),this.detaleConsumo=t.data,this.stepper.next(),setTimeout(()=>{this.cerrar()},5e3))})}createForm(){this.secondFormGroup=this.fb.group({numDoc:["",b.required],primerNombre:["",b.required],segundoNombre:[""],primerApellido:["",b.required],segundoApellido:[""],idTrabajador:[""],correo:["",b.required],credito:["",b.required],idCredito:["",b.required],numCuentaBancaria:[""],cuentaDestinoInformativa:[""],idTipoCuenta:[""],id:[""]}),this.thirdFormGroup=this.fb.group({montoConsumo:[{value:0,disabled:!0},[b.required]],numeroFactura:["",b.required],idCuentaBancaria:["",b.required],cuentaDestino:["",b.required],cuentaDestinoInformativa:[{value:0,disabled:!0}],nombreTipoCuenta:[{value:0,disabled:!0},b.required],cuentaOrigen:[{value:0,disabled:!0},b.required]})}};d.\u0275fac=function(t){return new(t||d)},d.\u0275cmp=w({type:d,selectors:[["app-form-desembolso"]],viewQuery:function(t,e){if(t&1&&se(Ct,5),t&2){let c;le(c=me())&&(e.stepper=c.first)}},standalone:!0,features:[F([{provide:k,useClass:X},{provide:B,useValue:"en-GB"},D,x,z(_t)]),A],decls:85,vars:29,consts:[["stepper",""],["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","items-center","overflow-y-auto","bg-gray-100","p-6","sm:p-8"],[1,"relative","w-full","flex-0","max-w-4xl","sm:rounded-lg","overflow-hidden"],[1,"p-2","text-3xl","font-semibold","text-center","text-gray-800"],[1,"w-full","px-6","py-4",3,"orientation","linear","animationDuration"],["label","Verificar informaci\xF3n",3,"stepControl"],[1,"w-full"],[1,"space-y-4","w-full","max-w-lg","mx-auto",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-4"],["matInput","","readonly","",3,"formControlName"],[1,"flex","flex-col"],[1,"flex","flex-wrap","justify-center","sm:justify-center","gap-4","mt-2"],["mat-button","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediorange-100","rounded-lg",3,"click"],["mat-button","","matStepperNext","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediblue-50","rounded-lg","hover:bg-opacity-80",3,"disabled"],["label","Confirmar desembolso",3,"stepControl"],[1,"w-full","h-full","p-4","sm:p-8"],[1,"flex","flex-col","sm:flex-row","items-baseline","gap-4"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","N\xFAmero de comprobante",3,"formControlName"],[4,"ngIf"],["matInput","","thousandSeparator",".","placeholder","Valor",3,"formControlName","mask"],["placeholder","Cuenta de origen",3,"selectionChange","formControlName"],[3,"value",4,"ngFor","ngForOf"],["matInput","","placeholder","Cuenta destino",3,"formControlName"],["mat-button","","matStepperPrevious","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-gray-500","rounded-lg","hover:bg-gray-600"],["mat-button","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediblue-50","rounded-lg","hover:bg-opacity-80",3,"click","disabled"],["label","Resumen de desembolso"],["class","w-full px-4 sm:px-8",4,"ngIf"],[3,"value"],[1,"w-full","px-4","sm:px-8"],[1,"max-w-2xl","mx-auto","p-6","bg-white","shadow-lg","rounded-lg"],[1,"border-b","pb-4","mb-4","text-center"],[1,"text-2xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-500"],[1,"space-y-4"],[1,"flex","justify-between","items-center","border-b","pb-2"],[1,"text-lg","font-semibold","text-gray-700"],[1,"text-lg","font-bold","text-gray-800"],[1,"flex","justify-between","items-center"]],template:function(t,e){if(t&1){let c=M();i(0,"div",1)(1,"div",2)(2,"div",3),r(3),o(),i(4,"mat-stepper",4,0)(6,"mat-step",5)(7,"div",6)(8,"form",7)(9,"div",8)(10,"mat-form-field",6)(11,"mat-label"),r(12,"Primer nombre"),o(),u(13,"input",9),o(),i(14,"mat-form-field",6)(15,"mat-label"),r(16,"Segundo nombre"),o(),u(17,"input",9),o()(),i(18,"div",8)(19,"mat-form-field",6)(20,"mat-label"),r(21,"Primer apellido"),o(),u(22,"input",9),o(),i(23,"mat-form-field",6)(24,"mat-label"),r(25,"Segundo apellido"),o(),u(26,"input",9),o()(),i(27,"div",8)(28,"mat-form-field",6)(29,"mat-label"),r(30,"Identificaci\xF3n"),o(),u(31,"input",9),o(),i(32,"mat-form-field",6)(33,"mat-label"),r(34,"Email"),o(),u(35,"input",9),o()(),i(36,"div",10)(37,"mat-form-field",6)(38,"mat-label"),r(39,"Cr\xE9dito / Cupo disponible"),o(),u(40,"input",9),o()(),i(41,"div",10)(42,"mat-form-field",6)(43,"mat-label"),r(44,"Cuenta destino: Banco - Tipo - N\xFAmero"),o(),u(45,"input",9),o()()(),i(46,"div",11)(47,"button",12),E("click",function(){return S(c),y(e.cerrar())}),r(48,"Cancelar"),o(),i(49,"button",13),r(50,"Siguiente"),o()()()(),i(51,"mat-step",14)(52,"div",15)(53,"form",7)(54,"div",16)(55,"mat-form-field",17)(56,"mat-label"),r(57,"N\xFAmero de comprobante"),o(),u(58,"input",18),v(59,xt,2,0,"mat-error",19),o(),i(60,"mat-form-field",17)(61,"mat-label"),r(62,"Valor de la transferencia"),o(),u(63,"input",20),v(64,St,2,0,"mat-error",19)(65,yt,2,0,"mat-error",19),o()(),i(66,"div",8)(67,"mat-form-field",17)(68,"mat-label"),r(69,"Cuenta origen: Banco - Tipo - N\xFAmero"),o(),i(70,"mat-select",21),E("selectionChange",function(g){return S(c),y(e.selectedData(g))}),v(71,Dt,2,4,"mat-option",22),o()()(),i(72,"div",8)(73,"mat-form-field",17)(74,"mat-label"),r(75,"Cuenta destino: Banco - Tipo - N\xFAmero"),o(),u(76,"input",23),v(77,Et,2,0,"mat-error",19),o()()(),i(78,"div",11)(79,"button",24),r(80,"Anterior"),o(),i(81,"button",25),E("click",function(){return S(c),y(e.onSave())}),r(82,"Confirmar"),o()()()(),i(83,"mat-step",26),v(84,Tt,39,8,"div",27),o()()()()}t&2&&(s(3),de(" ","Desembolso"," "),s(),m("orientation","vertical")("linear",!0)("animationDuration","1500"),s(2),m("stepControl",e.secondFormGroup),s(2),m("formGroup",e.secondFormGroup),s(5),m("formControlName","primerNombre"),s(4),m("formControlName","segundoNombre"),s(5),m("formControlName","primerApellido"),s(4),m("formControlName","segundoApellido"),s(5),m("formControlName","numDoc"),s(4),m("formControlName","correo"),s(5),m("formControlName","credito"),s(5),m("formControlName","cuentaDestinoInformativa"),s(4),m("disabled",e.secondFormGroup.invalid),s(2),m("stepControl",e.thirdFormGroup),s(2),m("formGroup",e.thirdFormGroup),s(5),m("formControlName","numeroFactura"),s(),m("ngIf",(e.comprobante.touched||e.comprobante.dirty)&&e.comprobante.hasError("required")),s(4),m("formControlName","montoConsumo")("mask","separator.0"),s(),m("ngIf",(e.montoConsumo.touched||e.montoConsumo.dirty)&&e.montoConsumo.hasError("required")),s(),m("ngIf",(e.montoConsumo.touched||e.montoConsumo.dirty)&&e.montoConsumo.hasError("notEqual")),s(5),m("formControlName","idCuentaBancaria"),s(),m("ngForOf",e.cuentas),s(5),m("formControlName","cuentaDestinoInformativa"),s(),m("ngIf",(e.cuentaDestino.touched||e.cuentaDestino.dirty)&&e.cuentaDestino.hasError("required")),s(4),m("disabled",e.thirdFormGroup.invalid),s(3),m("ngIf",e.detaleConsumo))},dependencies:[O,D,Je,ge,fe,be,he,L,Ue,q,H,pe,Qe,Ye,Ee,Te,at,rt,He,V,ot,Se,ve,Ce]});let n=d;return n})();function wt(n){return d=>{let l=d.value;return console.log(n),l>n?{notEqual:!0}:null}}var Ft=(n,d)=>({"bg-green-700":n,"bg-credigray-100":d});function At(n,d){if(n&1&&(J(0),u(1,"app-custom-table",19),K()),n&2){let l=C(2);s(),m("columns",l.columns)("displayedColumns",l.columns)("columnPropertyMap",l.columnPropertyMap)("data",l.data)("buttons",l.buttonsPendiente)("searchTerm",l.searchTerm)}}function It(n,d){n&1&&(i(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),r(4,"Informaci\xF3n"),o(),r(5," No hay solicitudes hasta el momento. "),o()()()),n&2&&(s(2),m("type","info")("appearance","outline"))}function jt(n,d){if(n&1&&v(0,At,2,6,"ng-container",18)(1,It,6,2,"ng-template",null,1,te),n&2){let l=Y(2),a=C();m("ngIf",a.data.length)("ngIfElse",l)}}function Nt(n,d){if(n&1&&(J(0),u(1,"app-custom-table",19),K()),n&2){let l=C(2);s(),m("columns",l.columnsDesembolsos)("displayedColumns",l.columnsDesembolsos)("columnPropertyMap",l.columnPropertyMapDesembolsos)("data",l.data)("buttons",l.buttons)("searchTerm",l.searchTerm)}}function Mt(n,d){n&1&&(i(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),r(4,"Informaci\xF3n"),o(),r(5," No hay solicitudes rechazadas hasta el momento. "),o()()()),n&2&&(s(2),m("type","info")("appearance","outline"))}function Pt(n,d){if(n&1&&v(0,Nt,2,6,"ng-container",18)(1,Mt,6,2,"ng-template",null,1,te),n&2){let l=Y(2),a=C();m("ngIf",a.data.length)("ngIfElse",l)}}function Vt(n,d){if(n&1&&(J(0),u(1,"app-custom-table",19),K()),n&2){let l=C(2);s(),m("columns",l.columnsDesembolsos)("displayedColumns",l.columnsDesembolsos)("columnPropertyMap",l.columnPropertyMapDesembolsos)("data",l.data)("buttons",l.buttonsApprove)("searchTerm",l.searchTerm)}}function Gt(n,d){n&1&&(i(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),r(4,"Informaci\xF3n"),o(),r(5," No hay solicitudes aprobadas hasta el momento. "),o()()()),n&2&&(s(2),m("type","info")("appearance","outline"))}function Rt(n,d){if(n&1&&v(0,Vt,2,6,"ng-container",18)(1,Gt,6,2,"ng-template",null,1,te),n&2){let l=Y(2),a=C();m("ngIf",a.data.length)("ngIfElse",l)}}function Bt(n,d){if(n&1&&(J(0),u(1,"app-custom-table",19),K()),n&2){let l=C(2);s(),m("columns",l.columnsDesembolsos)("displayedColumns",l.columnsDesembolsos)("columnPropertyMap",l.columnPropertyMapDesembolsos)("data",l.data)("buttons",l.buttonsView)("searchTerm",l.searchTerm)}}function kt(n,d){n&1&&(i(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),r(4,"Informaci\xF3n"),o(),r(5," No hay solicitudes aprobadas hasta el momento. "),o()()()),n&2&&(s(2),m("type","info")("appearance","outline"))}function Ot(n,d){if(n&1&&v(0,Bt,2,6,"ng-container",18)(1,kt,6,2,"ng-template",null,1,te),n&2){let l=Y(2),a=C();m("ngIf",a.data.length)("ngIfElse",l)}}var ft=(()=>{let d=class d{constructor(){this.datePipe=p(D),this.currencyPipe=p(x),this.router=p(R),this.selectedTab=T.PENDIENTE,this._matDialog=p(ce),this.estadoDatosService=p(ye),this.solicitudService=p(Q),this.detalleConsumoService=p(N),this.fuseService=p($),this.exportData=[],this.searchTerm="",this.data=[],this.columns=["Fecha de solicitud","Identificaci\xF3n","Trabajador","Empresa","Cargo","Tipo de contrato","Fecha de inicio contrato","Fecha fin de contrato","Salario devengado","Cupo solicitado","Tipo de solicitud","Tipo de cuenta","N\xFAmero de cuenta","Estado"],this.columnPropertyMap={"Fecha de solicitud":"fechaCreacion",Identificaci\u00F3n:"documentoTrabajador",Trabajador:"nombreTrabajador",Empresa:"nombreSubEmpresa",Cargo:"cargoTrabajador","Tipo de contrato":"tipoContratoTrabajador","Fecha de inicio contrato":"fechaInicioContratoTrabajador","Fecha fin de contrato":"fechaFinContratoTrabajador","Salario devengado":"salarioDevengadoTrabajador","Cupo solicitado":"cupo","Tipo de solicitud":"nombreTipoSolicitud","Tipo de cuenta":"tipoCuentaTrabajador","N\xFAmero de cuenta":"numeroCuentaTrabajador",Estado:"nombreEstadoSolicitud"},this.columnsDesembolsos=["Fecha de solicitud","Identificaci\xF3n","Trabajador","Empresa","Cargo","Tipo de contrato","Fecha de inicio contrato","Fecha fin de contrato","Salario devengado","Monto solicitado","Cupo disponible","Tipo de consumo","Tipo de cuenta","Banco","N\xFAmero de cuenta","Estado"],this.columnPropertyMapDesembolsos={"Fecha de solicitud":"fechaCreacion",Identificaci\u00F3n:"documentoTrabajador",Trabajador:"nombreTrabajador",Empresa:"nombreEmpresaTrabajador",Cargo:"cargoTrabajador","Tipo de contrato":"tipoContratoTrabajador","Fecha de inicio contrato":"fechaInicioContratoTrabajador","Fecha fin de contrato":"fechaFinContratoTrabajador","Salario devengado":"salarioDevengadoTrabajador","Monto solicitado":"montoConsumo","Cupo disponible":"cupoDisponibleTrabajador","Tipo de consumo":"tipoConsumo","Tipo de cuenta":"tipoCuentaTrabajador",Banco:"bancotrabajador","N\xFAmero de cuenta":"numeroCuentaTrabajador",Estado:"nombreEstadoCredito"},this.buttons=[{label:"View",icon:"visibility",action:a=>{console.log("Approve",a),this.selectedData=a,this.router.navigate(["pages/gestion-creditos/solicitudes/estados",this.selectedData.id])}}],this.buttonsApprove=[{label:"View",icon:"visibility",action:a=>{console.log("Approve",a),this.selectedData=a,this.router.navigate(["pages/gestion-creditos/desembolsos/registrar",this.selectedData.id])}}],this.buttonsView=[{label:"View",icon:"visibility",action:a=>{console.log("Approve",a),this.selectedData=a,this.router.navigate(["pages/gestion-creditos/desembolsos/view",this.selectedData.id])}}],this.buttonsPendiente=[{label:"View",icon:"visibility",action:a=>{console.log("Approve",a),this.selectedData=a,this.router.navigate(["pages/gestion-creditos/desembolsos/desembolso",this.selectedData.id])}}],this.tabChanged=a=>{this.tabIndex=a.index,this.selectedTab=a.index==0?T.PENDIENTE:a.index==1?j.RECHAZADA:a.index==2?j.APROBADA:a.index==3?j.REALIZADA:Z.APROBADA,[T.PENDIENTE].includes(this.selectedTab)?this.getSolicitudes(this.selectedTab):[j.RECHAZADA,j.APROBADA,j.REALIZADA].includes(this.selectedTab)&&this.getDesembolsos(this.selectedTab)}}getSolicitudes(a){this.subcription$=this.solicitudService.getSolicitudesDesembolso(a).pipe(W(t=>(t.data.forEach(e=>{e.estado?e.estado=ie.ACTIVO:e.estado=ie.INACTIVO}),t)),W(t=>(t.data.forEach(e=>{e.fechaCreacion=this.datePipe.transform(e.fechaCreacion,"dd/MM/yyyy"),e.fechaInicioContratoTrabajador=this.datePipe.transform(e.fechaInicioContratoTrabajador,"dd/MM/yyyy"),e.fechaFinContratoTrabajador=this.datePipe.transform(e.fechaFinContratoTrabajador,"dd/MM/yyyy"),e.cupo=this.currencyPipe.transform(e.cupo,"USD","symbol","1.2-2"),e.salarioDevengadoTrabajador=this.currencyPipe.transform(e.salarioDevengadoTrabajador,"USD","symbol","1.2-2")}),t))).subscribe(t=>{t?(this.data=t.data,this.convertDataExportPendiente(t.data)):this.data=[]},t=>{this.data=[]})}getDesembolsos(a){this.subcription$=this.detalleConsumoService.getDetallesConsumoDesembolsos(a).pipe(W(t=>(t.data.forEach(e=>{e.estado?e.estado=ie.ACTIVO:e.estado=ie.INACTIVO}),t)),W(t=>(t.data.forEach(e=>{e.fechaCreacion=this.datePipe.transform(e.fechaCreacion,"dd/MM/yyyy"),e.fechaInicioContratoTrabajador=this.datePipe.transform(e.fechaInicioContratoTrabajador,"dd/MM/yyyy"),e.fechaFinContratoTrabajador=this.datePipe.transform(e.fechaFinContratoTrabajador,"dd/MM/yyyy"),e.salarioDevengadoTrabajador=this.currencyPipe.transform(e.salarioDevengadoTrabajador,"USD","symbol","1.2-2"),e.montoConsumo=this.currencyPipe.transform(e.montoConsumo,"USD","symbol","1.2-2"),e.cupoDisponibleTrabajador=this.currencyPipe.transform(e.cupoDisponibleTrabajador,"USD","symbol","1.2-2")}),t))).subscribe(t=>{t?(this.data=t.data,this.convertDataExport(t.data)):this.data=[]},t=>{this.data=[]})}onSearch(a){let t=a.target;this.searchTerm=t.value.trim().toLowerCase()}convertDataExport(a){let t=a.map(e=>({FechaSolicitud:e.fechaCreacion,Identificacion:e.documentoTrabajador,Trabajador:e.nombreTrabajador,Empresa:e.nombreSubEmpresa,Cargo:e.cargoTrabajador,TipoContrato:e.tipoContratoTrabajador,FechaInicioContrato:e.fechaInicioContratoTrabajador,FechaFinContrato:e.fechaFinContratoTrabajador,SalarioDevengado:e.salarioDevengadoTrabajador,MontoSolicitado:e.montoConsumo,CupoDisponible:e.cupoDisponibleTrabajador,TipoConsumo:e.tipoConsumo,TipoCuenta:e.tipoCuentaTrabajador,Banco:e.bancotrabajador,NumeroCuenta:e.numeroCuentaTrabajador,Estado:e.nombreEstadoCredito}));this.exportData=t}convertDataExportPendiente(a){let t=a.map(e=>({FechaSolicitud:e.fechaCreacion,Identificacion:e.documentoTrabajador,Trabajador:e.nombreTrabajador,Empresa:e.nombreSubEmpresa,Cargo:e.cargoTrabajador,TipoContrato:e.tipoContratoTrabajador,FechaInicioContrato:e.fechaInicioContratoTrabajador,FechaFinContrato:e.fechaFinContratoTrabajador,SalarioDevengado:e.salarioDevengadoTrabajador,CupoSolicitado:e.cupoDisponibleTrabajador,TipoSolicitud:e.nombreTipoSolicitud,TipoCuenta:e.tipoCuentaTrabajador,Banco:e.bancotrabajador,NumeroCuenta:e.numeroCuentaTrabajador,Estado:e.nombreEstadoSolicitud}));this.exportData=t}ngOnDestroy(){this.subcription$.unsubscribe()}ngOnInit(){this.getSolicitudes(this.selectedTab),this.listenGrid()}listenGrid(){this.estadoDatosService.stateGridSolicitudes.asObservable().subscribe(t=>{t.state&&(console.log("Si entro"),console.log(t),this.selectedTab=t.tab==0?T.PENDIENTE:t.tab==1?Z.RECHAZADA:t.tab==2?Z.APROBADA:t.tab==3?Z.REALIZADA_DESEMBOLSO:Z.APROBADA,this.tabIndex=t.tab)})}exportToExcel(a){this.fuseService.open(_({},tt)).afterClosed().subscribe(e=>{if(e==="confirmed"){let c=_e.json_to_sheet(a),f=_e.book_new();_e.book_append_sheet(f,c,"Sheet1"),mt(f,`Desembolsos${this.datePipe.transform(new Date,"dd/MM/yyyy")}.xlsx`)}})}};d.\u0275fac=function(t){return new(t||d)},d.\u0275cmp=w({type:d,selectors:[["app-grid-desembolsos"]],standalone:!0,features:[F([D,x]),A],decls:23,vars:12,consts:[["tabGroup",""],["noData",""],[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","px-6","py-6","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-0","mt-2","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color","ngClass","disabled"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:overflow-y-auto","bg-gray-100"],["mat-stretch-tabs","false",1,"sm:px-2",3,"selectedIndexChange","selectedTabChange","animationDuration","selectedIndex"],["label","Pendientes"],["matTabContent",""],["label","Rechazadas"],["label","Aprobadas"],["label","Realizados"],[4,"ngIf","ngIfElse"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons","searchTerm"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"inline-block","p-4","sm:p-2","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""]],template:function(t,e){if(t&1){let c=M();i(0,"div",2)(1,"div",3)(2,"div",4),r(3,"Desembolsos"),o(),i(4,"div",5)(5,"mat-form-field",6),u(6,"mat-icon",7),i(7,"input",8),E("input",function(g){return S(c),y(e.onSearch(g))}),o()(),i(8,"button",9),E("click",function(){return S(c),y(e.exportToExcel(e.exportData))}),i(9,"span"),r(10," Exportar "),o()()()(),i(11,"div",10)(12,"div",11)(13,"mat-tab-group",12,0),ke("selectedIndexChange",function(g){return S(c),Be(e.tabIndex,g)||(e.tabIndex=g),y(g)}),E("selectedTabChange",function(g){return S(c),y(e.tabChanged(g))}),i(15,"mat-tab",13),v(16,jt,3,2,"ng-template",14),o(),i(17,"mat-tab",15),v(18,Pt,3,2,"ng-template",14),o(),i(19,"mat-tab",16),v(20,Rt,3,2,"ng-template",14),o(),i(21,"mat-tab",17),v(22,Ot,3,2,"ng-template",14),o()()()()()}t&2&&(s(5),m("subscriptSizing","dynamic"),s(),m("svgIcon","heroicons_solid:magnifying-glass"),s(),m("autocomplete","off")("placeholder","Buscar"),s(),m("color","primary")("ngClass",qe(9,Ft,e.exportData.length,!e.exportData.length))("disabled",!e.exportData.length),s(5),m("animationDuration","500"),Re("selectedIndex",e.tabIndex))},dependencies:[et,Ke,L,q,ue,H,st,nt,lt,V,$e]});let n=d;return n})();var qt=["stepper"],Lt={validation:!1},bt=(()=>{let d=class d{constructor(){this.fuseService=p($),this.router=p(R),this.fb=p(xe),this.activatedRoute=p(G),this.solicitudService=p(Q),this.empleadosServices=p(U),this.currencyPipe=p(x),this.swalService=p(De),this.errorHandlerService=p(we),this.showAlert=!1,this.alert={type:"success",message:""}}ngOnDestroy(){}ngOnInit(){this.createForm();let a=this.activatedRoute.snapshot.paramMap.get("id");this.getSolicitud(a)}getSolicitud(a){this.subscription$=this.solicitudService.getSolicitud(a).pipe(ne(t=>{let e={idTipoDoc:t.data.trabajador.idTipoDoc,numDocumento:t.data.trabajador.numDoc};return this.empleadosServices.getEmpleadoParams(e)})).subscribe(t=>{if(t){this.showAlert=!1;let e={numDoc:t.data.numDoc,primerNombre:t.data.primerNombre,segundoNombre:t.data.segundoNombre,primerApellido:t.data.primerApellido,segundoApellido:t.data.segundoApellido,idTrabajador:t.data.id,correo:t.data.correo,credito:t.data.creditos[0].numCredito+" - "+this.currencyPipe.transform(t.data.creditos[0].cupoDisponible,"USD","symbol","1.2-2"),idCredito:t.data.creditos[0].id,numCuentaBancaria:t.data.numCuentaBancaria,idTipoCuenta:t.data.idTipoCuenta,id:a};this.secondFormGroup.patchValue(e)}},t=>{this.alert={type:"error",message:"El trabajador no existe!"},this.showAlert=!0})}onApprove(){if(this.secondFormGroup.valid){let{id:a,idCredito:t,idTrabajador:e}=this.secondFormGroup.getRawValue(),c={id:a,idEstado:T.APROBADA};this.fuseService.open(_({},oe)).afterClosed().subscribe(g=>{g==="confirmed"&&this.solicitudService.patchSolicitudDesembolso(c).subscribe(I=>{this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.router.navigate(["pages/gestion-creditos/desembolsos"])},I=>{this.errorHandlerService.errorHandler(I)})})}}onRechazar(){if(this.secondFormGroup.valid){let{id:a,idCredito:t,idTrabajador:e}=this.secondFormGroup.getRawValue(),c={id:a,idEstado:T.RECHAZADA};this.fuseService.open(_({},oe)).afterClosed().subscribe(g=>{g==="confirmed"&&this.solicitudService.patchSolicitudDesembolso(c).subscribe(I=>{this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.router.navigate(["pages/gestion-creditos/desembolsos"])},I=>{this.errorHandlerService.errorHandler(I)})})}}cerrar(){this.router.navigate(["/pages/gestion-creditos/desembolsos"])}createForm(){this.secondFormGroup=this.fb.group({numDoc:["",b.required],primerNombre:["",b.required],segundoNombre:[""],primerApellido:["",b.required],segundoApellido:[""],idTrabajador:[""],correo:["",b.required],credito:["",b.required],idCredito:["",b.required],numCuentaBancaria:[""],idTipoCuenta:[""],id:[""]})}};d.\u0275fac=function(t){return new(t||d)},d.\u0275cmp=w({type:d,selectors:[["app-form-approve-desembolso"]],viewQuery:function(t,e){if(t&1&&se(qt,5),t&2){let c;le(c=me())&&(e.stepper=c.first)}},standalone:!0,features:[F([{provide:k,useClass:X},{provide:B,useValue:"en-GB"},D,x,z(Lt)]),A],decls:51,vars:14,consts:[["stepper",""],["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","items-center","overflow-y-auto","bg-gray-100","p-6","sm:p-8"],[1,"relative","w-full","flex-0","max-w-4xl","sm:rounded-lg","overflow-hidden"],[1,"p-2","text-3xl","font-semibold","text-center","text-gray-800"],[1,"w-full","px-6","py-4",3,"orientation","linear","animationDuration"],["label","Verificar informaci\xF3n",3,"stepControl"],[1,"w-full"],[1,"space-y-4","w-full","max-w-lg","mx-auto",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-4"],["matInput","","readonly","",3,"formControlName"],[1,"flex","flex-col"],[1,"flex","flex-wrap","justify-center","sm:justify-center","gap-4","mt-2"],["mat-button","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediorange-100","rounded-lg",3,"click"],["mat-button","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediblue-50","rounded-lg","hover:bg-opacity-80",3,"click"]],template:function(t,e){if(t&1){let c=M();i(0,"div",1)(1,"div",2)(2,"div",3),r(3),o(),i(4,"mat-stepper",4,0)(6,"mat-step",5)(7,"div",6)(8,"form",7)(9,"div",8)(10,"mat-form-field",6)(11,"mat-label"),r(12,"Primer nombre"),o(),u(13,"input",9),o(),i(14,"mat-form-field",6)(15,"mat-label"),r(16,"Segundo nombre"),o(),u(17,"input",9),o()(),i(18,"div",8)(19,"mat-form-field",6)(20,"mat-label"),r(21,"Primer apellido"),o(),u(22,"input",9),o(),i(23,"mat-form-field",6)(24,"mat-label"),r(25,"Segundo apellido"),o(),u(26,"input",9),o()(),i(27,"div",8)(28,"mat-form-field",6)(29,"mat-label"),r(30,"Identificaci\xF3n"),o(),u(31,"input",9),o(),i(32,"mat-form-field",6)(33,"mat-label"),r(34,"Email"),o(),u(35,"input",9),o()(),i(36,"div",10)(37,"mat-form-field",6)(38,"mat-label"),r(39,"Cr\xE9dito / Cupo disponible"),o(),u(40,"input",9),o()(),i(41,"div",10)(42,"mat-form-field",6)(43,"mat-label"),r(44,"N\xFAmero de cuenta"),o(),u(45,"input",9),o()()(),i(46,"div",11)(47,"button",12),E("click",function(){return S(c),y(e.onRechazar())}),r(48,"Rechazar"),o(),i(49,"button",13),E("click",function(){return S(c),y(e.onApprove())}),r(50,"Aprobar"),o()()()()()()()}t&2&&(s(3),de(" ","Desembolso"," "),s(),m("orientation","vertical")("linear",!0)("animationDuration","1500"),s(2),m("stepControl",e.secondFormGroup),s(2),m("formGroup",e.secondFormGroup),s(5),m("formControlName","primerNombre"),s(4),m("formControlName","segundoNombre"),s(5),m("formControlName","primerApellido"),s(4),m("formControlName","segundoApellido"),s(5),m("formControlName","numDoc"),s(4),m("formControlName","correo"),s(5),m("formControlName","credito"),s(5),m("formControlName","numCuentaBancaria"))},dependencies:[O,Te,L,q,H,pe,Ee,Se,ge,fe,be,he,ve,Ce]});let n=d;return n})();var $t=()=>["/pages/gestion-creditos/desembolsos"];function Ht(n,d){if(n&1&&(i(0,"div",8)(1,"div",9)(2,"div")(3,"h3",10),r(4),o(),i(5,"p",11),r(6,"Identificaci\xF3n: "),i(7,"span",12),r(8),o()(),i(9,"p",11),r(10,"Empresa: "),i(11,"span",12),r(12),o()(),i(13,"p",13),r(14,"Cargo: "),i(15,"span",12),r(16),o()(),i(17,"p",13),r(18,"Tipo de contrato: "),i(19,"span",12),r(20),o()(),i(21,"p",13),r(22,"Salario devengado: "),i(23,"span",12),r(24),P(25,"currency"),o()(),i(26,"p",11),r(27,"Correo: "),i(28,"span",12),r(29),o()(),i(30,"p",11),r(31,"Direcci\xF3n: "),i(32,"span",12),r(33),o()(),i(34,"p",11),r(35,"Tel\xE9fono: "),i(36,"span",12),r(37),o()()(),i(38,"div")(39,"p",11),r(40,"Estado de Desembolso: "),i(41,"span",12),r(42),o()(),i(43,"p",11),r(44,"Valor de desembolso: "),i(45,"span",12),r(46),P(47,"currency"),o()(),i(48,"p",11),r(49,"Fecha de Solicitud: "),i(50,"span",12),r(51),P(52,"date"),o()()()()()),n&2){let l=C();s(4),Ge(" ",l.items.trabajador.primerNombre," ",l.items.trabajador.segundoNombre," ",l.items.trabajador.primerApellido," ",l.items.trabajador.segundoApellido," "),s(4),h(l.items.trabajador.numDoc),s(4),h(l.items.trabajador.nombreSubEmpresa),s(4),h(l.items.trabajador.cargo),s(4),h(l.items.trabajador.nombreTipoContrato),s(4),h(ee(25,15,l.items.trabajador.salarioDevengado,"USD")),s(5),h(l.items.trabajador.correo),s(4),h(l.items.trabajador.direccion),s(4),h(l.items.trabajador.telefono),s(5),h(l.items.nombreEstadoCredito),s(4),h(Le(47,18,l.items.montoConsumo)),s(5),h(ee(52,20,l.items.fechaCreacion,"dd/MM/yyyy"))}}var zt={validation:!1},ht=(()=>{let d=class d{constructor(){this.activatedRoute=p(G),this._matDialog=p(ce),this.detalleConsumoService=p(N),this.currencyPipe=p(x),this.empleadosServices=p(U),this.showAlert=!1,this.alert={type:"success",message:""}}ngOnDestroy(){this.subscription$.unsubscribe()}ngOnInit(){let a=this.activatedRoute.snapshot.paramMap.get("id");this.getSolicitud(a)}getSolicitud(a){this.subscription$=this.detalleConsumoService.getDetalleConsumoDesembolso(a).subscribe(t=>{t&&(this.showAlert=!1,this.items=t.data)},t=>{this.alert={type:"error",message:"El trabajador no existe!"},this.showAlert=!0})}};d.\u0275fac=function(t){return new(t||d)},d.\u0275cmp=w({type:d,selectors:[["app-form-view-desembolso"]],standalone:!0,features:[F([{provide:k,useClass:X},{provide:B,useValue:"en-GB"},D,x,z(zt)]),A],decls:10,vars:4,consts:[["cdkScrollable","",1,"absolute","inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"inline-block","p-4","sm:p-6","md:p-10","print:p-0","w-full"],[1,"bg-card","shadow","print:bg-transparent","print:p-0","print:shadow-none","rounded-2xl","max-w-4xl","mx-auto","overflow-hidden"],[1,"bg-crediblue-50","px-4","py-3","sm:px-6","sm:py-4","flex","items-center","justify-between"],["mat-button","",1,"flex","items-center",3,"routerLink"],[1,"text-white",3,"svgIcon"],[1,"text-lg","sm:text-xl","font-bold","text-white"],["class","p-4 sm:p-6",4,"ngIf"],[1,"p-4","sm:p-6"],[1,"mb-4","flex","flex-col","md:flex-row","md:justify-between","gap-4"],[1,"text-lg","sm:text-xl","font-semibold","text-gray-800"],[1,"font-medium","text-gray-600"],[1,"text-md","text-secondary"],[1,"text-gray-600","font-medium"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"a",4),u(6,"mat-icon",5),o()(),i(7,"h2",6),r(8,"Detalle de Desembolso"),o()(),v(9,Ht,53,23,"div",7),o()()()),t&2&&(s(5),m("routerLink",Oe(3,$t)),s(),m("svgIcon","heroicons_outline:arrow-long-left"),s(3),m("ngIf",e.items))},dependencies:[O,x,D,Ze,ue,V,Xe]});let n=d;return n})();var Ui=[{path:"",component:ft},{path:"desembolso/:id",component:bt},{path:"registrar/:id",component:ut},{path:"view/:id",component:ht}];export{Ui as default};
