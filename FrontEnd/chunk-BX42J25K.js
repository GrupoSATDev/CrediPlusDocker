import{a as Fe}from"./chunk-F6JYC5SX.js";import{a as Ue}from"./chunk-5WR2EL64.js";import{a as we}from"./chunk-73EAHMKU.js";import{a as De}from"./chunk-UERFI565.js";import{a as Te}from"./chunk-OFI6PGZL.js";import{b as Y}from"./chunk-YHNXG437.js";import{a as H}from"./chunk-VOLXTRGQ.js";import{a as Z}from"./chunk-6IEWE3OU.js";import{a as ye}from"./chunk-AW4GAERC.js";import{a as be}from"./chunk-JC77WSFI.js";import{a as xe}from"./chunk-YDQKZREE.js";import{g as de}from"./chunk-2XRFSBL3.js";import{a as ne,b as se,c as me}from"./chunk-BF24YLJO.js";import"./chunk-CNRP5CR4.js";import{C as Ce,E as Se,F as Ee,J as z,b as le,c as ce,i as q,l as ue,n as d,p as fe,q as _e,u as ge,x as he,y as ve}from"./chunk-D3YOWHEC.js";import"./chunk-AIQUJILU.js";import{ba as re,ga as G,ia as pe,la as B}from"./chunk-V35GW63T.js";import"./chunk-AUCKEBH6.js";import{b as M}from"./chunk-ASJLYKSH.js";import{Cb as h,Cc as ae,Ea as te,Eb as T,Lb as x,Mb as c,Mc as V,Nb as U,Ob as A,Qa as a,Ra as L,Vb as O,_ as b,ba as y,bc as D,cc as I,ga as v,gb as p,ha as g,ib as l,ma as j,pb as f,q as X,tb as s,ub as m,vb as _,wa as S,wb as w,xa as E,xb as F,yc as ie,zb as N,zc as oe}from"./chunk-YBEOGPR3.js";import{a as $,d as R}from"./chunk-NEB6MB4Y.js";var J=(()=>{let i=class i{constructor(o,t){this._http=o,this.appSettingService=t}getUsuarios(){return this._http.get(`${this.appSettingService.usuarios.url.base}/Table`)}getUsuario(o){return this._http.get(`${this.appSettingService.usuarios.url.base}/Empresa/${o}`)}postUsuarios(o){return delete o.id,this._http.post(`${this.appSettingService.usuarios.url.base}/RegistroEmpresas`,o)}putUsuario(o){let t=o.id;return delete o.id,this._http.put(`${this.appSettingService.usuarios.url.base}/Empresa/${t}`,o)}};i.\u0275fac=function(t){return new(t||i)(v(V),v(M))},i.\u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})();var Me=(()=>{let i=class i{constructor(o,t){this._http=o,this.appSettingService=t}getTipoUsuarios(){return this._http.get(`${this.appSettingService.tipoUsuarios.url.base}`)}};i.\u0275fac=function(t){return new(t||i)(v(V),v(M))},i.\u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})();var Ne=(()=>{let i=class i{constructor(o,t){this._http=o,this.appSettingService=t}getRoles(){return this._http.get(`${this.appSettingService.roles.url.base}`)}};i.\u0275fac=function(t){return new(t||i)(v(V),v(M))},i.\u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})();function $e(e,i){if(e&1){let r=N();s(0,"div",8)(1,"div",23),h("click",function(){S(r);let t=x(5);return E(t.toggle())}),s(2,"div",24),c(3),m()(),_(4,"mat-slide-toggle",25,1),m()}if(e&2){let r=T();a(3),A(" Estado ",r.form.get("estado").value?"Activo":"Inactivo"," "),a(),l("color","primary")("formControlName","estado")}}function Re(e,i){if(e&1&&(s(0,"mat-option",27),c(1),m()),e&2){let r=i.$implicit;l("value",r.id),a(),U(r.nombre)}}function je(e,i){if(e&1&&(w(0),p(1,Re,2,2,"mat-option",26),F()),e&2){let r=i.ngIf;a(),l("ngForOf",r.data)}}function Le(e,i){if(e&1){let r=N();s(0,"div",8)(1,"div",23),h("click",function(){S(r);let t=x(5);return E(t.toggle())}),s(2,"div",24),c(3),m()(),_(4,"mat-slide-toggle",25,1),m()}if(e&2){let r=T();a(3),A(" Establecer nueva contrase\xF1a ? ",r.form.get("estadoContrasena").value?"Si":"No"," "),a(),l("color","primary")("formControlName","estadoContrasena")}}function Oe(e,i){e&1&&_(0,"mat-icon",30),e&2&&l("svgIcon","heroicons_solid:eye")}function qe(e,i){e&1&&_(0,"mat-icon",30),e&2&&l("svgIcon","heroicons_solid:eye-slash")}function Ge(e,i){e&1&&c(0," La contrase\xF1a es requerida!. ")}function Be(e,i){e&1&&c(0," El m\xEDnimo de caracteres son 5. ")}function ze(e,i){e&1&&c(0," El maximo de caracteres son 20. ")}function He(e,i){if(e&1&&(s(0,"mat-error"),p(1,Ge,1,0)(2,Be,1,0)(3,ze,1,0),m()),e&2){let r=T(2);a(),f(r.form.get("contrasena").hasError("required")?1:-1),a(),f(r.form.get("contrasena").hasError("minlength")?2:-1),a(),f(r.form.get("contrasena").hasError("maxlength")?3:-1)}}function Pe(e,i){e&1&&_(0,"mat-icon",30),e&2&&l("svgIcon","heroicons_solid:eye")}function Je(e,i){e&1&&_(0,"mat-icon",30),e&2&&l("svgIcon","heroicons_solid:eye-slash")}function Ke(e,i){e&1&&c(0," La confirmaci\xF3n de contrase\xF1a es requerida!. ")}function Qe(e,i){e&1&&c(0," El m\xEDnimo de caracteres son 5. ")}function We(e,i){e&1&&c(0," El maximo de caracteres son 20. ")}function Xe(e,i){e&1&&c(0," Las contrase\xF1as no coinciden! ")}function Ye(e,i){if(e&1&&(s(0,"mat-error"),p(1,Ke,1,0)(2,Qe,1,0)(3,We,1,0)(4,Xe,1,0),m()),e&2){let r=T(2);a(),f(r.form.get("confirmaContrasena").hasError("required")?1:-1),a(),f(r.form.get("confirmaContrasena").hasError("minlength")?2:-1),a(),f(r.form.get("confirmaContrasena").hasError("maxlength")?3:-1),a(),f(r.form.get("confirmaContrasena").hasError("passwordMismatchError")?4:-1)}}function Ze(e,i){if(e&1){let r=N();s(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),c(3,"Contrase\xF1a"),m(),_(4,"input",28,2),s(6,"button",29),h("click",function(){S(r);let t=x(5);return E(t.type==="password"?t.type="text":t.type="password")}),p(7,Oe,1,1,"mat-icon",30)(8,qe,1,1,"mat-icon",30),m(),p(9,He,4,3,"mat-error"),m(),s(10,"mat-form-field",10)(11,"mat-label"),c(12,"Confirmar contrase\xF1a"),m(),_(13,"input",31,3),s(15,"button",29),h("click",function(){S(r);let t=x(14);return E(t.type==="password"?t.type="text":t.type="password")}),p(16,Pe,1,1,"mat-icon",30)(17,Je,1,1,"mat-icon",30),m(),p(18,Ye,5,4,"mat-error"),m()()}if(e&2){let r=x(5),o=x(14),t=T();a(4),l("formControlName","contrasena"),a(3),f(r.type==="password"?7:-1),a(),f(r.type==="text"?8:-1),a(),f(t.form.get("contrasena").dirty||t.form.get("contrasena").touched?9:-1),a(4),l("formControlName","confirmaContrasena"),a(3),f(o.type==="password"?16:-1),a(),f(o.type==="text"?17:-1),a(),f(t.form.get("confirmaContrasena").dirty||t.form.get("confirmaContrasena").touched?18:-1)}}function et(e,i){if(e&1&&(s(0,"mat-option",27),c(1),m()),e&2){let r=i.$implicit;l("value",r.id),a(),U(r.nombre)}}function tt(e,i){if(e&1&&(w(0),p(1,et,2,2,"mat-option",26),F()),e&2){let r=i.ngIf;a(),l("ngForOf",r.data)}}function it(e,i){if(e&1&&(s(0,"mat-option",27),c(1),m()),e&2){let r=i.$implicit;l("value",r.id),a(),U(r.razonSocial)}}function ot(e,i){if(e&1&&(w(0),p(1,it,2,2,"mat-option",26),F()),e&2){let r=i.ngIf;a(),l("ngForOf",r.data)}}function at(e,i){if(e&1&&(s(0,"mat-option",27),c(1),m()),e&2){let r=i.$implicit;l("value",r.id),a(),U(r.nombre)}}function rt(e,i){if(e&1&&(w(0),p(1,at,2,2,"mat-option",26),F()),e&2){let r=i.ngIf;a(),l("ngForOf",r.data)}}function nt(e,i){if(e&1&&(s(0,"mat-option",27),c(1),m()),e&2){let r=i.$implicit;l("value",r.id),a(),U(r.nombre)}}function st(e,i){if(e&1&&(w(0),p(1,nt,2,2,"mat-option",26),F()),e&2){let r=i.ngIf;a(),l("ngForOf",r.data)}}var ee=(()=>{let i=class i{constructor(){this.fb=g(Ce),this._locacionService=g(we),this.dialogRef=g(ne),this.fuseService=g(de),this.estadosDatosService=g(H),this.usuariosService=g(J),this.tipoUsuariosService=g(Me),this.empresaClienteService=g(Fe),this.rolesService=g(Ne),this._matData=g(se),this.swalService=g(Te),this.destroyedRef=g(te),this.departamentos$=this._locacionService.getDepartamentos().pipe(b(o=>{let t=o.data,n=this._matData;if(t&&!n.edit){this.form.get("idDepartamento").setValue(t[0].id);let u=this.form.get("idDepartamento").value;this.getMunicipios(u)}})),this.tipoUsuarios$=this.tipoUsuariosService.getTipoUsuarios().pipe(b(o=>{let t=o.data,n=this._matData;t&&!n.edit&&this.form.get("idTipoUsuario").setValue(t[0].id)})),this.roles$=this.rolesService.getRoles().pipe(b(o=>{let t=o.data,n=this._matData;t&&!n.edit&&this.form.get("idRol").setValue(t[0].id)})),this.empresas$=this.empresaClienteService.getEmpresasClientesSelect().pipe(b(o=>{let t=o.data,n=this._matData;t&&!n.edit&&this.form.get("idSubEmpresa").setValue(t[0].id)}))}onSelected(o){let t=o.value;this.getMunicipios(t)}getMunicipios(o){this.municipios$=this._locacionService.getMunicipio(o).pipe(b(t=>{let n=t.data,u=this._matData;n&&!u.edit&&this.form.get("idMunicipio").setValue(n[0].id)}))}ngOnInit(){this.createForm();let o=this._matData;if(o.edit){let t=o.data;this.getUsuario(t.id),this.form.get("estadoContrasena").valueChanges.pipe(Ue(this.destroyedRef)).subscribe(n=>{n?(this.form.get("contrasena").setValidators([d.required,d.minLength(5),d.maxLength(20)]),this.form.get("confirmaContrasena").setValidators([d.required,d.minLength(5),d.maxLength(20)]),this.form.get("contrasena").updateValueAndValidity(),this.form.get("confirmaContrasena").updateValueAndValidity()):(this.form.get("contrasena").removeValidators([d.required]),this.form.get("confirmaContrasena").removeValidators([d.required]),this.form.get("contrasena").setValue(""),this.form.get("confirmaContrasena").setValue(""),this.form.get("contrasena").updateValueAndValidity(),this.form.get("confirmaContrasena").updateValueAndValidity())})}}createForm(){this.form=this.fb.group({id:[null],nombre:["",[d.required]],apellido:["",[d.required]],correo:["",[d.required]],contrasena:["",[d.required,d.minLength(5),d.maxLength(20)]],confirmaContrasena:["",[d.required,d.minLength(5),d.maxLength(20)]],idRol:[""],idSubEmpresa:[""],idTipoUsuario:[""],idDepartamento:[""],idMunicipio:[""],estado:[!0],estadoContrasena:[!0]},{validators:mt("contrasena","confirmaContrasena")})}onSave(){if(this.form.valid)if(this._matData.edit){let t=this.form.getRawValue(),{idDepartamento:u,confirmaContrasena:C,estadoContrasena:K}=t,Q=R(t,["idDepartamento","confirmaContrasena","estadoContrasena"]);this.fuseService.open($({},Y)).afterClosed().subscribe(W=>{W==="confirmed"?this.usuariosService.putUsuario(Q).subscribe(k=>{this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.closeDialog()},k=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})}):this.closeDialog()})}else{let o=this.form.getRawValue(),{idDepartamento:u,confirmaContrasena:C,estadoContrasena:K}=o,Q=R(o,["idDepartamento","confirmaContrasena","estadoContrasena"]);this.fuseService.open($({},Y)).afterClosed().subscribe(W=>{W==="confirmed"?this.usuariosService.postUsuarios(Q).subscribe(k=>{console.log(k),this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.closeDialog()},k=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})}):this.closeDialog()})}else this.form.markAllAsTouched()}getUsuario(o){this.usuariosService.getUsuario(o).subscribe(t=>{if(t){console.log(t.data);let n=t.data,{idDepartamento:u}=n,C=R(n,["idDepartamento"]);this.form.patchValue($({idDepartamento:u},C)),this.municipios$=this._locacionService.getMunicipio(u)}})}isEditContrasena(o){}closeDialog(){this.dialogRef.close()}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=j({type:i,selectors:[["app-form-usuarios-empresas"]],standalone:!0,features:[O],decls:65,vars:31,consts:[["data",""],["twoStepToggle",""],["passwordField",""],["passwordConfirm",""],[1,"w-full","sm:bg-card","sm:rounded-2xl","sm:mx-0","mx-auto"],[1,""],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"mt-8",3,"formGroup"],[1,"flex","mb-4"],[1,"flex","flex-col","lg:flex-row","mb-4","gap-2"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","Nombre",3,"formControlName"],["matInput","","placeholder","Apellido",3,"formControlName"],["placeholder","Tipo de usuario",3,"formControlName"],[4,"ngIf"],["id","nit","matInput","","placeholder","Correo",3,"formControlName"],["placeholder","Rol",3,"formControlName"],["placeholder","Empresa",3,"formControlName"],["placeholder","Departamento",3,"selectionChange","formControlName"],["placeholder","Ciudad",3,"formControlName"],[1,"flex","flex-wrap","justify-end","gap-2.5"],["mat-flat-button","",1,"lg:w-auto","w-full","lg:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","lg:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],[1,"fcursor-pointer",3,"click"],[1,"font-medium","leading-6"],[1,"ml-4",3,"color","formControlName"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["id","contrasena","matInput","","type","password","placeholder","Contrase\xF1a",3,"formControlName"],["mat-icon-button","","type","button","matSuffix","",3,"click"],[1,"icon-size-5",3,"svgIcon"],["id","confirmaContrasena","matInput","","type","password","placeholder","Confirmar contrase\xF1a",3,"formControlName"]],template:function(t,n){if(t&1){let u=N();s(0,"div",4)(1,"div",5)(2,"div",6),c(3),m(),s(4,"form",7),p(5,$e,6,3,"div",8),s(6,"div",9)(7,"mat-form-field",10)(8,"mat-label"),c(9,"Nombre"),m(),_(10,"input",11),m(),s(11,"mat-form-field",10)(12,"mat-label"),c(13,"Apellido"),m(),_(14,"input",12),m()(),s(15,"div",9)(16,"mat-form-field",10)(17,"mat-label"),c(18,"Tipo de usuario"),m(),s(19,"mat-select",13,0),p(21,je,2,1,"ng-container",14),D(22,"async"),m()(),s(23,"mat-form-field",10)(24,"mat-label"),c(25,"Correo"),m(),_(26,"input",15),m()(),s(27,"div",9),p(28,Le,6,3,"div",8),m(),p(29,Ze,19,8,"div",9),s(30,"div",9)(31,"mat-form-field",10)(32,"mat-label"),c(33,"Rol"),m(),s(34,"mat-select",16,0),p(36,tt,2,1,"ng-container",14),D(37,"async"),m()(),s(38,"mat-form-field",10)(39,"mat-label"),c(40,"Empresa"),m(),s(41,"mat-select",17),p(42,ot,2,1,"ng-container",14),D(43,"async"),m()()(),s(44,"div",9)(45,"mat-form-field",10)(46,"mat-label"),c(47,"Departamento"),m(),s(48,"mat-select",18,0),h("selectionChange",function(K){return S(u),E(n.onSelected(K))}),p(50,rt,2,1,"ng-container",14),D(51,"async"),m()(),s(52,"mat-form-field",10)(53,"mat-label"),c(54,"Ciudad"),m(),s(55,"mat-select",19),p(56,st,2,1,"ng-container",14),D(57,"async"),m()()(),s(58,"div",20)(59,"button",21),h("click",function(){return S(u),E(n.closeDialog())}),s(60,"span"),c(61," Cancelar "),m()(),s(62,"button",22),h("click",function(){return S(u),E(n.onSave())}),s(63,"span"),c(64),m()()()()()()}t&2&&(a(3),A(" ",n._matData.edit?"Actualizar usuario":"Agregar usuario"," "),a(),l("formGroup",n.form),a(),f(n._matData.edit?5:-1),a(5),l("formControlName","nombre"),a(4),l("formControlName","apellido"),a(5),l("formControlName","idTipoUsuario"),a(2),l("ngIf",I(22,21,n.tipoUsuarios$)),a(5),l("formControlName","correo"),a(2),f(n._matData.edit?28:-1),a(),f(n.form.get("estadoContrasena").value?29:-1),a(5),l("formControlName","idRol"),a(2),l("ngIf",I(37,23,n.roles$)),a(5),l("formControlName","idSubEmpresa"),a(),l("ngIf",I(43,25,n.empresas$)),a(6),l("formControlName","idDepartamento"),a(2),l("ngIf",I(51,27,n.departamentos$)),a(5),l("formControlName","idMunicipio"),a(),l("ngIf",I(57,29,n.municipios$)),a(3),l("color","primary"),a(3),l("color","primary"),a(2),A(" ",n._matData.edit?"Actualizar":"Guardar"," "))},dependencies:[Se,ge,ue,fe,_e,q,z,le,Ee,he,ve,ae,re,be,ie,oe,G,B,pe,ce,xe],styles:[".custom-dialog-container{width:100%}@media (min-width: 600px){  .custom-dialog-container{width:60%}}@media (min-width: 1280px){  .custom-dialog-container{width:50%}}"]});let e=i;return e})();function mt(e,i){return r=>{let o=r.get(e),t=r.get(i);return t?.errors&&!t.errors.passwordMismatchError||(o?.value!==t?.value?t?.setErrors({passwordMismatchError:!0}):t?.setErrors(null)),null}}var Ae=(()=>{let i=class i{constructor(o,t,n){this._matDialog=o,this.estadoDatosService=t,this.generoService=n,this.usuariosService=g(J),this.searchTerm="",this.data=[],this.columns=["Estado","Usuario","Nombre completo","Rol","Tipo de usuario"],this.columnPropertyMap={Estado:"estado",Usuario:"correo","Nombre completo":"nombreCompleto",Rol:"nombreRol","Tipo de usuario":"nombreTipoUsuario"},this.buttons=[{label:"Edit",icon:"edit",action:u=>{console.log("Editing",u),this.selectedData=u,this.onEdit()}}]}onNew(){this._matDialog.open(ee,{autoFocus:!1,data:{edit:!1},maxHeight:"90vh",disableClose:!0,panelClass:"custom-dialog-container"})}onEdit(){this._matDialog.open(ee,{autoFocus:!1,data:{edit:!0,data:this.selectedData},maxHeight:"90vh",disableClose:!0,panelClass:"custom-dialog-container"})}onSearch(o){let t=o.target;this.searchTerm=t.value.trim().toLowerCase()}getUsuarios(){this.subcription$=this.usuariosService.getUsuarios().pipe(X(o=>(o.data.forEach(t=>{t.estado?t.estado=Z.ACTIVO:t.estado=Z.INACTIVO}),o)),X(o=>(o.data.forEach(t=>{t&&(t.nombreCompleto=t.nombre.concat(" ",t.apellido))}),o))).subscribe(o=>{o.data&&(this.data=o.data)})}ngOnInit(){this.getUsuarios()}ngOnDestroy(){this.subcription$.unsubscribe()}};i.\u0275fac=function(t){return new(t||i)(L(me),L(H),L(De))},i.\u0275cmp=j({type:i,selectors:[["app-grid-usuarios-empresas"]],standalone:!0,features:[O],decls:15,vars:12,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons","searchTerm"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),c(3,"Usuarios"),m(),s(4,"div",3)(5,"mat-form-field",4),_(6,"mat-icon",5),s(7,"input",6),h("input",function(C){return n.onSearch(C)}),m()(),s(8,"button",7),h("click",function(){return n.onNew()}),_(9,"mat-icon",8),s(10,"span",9),c(11,"Agregar"),m()()()(),s(12,"div",10)(13,"div",11),_(14,"app-custom-table",12),m()()()),t&2&&(a(5),l("subscriptSizing","dynamic"),a(),l("svgIcon","heroicons_solid:magnifying-glass"),a(),l("autocomplete","off")("placeholder","Buscar"),a(),l("color","primary"),a(),l("svgIcon","heroicons_outline:plus"),a(5),l("columns",n.columns)("displayedColumns",n.columns)("columnPropertyMap",n.columnPropertyMap)("data",n.data)("buttons",n.buttons)("searchTerm",n.searchTerm))},dependencies:[ye,G,q,B,z]});let e=i;return e})();var Zt=[{path:"",component:Ae}];export{Zt as default};
