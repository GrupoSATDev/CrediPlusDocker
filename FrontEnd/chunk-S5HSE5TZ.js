import{a as $}from"./chunk-KTZIUJYP.js";import{a as Me}from"./chunk-37H4XIDI.js";import{a as De}from"./chunk-KUZAVRVO.js";import{a as Pe}from"./chunk-ZS22S3VX.js";import{a as we}from"./chunk-3L6CDPYN.js";import{a as _e,b as Ce,c as Te}from"./chunk-VMONEH2L.js";import{a as Ee,b as je}from"./chunk-5E3BI53K.js";import{a as Fe}from"./chunk-24W6POED.js";import{a as B}from"./chunk-HKOJEADL.js";import{b as Se}from"./chunk-4WJQLHI3.js";import{a as G}from"./chunk-HDKW2ETT.js";import{a as xe}from"./chunk-YRFWKKCQ.js";import"./chunk-ZVTEZKTX.js";import{g as de}from"./chunk-WPQBWK4Z.js";import{c as re}from"./chunk-4EGREALI.js";import"./chunk-D266PZ43.js";import{a as ye}from"./chunk-DTC2A3GX.js";import"./chunk-QBODUMHZ.js";import{C as he,G as O,b as ne,c as le,e as me,i as V,l as pe,n as T,p as ce,q as fe,u as ue,w as ge,x as be,z as ve}from"./chunk-BFUN2CON.js";import{$ as ie,Q as ae,R as oe,ea as N,ja as se}from"./chunk-PKP5UGVL.js";import"./chunk-WKKRDNHB.js";import"./chunk-NSFGWBZH.js";import"./chunk-QLANGENB.js";import{d as k}from"./chunk-EH2C4XHQ.js";import{e as X,f as Y,g as ee,i as te,j as C,l as R,m as y}from"./chunk-D7SIZTGA.js";import{$b as d,Bb as j,Fb as r,Gb as m,Hb as u,Ib as D,Jb as M,Lb as L,Rb as b,Tb as g,Y as P,_b as K,ab as i,ac as F,bc as A,cc as Q,ga as p,hc as I,ic as _,la as S,lc as W,q as J,qc as v,rc as h,sb as c,ub as s,wa as w,xa as E}from"./chunk-KIIQGHZ6.js";import{a as q,b as H}from"./chunk-NEB6MB4Y.js";var Ie=(()=>{let a=class a{constructor(){this.datePipe=p(C),this.currencyPipe=p(y),this.pagoTrabajadorService=p($),this._matDialog=p(re),this.estadoDatosService=p(G),this.router=p(k),this.data=[],this.columns=["Creaci\xF3n","Empresa","Total"],this.columnPropertyMap={Creaci\u00F3n:"fechaCreacion",Empresa:"nombreSubempresa",Total:"total"},this.buttons=[{label:"Eye",icon:"visibility",action:o=>{console.log("Editing",o),this.router.navigate(["/pages/gestion-cobros/trabajador/individual/",o.id])}}]}ngOnDestroy(){}ngOnInit(){this.getPagoTrabajadores(),this.listenGrid()}onNew(){this.router.navigate(["/pages/gestion-cobros/trabajador/individual"])}getPagoTrabajadores(){this.pagoTrabajadorService.getPagoTrabajadorIndividual().pipe(P(o=>(o.data.forEach(t=>{t.fechaCreacion=this.datePipe.transform(t.fechaCreacion,"dd/MM/yyyy"),t.total=this.currencyPipe.transform(t.total,"USD","symbol","1.2-2")}),o))).subscribe(o=>{this.data=o.data})}listenGrid(){this.estadoDatosService.stateGrid.asObservable().subscribe(t=>{t&&this.getPagoTrabajadores()})}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=S({type:a,selectors:[["app-grid-pago-trabajador"]],standalone:!0,features:[I([C,y]),_],decls:15,vars:11,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),d(3,"Pago trabajador"),m(),r(4,"div",3)(5,"mat-form-field",4),u(6,"mat-icon",5)(7,"input",6),m(),r(8,"button",7),b("click",function(){return n.onNew()}),u(9,"mat-icon",8),r(10,"span",9),d(11,"Pagar"),m()()()(),r(12,"div",10)(13,"div",11),u(14,"app-custom-table",12),m()()()),t&2&&(i(5),s("subscriptSizing","dynamic"),i(),s("svgIcon","heroicons_solid:magnifying-glass"),i(),s("autocomplete","off")("placeholder","Buscar"),i(),s("color","primary"),i(),s("svgIcon","heroicons_outline:plus"),i(5),s("columns",n.columns)("displayedColumns",n.columns)("columnPropertyMap",n.columnPropertyMap)("data",n.data)("buttons",n.buttons))},dependencies:[B,N,V,se,O]});let e=a;return e})();var Oe=(e,a)=>({"bg-credigray-100":e,"bg-green-600":a});function Be(e,a){if(e&1&&(r(0,"mat-option",26),d(1),m()),e&2){let l=a.$implicit;s("value",l.id),i(),F(l.nombre)}}function Ge(e,a){if(e&1&&(D(0),c(1,Be,2,2,"mat-option",25),M()),e&2){let l=a.ngIf;i(),s("ngForOf",l.data)}}function $e(e,a){if(e&1&&(r(0,"mat-option",26),d(1),m()),e&2){let l=a.$implicit;s("value",l.id),i(),F(l.razonSocial)}}function ze(e,a){if(e&1&&(D(0),c(1,$e,2,2,"mat-option",25),M()),e&2){let l=a.ngIf;i(),s("ngForOf",l.data)}}function qe(e,a){if(e&1&&(r(0,"mat-option",26),d(1),m()),e&2){let l=a.$implicit;s("value",l.id),i(),Q("",l.primerNombre," ",l.primerApellido,"")}}function Le(e,a){if(e&1&&(D(0),c(1,qe,2,3,"mat-option",25),M()),e&2){let l=a.ngIf;i(),s("ngForOf",l.data)}}function Re(e,a){e&1&&(r(0,"mat-error"),d(1,"El valor es requerido!"),m())}function Ue(e,a){e&1&&(r(0,"mat-error"),d(1,"El valor ingresado no puede superar el total a pagar!"),m())}function Ze(e,a){e&1&&(r(0,"mat-error"),d(1,"El valor ingresado no puede ser 0!"),m())}function He(e,a){if(e&1){let l=L();r(0,"div",27)(1,"mat-form-field",28)(2,"mat-label"),d(3,"Valor a cancelar"),m(),r(4,"input",29),b("blur",function(){w(l);let t=g();return E(t.valorAbono.updateValueAndValidity())}),m(),c(5,Re,2,0,"mat-error",11)(6,Ue,2,0,"mat-error",11)(7,Ze,2,0,"mat-error",11),m(),r(8,"mat-form-field",28)(9,"mat-label"),d(10,"Observaciones"),m(),u(11,"textarea",30),m()()}if(e&2){let l=g();i(4),s("allowNegativeNumbers",!1)("separatorLimit","999999999")("formControlName","valorAbono"),i(),s("ngIf",(l.valorAbono.touched||l.valorAbono.dirty)&&l.valorAbono.hasError("required")),i(),s("ngIf",(l.valorAbono.touched||l.valorAbono.dirty)&&l.valorAbono.hasError("exceedsBalance")),i(),s("ngIf",(l.valorAbono.touched||l.valorAbono.dirty)&&l.valorAbono.hasError("valueZero")),i(4),s("formControlName","observacion")}}function Je(e,a){if(e&1&&(r(0,"div",21)(1,"div",31),u(2,"app-custom-table",32),m()()),e&2){let l=g();i(2),s("columns",l.columns)("displayedColumns",l.columns)("columnPropertyMap",l.columnPropertyMap)("data",l.data)}}function Ke(e,a){if(e&1&&(r(0,"div",22)(1,"div",33)(2,"fuse-alert",34)(3,"span",35),d(4,"Informaci\xF3n"),m(),d(5),m()()()),e&2){let l=g();i(2),s("type","info")("appearance","outline"),i(3),A(" ",l.message," ")}}function Qe(e,a){if(e&1&&(r(0,"span",24),d(1,"Subtotal: "),r(2,"span",36),d(3),v(4,"currency"),m()()),e&2){let l=g();i(3),F(h(4,1,l.subtotal))}}function We(e,a){if(e&1&&(r(0,"span",24),d(1,"Comisiones: "),r(2,"span",36),d(3),v(4,"currency"),m()()),e&2){let l=g();i(3),F(h(4,1,l.totalComision))}}function Xe(e,a){if(e&1&&(r(0,"span",24),d(1,"Total a pagar: "),r(2,"span",36),d(3),v(4,"currency"),m()()),e&2){let l=g();i(3),A(" ",h(4,1,l.totalPagar)," ")}}var Ye={validation:!1},ke=(()=>{let a=class a{constructor(){this.fb=p(ve),this.empresaClienteService=p(Pe),this.pagoTrabajadorService=p($),this.cobroTrabajadorService=p(Me),this.datePipe=p(C),this.swalService=p(Fe),this.estadosDatosService=p(G),this.fuseService=p(de),this.currencyPipe=p(y),this.decimalPipe=p(R),this.router=p(k),this.empleadosService=p(De),this.empresa$=this.empresaClienteService.getEmpresasClientes().pipe(P(o=>{let t=o.data;t&&(this.form.get("idSubEmpresa").setValue(t[0].id),this.getEmpleadosSubEmpresas(t[0].id))})),this.tipoPago$=this.pagoTrabajadorService.tipoPagoTrabajadores().pipe(P(o=>{let t=o.data;t&&(this.selectOptionValue=t)})),this.data=[],this.columns=["N\xFAmero de identificaci\xF3n","Valor pendiente","Fecha de cobro"],this.columnPropertyMap={"N\xFAmero de identificaci\xF3n":"documentoTrabajador","Valor pendiente":"valorPendiente","Fecha de cobro":"fechaCobro"}}createForm(){this.form=this.fb.group({fechaFinal:["",T.required],idSubEmpresa:["",T.required],idTipoPagoTrabajador:["",T.required],idTrabajador:["",T.required],valorAbono:["",[this.maxAmountValidator.bind(this)]],observacion:[""]})}ngOnInit(){this.createForm(),this.form.get("valorAbono").valueChanges.subscribe(o=>{console.log(o),o==0?(this.form.get("valorAbono").setValidators([T.required,this.maxAmountValidator.bind(this)]),this.form.updateValueAndValidity()):o>0&&this.actualizaSelected(o)})}actualizaSelected(o){o===this.totalPagar?(console.log("Si entra al actualizar"),this.form.get("idTipoPagoTrabajador").setValue(this.selectOptionValue[0].id)):o<this.totalPagar&&(console.log("Si entra al actualizar 2"),this.form.get("idTipoPagoTrabajador").setValue(this.selectOptionValue[1].id))}get valorAbono(){return this.form.get("valorAbono")}maxAmountValidator(o){if(o.value===null||o.value===void 0||o.value==="")return null;console.log(o.value);let t=parseFloat(o.value.toString().replace(/,/g,""));return console.log(t),t===0?{valueZero:!0}:t>this.totalPagar?(console.log("Si entra"),{exceedsBalance:!0}):null}closeDialog(){this.router.navigate(["/pages/gestion-cobros/trabajador"])}getEmpleadosSubEmpresas(o){this.empleados$=this.empleadosService.getEmpleadosSubempresas(o)}onGet(){if(this.form.valid){let{fechaFinal:o,idSubEmpresa:t,idTrabajador:n}=this.form.getRawValue(),x={fechaFinallData:this.datePipe.transform(o,"yyyy-MM-dd"),idSubEmpresa:t,idTrabajador:n};console.log(x),this.getAllPagoTrabajador(x)}}onSave(){let{fechaFinal:o,idSubEmpresa:t,idTrabajador:n,idTipoPagoTrabajador:f}=this.form.getRawValue(),Ne={fechaFinal:this.datePipe.transform(o,"yyyy-MM-dd"),idSubEmpresa:t},U=[];U=this.data.map(z=>({idCobroTrabajador:z.id}));let Z=H(q({},Ne),{idTipoPagoTrabajador:f,detallePagoTrabajador:U,idTrabajador:n});console.log(Z),this.fuseService.open(q({},Se)).afterClosed().subscribe(z=>{z==="confirmed"&&this.postSave(Z)})}getAllPagoTrabajador(o){this.cobroTrabajadorService.getCobroTrabajador(o).pipe(J(t=>(this.subtotal=0,this.totalComision=0,this.totalPagar=0,t&&Array.isArray(t.data)?t.data.forEach(n=>{n.montoCuota=this.currencyPipe.transform(n.montoCuota,"USD","symbol","1.2-2"),n.comision=this.currencyPipe.transform(n.comision,"USD","symbol","1.2-2"),n.pagar=this.currencyPipe.transform(n.pagar,"USD","symbol","1.2-2"),n.valorPendiente=this.currencyPipe.transform(n.valorPendiente,"USD","symbol","1.2-2"),n.fechaCobro=this.datePipe.transform(n.fechaCobro,"dd/MM/yyyy"),this.totalPagar+=parseFloat(n.montoCuota.replace(/[^0-9.-]+/g,""))}):this.data=[],t))).subscribe(t=>{t&&Array.isArray(t.data)?this.data=t.data:(this.data=[],this.message=t.msg)})}postSave(o){this.pagoTrabajadorService.postPagoTrabajador(o).subscribe(t=>{this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.estadosDatosService.stateGrid.next(!0),this.closeDialog()},t=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})})}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=S({type:a,selectors:[["app-form-pago-trabajador"]],standalone:!0,features:[I([{provide:oe,useClass:we},{provide:ae,useValue:"en-GB"},C,y,R,Ee(Ye)]),_],decls:53,vars:29,consts:[["finalPicker",""],[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:inset-0","sm:overflow-hidden"],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","sm:flex-row","md:px-8"],[1,"mt-6","w-full","shrink-0","sm:mt-0","sm:space-x-2","lg:w-full"],[1,"mt-8",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","dd/mm/yyyy",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],["placeholder","Tipo de pago trabajador",3,"formControlName"],[4,"ngIf"],["placeholder","Empresa",3,"formControlName"],["placeholder","Trabajadores",3,"formControlName"],["class","flex flex-col items-baseline sm:flex-row gap-2.5",4,"ngIf"],[1,"relative","p-4","border","border-gray-300","rounded-lg","mt-4"],[1,"absolute","-top-3","left-4","bg-white","px-2","text-gray-500","font-semibold"],[1,"flex","flex-wrap","justify-end","gap-2.5","sm:mb-4"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","sm:mt-6","transition","duration-200","text-white","font-semibold","rounded-lg","md:w-auto",3,"click","ngClass","disabled"],[1,"flex","flex-auto","overflow-hidden"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"flex","flex-col","gap-4","justify-end","sm:flex-row"],[1,"sm:pr-4","text-gray-600","font-bold","text-right"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-col","items-baseline","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full"],["matInput","","mask","separator.2","thousandSeparator",",","decimalMarker",".","placeholder","Valor a cancelar",3,"blur","allowNegativeNumbers","separatorLimit","formControlName"],["matInput","","placeholder","Observaciones",3,"formControlName"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:p-4","sm:mb-10","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data"],[1,"inline-block","p-4","sm:p-8","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""],[1,"text-gray-800"]],template:function(t,n){if(t&1){let f=L();r(0,"div",1)(1,"div",2),d(2),m(),r(3,"div",3)(4,"div",4)(5,"form",5)(6,"div",6)(7,"mat-form-field",7)(8,"mat-label"),d(9,"Fecha de corte"),m(),u(10,"input",8)(11,"mat-datepicker-toggle",9)(12,"mat-datepicker",null,0),m(),r(14,"mat-form-field",7)(15,"mat-label"),d(16,"Tipo de pago"),m(),r(17,"mat-select",10),c(18,Ge,2,1,"ng-container",11),v(19,"async"),m()()(),r(20,"div",6)(21,"mat-form-field",7)(22,"mat-label"),d(23,"Empresa"),m(),r(24,"mat-select",12),c(25,ze,2,1,"ng-container",11),v(26,"async"),m()(),r(27,"mat-form-field",7)(28,"mat-label"),d(29,"Trabajadores"),m(),r(30,"mat-select",13),c(31,Le,2,1,"ng-container",11),v(32,"async"),m()()(),c(33,He,12,7,"div",14),r(34,"div",15)(35,"div",16),d(36," Opciones "),m(),r(37,"div",17)(38,"button",18),b("click",function(){return w(f),E(n.closeDialog())}),r(39,"span"),d(40," Atras "),m()(),r(41,"button",19),b("click",function(){return w(f),E(n.onGet())}),r(42,"span"),d(43," Consultar "),m()(),r(44,"button",20),b("click",function(){return w(f),E(n.onSave())}),r(45,"span"),d(46," Pagar "),m()()()()()()(),c(47,Je,3,4,"div",21)(48,Ke,6,3,"div",22),r(49,"div",23),c(50,Qe,5,3,"span",24)(51,We,5,3,"span",24)(52,Xe,5,3,"span",24),m()()}if(t&2){let f=K(13);i(2),A(" ","Pago trabajador"," "),i(3),s("formGroup",n.form),i(5),s("matDatepicker",f)("formControlName","fechaFinal"),i(),s("for",f),i(6),s("formControlName","idTipoPagoTrabajador"),i(),s("ngIf",h(19,20,n.tipoPago$)),i(6),s("formControlName","idSubEmpresa"),i(),s("ngIf",h(26,22,n.empresa$)),i(5),s("formControlName","idTrabajador"),i(),s("ngIf",h(32,24,n.empleados$)),i(2),s("ngIf",n.data.length),i(5),s("color","primary"),i(3),s("color","primary"),i(3),s("ngClass",W(26,Oe,n.data.length==0,n.data.length>0))("disabled",n.data.length==0||n.form.invalid),i(3),j(n.data.length?47:n.message?48:-1),i(3),j(n.subtotal?50:-1),i(),j(n.totalComision?51:-1),i(),j(n.totalPagar?52:-1)}},dependencies:[te,y,B,ye,N,_e,Ce,Te,V,O,ne,ie,xe,me,Y,ee,he,ue,pe,ce,fe,ge,be,X,je,le]});let e=a;return e})();var Ve=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=S({type:a,selectors:[["app-form-view-pago-trabajador"]],standalone:!0,features:[_],decls:2,vars:0,template:function(t,n){t&1&&(r(0,"p"),d(1,"form-view-pago-trabajador works!"),m())}});let e=a;return e})();var Ht=[{path:"",component:Ie},{path:"individual",component:ke},{path:"individual/:id",component:Ve}];export{Ht as default};
