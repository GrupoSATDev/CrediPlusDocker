import{a as Fe}from"./chunk-QIL2IRB7.js";import{a as Te}from"./chunk-VBXYNQY3.js";import{a as w}from"./chunk-FAEUQIFQ.js";import{a as Ee,b as x}from"./chunk-P4PAYY2C.js";import{a as Se,b as _e,c as xe}from"./chunk-LZ3ZEVTF.js";import{a as we}from"./chunk-DTORAJAR.js";import{a as ge}from"./chunk-3R6HD5RM.js";import{a as ve}from"./chunk-CJO6YW5P.js";import{g as ae,h as Ce}from"./chunk-QVE5MGEQ.js";import"./chunk-7YBFULQ5.js";import{C as fe,E as ue,F as be,J as he,b as Z,e as ee,i as te,l as ne,n as _,p as se,q as le,s as me,u as pe,x as ce,y as de}from"./chunk-4PVPKBBG.js";import{e as ie}from"./chunk-KAEQCOKJ.js";import"./chunk-YKJB7XET.js";import{h as Y}from"./chunk-FUOI65R5.js";import"./chunk-FBBBUL3D.js";import{a as ye}from"./chunk-73F67TFK.js";import"./chunk-XTYNXB3F.js";import{$a as v,Ad as Q,Eb as T,Fb as f,Gb as A,Ka as r,Md as W,Ob as L,Pb as X,Sb as O,Xb as B,Yb as $,Z as M,bb as a,fe as oe,ga as u,ib as P,ka as j,ke as re,mb as l,nb as i,ob as g,pb as V,pc as q,q as D,qb as R,qc as z,rc as U,sb as G,ua as C,uc as H,va as y,vb as S,vc as F,xb as N,xc as J,yc as k,zd as K}from"./chunk-ODJKW74N.js";import{a as E,d as I}from"./chunk-NEB6MB4Y.js";var De=(t,n)=>({"bg-green-700":t,"bg-credigray-100":n});function Me(t,n){if(t&1&&(l(0,"mat-option",21),f(1),i()),t&2){let d=n.$implicit;a("value",d.id),r(),A(d.nombre)}}function je(t,n){if(t&1&&(V(0),v(1,Me,2,2,"mat-option",20),R()),t&2){let d=n.ngIf;r(),a("ngForOf",d.data)}}function Pe(t,n){if(t&1&&(l(0,"div",19)(1,"div",22),g(2,"app-custom-table",23),i()()),t&2){let d=N();r(2),a("columns",d.columns)("displayedColumns",d.columns)("columnPropertyMap",d.columnPropertyMap)("data",d.data)("searchTerm",d.searchTerm)}}function Ve(t,n){t&1&&(l(0,"div",24)(1,"div",25)(2,"fuse-alert",26)(3,"span",27),f(4,"Informaci\xF3n"),i(),f(5," No hay informaci\xF3n hasta el momento. "),i()()()),t&2&&(r(2),a("type","info")("appearance","outline"))}function Re(t,n){t&1&&v(0,Ve,6,2,"ng-template")}var ke=(()=>{let n=class n{constructor(){this.searchTerm="",this.fb=u(fe),this.reportesService=u(Fe),this.datePipe=u(F),this.estados=new me([""]),this.detalleConsumoService=u(Te),this.detalleConsumo$=this.detalleConsumoService.getEstadoCobros().pipe(M(m=>{let s=m.data;s&&this.form.get("idEstadoCredito").setValue(s[0].id)})),this.data=[],this.columns=["Empresa","Trabajador","Fecha de cobro","Valor cuota","Valor sin intereses","Intereses ganados"],this.columnPropertyMap={Empresa:"nombreSubEmpresa",Trabajador:"nombreTrabajador","Fecha de cobro":"fechaCobro","Valor cuota":"montoCuota","Valor sin intereses":"montoCuotaSinIntereses","Intereses ganados":"interesesGanados"},this.aesEncriptService=u(ie),this.currencyPipe=u(k),this.exportData=[],this.fuseService=u(ae)}onSearch(m){let s=m.target;this.searchTerm=s.value.trim().toLowerCase()}onSelect(m){let s=m.value}createForm(){this.form=this.fb.group({idEstadoCredito:["",_.required],fechaInicio:["",_.required],fechaFinal:["",_.required]})}ngOnInit(){this.createForm()}onConsultar(){if(this.form.valid){let m=this.form.getRawValue(),{fechaInicio:s,fechaFinal:e}=m,p=I(m,["fechaInicio","fechaFinal"]),c=this.datePipe.transform(s,"yyyy-MM-dd"),h=this.datePipe.transform(e,"yyyy-MM-dd"),Ie=E({fechaInicio:c,fechaFinal:h},p);this.reportesService.getReporteCobros(Ie).pipe(D(b=>(b.data.forEach(o=>{o.fechaCobro=this.datePipe.transform(o.fechaCobro,"dd/MM/yyyy"),o.montoCuota&&(o.montoCuota=this.aesEncriptService.decrypt(o.montoCuota)),o.montoCuotaSinIntereses&&(o.montoCuotaSinIntereses=this.aesEncriptService.decrypt(o.montoCuotaSinIntereses)),o.interesesGanados&&(o.interesesGanados=this.aesEncriptService.decrypt(o.interesesGanados)),o.montoCuota=this.currencyPipe.transform(o.montoCuota,"USD","symbol","1.2-2"),o.montoCuotaSinIntereses=this.currencyPipe.transform(o.montoCuotaSinIntereses,"USD","symbol","1.2-2"),o.interesesGanados=parseFloat(o.interesesGanados.replace(",",".")),o.interesesGanados=this.currencyPipe.transform(o.interesesGanados,"USD","symbol","1.2-2")}),b))).subscribe(b=>{b.data?(this.data=b.data,this.convertDataExportFijos(b.data)):this.data=[]})}}convertDataExportFijos(m){let s=m.map(e=>({Empresa:e.nombreSubEmpresa,Trabajador:e.nombreTrabajador,FechaCobro:e.fechaCobro,ValorCuota:w(e.montoCuota),ValorSinIntereses:w(e.montoCuotaSinIntereses),InteresesGanados:w(e.interesesGanados)}));this.exportData=s}exportToExcel(m){this.fuseService.open(E({},Ce)).afterClosed().subscribe(e=>{if(e==="confirmed"){let p=x.json_to_sheet(m),c=x.book_new();x.book_append_sheet(c,p,"Sheet1"),Ee(c,`Reporte cobros trabajadores${this.datePipe.transform(new Date,"dd/MM/yyyy")}.xlsx`)}})}};n.\u0275fac=function(s){return new(s||n)},n.\u0275cmp=j({type:n,selectors:[["app-reporte-cobro-trabajadores"]],standalone:!0,features:[L([{provide:Q,useClass:we},{provide:K,useValue:"en-GB"},F,k,J]),X],decls:38,vars:23,consts:[["inicioPicker",""],["finalPicker",""],["cdkScrollable","",1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],[1,"px-6","border-b","mt-6","w-full","shrink-0","sm:mt-0","sm:space-x-2","lg:w-full"],[1,"flex","flex-col","sm:flex-row","gap-2.5",3,"formGroup"],[1,"w-full","sm:w-1/2"],[3,"selectionChange","formControlName"],[4,"ngIf"],["floatLabel","always",1,"w-full","sm:w-1/2"],["matInput","","placeholder","dd/mm/yyyy",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],["mat-flat-button","",1,"sm:w-1/6","w-full","sm:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"sm:sm:w-1/6","w-full","sm:mt-6","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color","ngClass","disabled"],[1,"flex","flex-auto","overflow-hidden"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","searchTerm"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"inline-block","p-4","sm:p-2","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""]],template:function(s,e){if(s&1){let p=G();l(0,"div",2)(1,"div",3)(2,"div",4),f(3,"Reporte de Cobros Trabajadores"),i(),l(4,"div",5)(5,"mat-form-field",6),g(6,"mat-icon",7),l(7,"input",8),S("input",function(h){return C(p),y(e.onSearch(h))}),i()()()(),l(8,"div",9)(9,"form",10)(10,"mat-form-field",11)(11,"mat-label"),f(12,"Estados"),i(),l(13,"mat-select",12),S("selectionChange",function(h){return C(p),y(e.onSelect(h))}),v(14,je,2,1,"ng-container",13),B(15,"async"),i()(),l(16,"mat-form-field",14)(17,"mat-label"),f(18,"Fecha de inicio"),i(),g(19,"input",15)(20,"mat-datepicker-toggle",16)(21,"mat-datepicker",null,0),i(),l(23,"mat-form-field",14)(24,"mat-label"),f(25,"Fecha fin"),i(),g(26,"input",15)(27,"mat-datepicker-toggle",16)(28,"mat-datepicker",null,1),i(),l(30,"button",17),S("click",function(){return C(p),y(e.onConsultar())}),l(31,"span"),f(32," Consultar "),i()(),l(33,"button",18),S("click",function(){return C(p),y(e.exportToExcel(e.exportData))}),l(34,"span"),f(35," Exportar "),i()()()(),v(36,Pe,3,5,"div",19)(37,Re,1,0),i()}if(s&2){let p=T(22),c=T(29);r(5),a("subscriptSizing","dynamic"),r(),a("svgIcon","heroicons_solid:magnifying-glass"),r(),a("autocomplete","off")("placeholder","Buscar"),r(2),a("formGroup",e.form),r(4),a("formControlName","idEstadoCredito"),r(),a("ngIf",$(15,18,e.detalleConsumo$)),r(5),a("matDatepicker",p)("formControlName","fechaInicio"),r(),a("for",p),r(6),a("matDatepicker",c)("formControlName","fechaFinal"),r(),a("for",c),r(3),a("color","primary"),r(3),a("color","primary")("ngClass",O(20,De,e.exportData.length,!e.exportData.length))("disabled",!e.exportData.length),r(3),P(e.data.length>0?36:37)}},dependencies:[H,Y,ge,ue,pe,ne,se,le,ye,oe,Se,_e,xe,te,re,he,Z,W,ve,ee,z,U,be,ce,de,q]});let t=n;return t})();var pt=[{path:"",component:ke}];export{pt as default};
