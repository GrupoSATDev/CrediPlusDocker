import{a as w}from"./chunk-JHGRPN2G.js";import{$ as h,D as g,Ic as p,V as l,Y as k,fa as n,h as f,l as i,m,q as u}from"./chunk-WDMQQ6H3.js";import{a as d}from"./chunk-NEB6MB4Y.js";var T=(()=>{let e=class e{constructor(){this._httpClient=n(p),this._user=new f(1)}set user(t){this._user.next(t)}get user$(){return this._user.asObservable()}get(){return this._httpClient.get("api/common/user").pipe(k(t=>{this._user.next(t)}))}update(t){return this._httpClient.patch("api/common/user",{user:t}).pipe(u(r=>{this._user.next(r)}))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();var a=class extends Error{};a.prototype.name="InvalidTokenError";function v(s){return decodeURIComponent(atob(s).replace(/(.)/g,(e,o)=>{let t=o.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function I(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return v(e)}catch{return atob(e)}}function b(s,e){if(typeof s!="string")throw new a("Invalid token specified: must be a string");e||(e={});let o=e.header===!0?0:1,t=s.split(".")[o];if(typeof t!="string")throw new a(`Invalid token specified: missing part #${o+1}`);let r;try{r=I(t)}catch(c){throw new a(`Invalid token specified: invalid base64 for part #${o+1} (${c.message})`)}try{return JSON.parse(r)}catch(c){throw new a(`Invalid token specified: invalid json for part #${o+1} (${c.message})`)}}var M=(()=>{let e=class e{constructor(){this._authenticated=!1,this._httpClient=n(p),this._userService=n(T),this._appSettings=n(w)}set accessToken(t){localStorage.setItem("accessToken",t)}get accessToken(){return localStorage.getItem("accessToken")??""}forgotPassword(t){return this._httpClient.post("api/auth/forgot-password",t)}resetPassword(t){return this._httpClient.post("api/auth/reset-password",t)}signIn(t){return this._authenticated?m("User is already logged in."):this._httpClient.post(this._appSettings.auth.url.base,t).pipe(u(r=>{let c={id:Math.random().toString(),name:r.data.nombre,email:r.data.correo,avatar:"images/avatars/avatar-user.png",status:"online"};return r.tokenType="bearer",r.user=d({},c),delete r.data,r}),l(r=>(console.log(r),this.accessToken=r.accessToken,this._authenticated=!0,this._userService.user=r.user,i(r))))}signInUsingToken(){return this._httpClient.post("api/auth/sign-in-with-token",{accessToken:this.accessToken}).pipe(g(()=>i(!1)),l(t=>(t.accessToken&&(this.accessToken=t.accessToken),this._authenticated=!0,this._userService.user=t.user,i(!0))))}signOut(){return localStorage.removeItem("accessToken"),this._authenticated=!1,i(!0)}signUp(t){return this._httpClient.post("api/auth/sign-up",t)}unlockSession(t){return this._httpClient.post("api/auth/unlock-session",t)}check(){return this._authenticated?i(!0):this.accessToken?i(!0):i(!1)}decodeToken(){if(!this.accessToken)return null;try{return b(this.accessToken)}catch(t){return console.error("Error al decodificar el token",t),null}}getRole(){return this.decodeToken()?.["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]||null}getTipoUsuario(){return this.decodeToken()?.TipoUsuario||null}hasRole(t){return this.getRole()===t}hasTipoUsuario(t){return this.getTipoUsuario()===t}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();export{T as a,M as b};
